# План перехода Amanita на максимум совместимости с WordPress

**Цель:**
Гарантировать корректную активацию, деактивацию и удаление плагина Amanita на любом хостинге и в любой среде WordPress, даже без Composer.

---

## 1. Явное подключение всех нужных файлов
- В главном файле `amanita.php` до всех хуков явно подключать все классы, которые используются в хуках активации/деактивации/удаления.
- Не полагаться на автозагрузку Composer для этих хуков.
- Пример:
  ```php
  require_once __DIR__ . '/includes/Uninstaller.php';
  require_once __DIR__ . '/includes/Logger.php';
  // ... другие нужные классы
  ```

## 2. Регистрация хуков активации/деактивации/удаления
- Регистрировать хуки только после подключения нужных классов.
- Пример:
  ```php
  register_activation_hook( __FILE__,  [ 'Amanita\Uninstaller', 'on_activation' ] );
  register_deactivation_hook( __FILE__, [ 'Amanita\Uninstaller', 'on_deactivation' ] );
  register_uninstall_hook(   __FILE__,  [ 'Amanita\Uninstaller', 'cleanup' ] );
  ```

## 3. Подключение Composer autoload (опционально)
- Подключать autoload.php только для основной логики (админка, синхронизация и т.д.), но не для хуков активации.
- Пример:
  ```php
  if ( file_exists( __DIR__ . '/vendor/autoload.php' ) ) {
      require_once __DIR__ . '/vendor/autoload.php';
  }
  ```

## 4. Проверка наличия WooCommerce
- Оставить проверку WooCommerce только для основной логики, не для хуков активации.

## 5. Проверка работоспособности
- Деактивировать и активировать плагин Amanita через админку WP.
- Проверить, что:
  - Не возникает ошибок
  - Логи создаются
  - Все опции и мета-данные корректно создаются/удаляются

## 6. Документация
- В README.md и docs/infrastructure.md описать, что для активации/деактивации/удаления автозагрузка Composer не требуется.
- Для основной логики Composer autoload рекомендуется, но не обязателен для базовой работоспособности.

---

**Результат:**
- Плагин Amanita будет работать на любом хостинге, даже если Composer не используется.
- Активация/деактивация/удаление всегда будут работать корректно, как в eventify-me.
- Основная логика может использовать автозагрузку и современные практики, но не критична для жизненного цикла плагина.
