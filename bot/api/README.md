# AMANITA API - –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è

## –û–±–∑–æ—Ä

AMANITA API - —ç—Ç–æ REST API –¥–ª—è –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ e-commerce –ø–ª–∞—Ç—Ñ–æ—Ä–º —Å –±–ª–æ–∫—á–µ–π–Ω —ç–∫–æ—Å–∏—Å—Ç–µ–º–æ–π AMANITA. API –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å —Ç–æ–≤–∞—Ä–∞–º–∏, –∏–Ω–≤–∞–π—Ç–∞–º–∏, –∑–∞–∫–∞–∑–∞–º–∏ –∏ –±–ª–æ–∫—á–µ–π–Ω –æ–ø–µ—Ä–∞—Ü–∏—è–º–∏.

## üöÄ –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç

### –ó–∞–ø—É—Å–∫ API —Å–µ—Ä–≤–µ—Ä–∞

```bash
# –ò–∑ –∫–æ—Ä–Ω–µ–≤–æ–π –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏ –ø—Ä–æ–µ–∫—Ç–∞
cd bot
python3 -m uvicorn api.main:app --host 0.0.0.0 --port 8000 --reload
```

### –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–±–æ—Ç–æ—Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç–∏

```bash
# Health check
curl http://localhost:8000/health

# –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è API
open http://localhost:8000/docs
```

## üìã –î–æ—Å—Ç—É–ø–Ω—ã–µ —ç–Ω–¥–ø–æ–∏–Ω—Ç—ã

### –ü—É–±–ª–∏—á–Ω—ã–µ —ç–Ω–¥–ø–æ–∏–Ω—Ç—ã
- `GET /` - –ö–æ—Ä–Ω–µ–≤–æ–π —ç–Ω–¥–ø–æ–∏–Ω—Ç
- `GET /health` - –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–æ—Å—Ç–æ—è–Ω–∏—è —Å–µ—Ä–≤–∏—Å–∞
- `GET /health/detailed` - –î–µ—Ç–∞–ª—å–Ω–∞—è –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞
- `GET /docs` - Swagger –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è
- `GET /redoc` - ReDoc –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è

### –ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ —ç–Ω–¥–ø–æ–∏–Ω—Ç—ã
- `POST /auth-test` - –¢–µ—Å—Ç HMAC –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏
- `POST /api-keys/` - –°–æ–∑–¥–∞–Ω–∏–µ API –∫–ª—é—á–∞
- `GET /api-keys/{client_address}` - –ü–æ–ª—É—á–µ–Ω–∏–µ –∫–ª—é—á–µ–π –∫–ª–∏–µ–Ω—Ç–∞
- `DELETE /api-keys/{api_key}` - –û—Ç–∑—ã–≤ API –∫–ª—é—á–∞
- `GET /api-keys/validate/{api_key}` - –í–∞–ª–∏–¥–∞—Ü–∏—è –∫–ª—é—á–∞

## üîê –ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è

API –∏—Å–ø–æ–ª—å–∑—É–µ—Ç HMAC –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—é –¥–ª—è –∑–∞—â–∏—Ç—ã —ç–Ω–¥–ø–æ–∏–Ω—Ç–æ–≤.

### –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è –¥–ª—è –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏

```bash
# API –∫–ª—é—á–∏ (—É–∂–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω—ã –≤ .env)
AMANITA_API_KEY=ak_22bc74537e53698e
AMANITA_API_SECRET=sk_9160864a1ba617780cce32258248c21d085d8ddb18d3250ff4532925102d1b68

# HMAC –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
AMANITA_API_HMAC_SECRET_KEY=default-secret-key-change-in-production
AMANITA_API_HMAC_TIMESTAMP_WINDOW=300
AMANITA_API_HMAC_NONCE_CACHE_TTL=600
```

### –§–æ—Ä–º–∞—Ç—ã API –∫–ª—é—á–µ–π

API –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç —Å–ª–µ–¥—É—é—â–∏–µ —Ñ–æ—Ä–º–∞—Ç—ã –∫–ª—é—á–µ–π:
- `ak_` + 16 —Å–∏–º–≤–æ–ª–æ–≤ (—Ñ–æ—Ä–º–∞—Ç Amanita)
- `sk_` + 64 hex —Å–∏–º–≤–æ–ª–∞ (—Å–µ–∫—Ä–µ—Ç–Ω—ã–π –∫–ª—é—á)
- 64 hex —Å–∏–º–≤–æ–ª–∞ (—Ç—Ä–∞–¥–∏—Ü–∏–æ–Ω–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç)

## üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

### –ó–∞–ø—É—Å–∫ –≤—Å–µ—Ö —Ç–µ—Å—Ç–æ–≤ API

```bash
# –ò–∑ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏ bot
python3 -m pytest tests/api/ -v
```

### –†–µ–∑—É–ª—å—Ç–∞—Ç—ã —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è

‚úÖ **–í—Å–µ —Ç–µ—Å—Ç—ã –ø—Ä–æ—Ö–æ–¥—è—Ç —É—Å–ø–µ—à–Ω–æ (63/63)**
- HMAC –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è —Ä–∞–±–æ—Ç–∞–µ—Ç
- –í–∞–ª–∏–¥–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∏—Ä—É–µ—Ç
- –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–∞
- Health check —ç–Ω–¥–ø–æ–∏–Ω—Ç—ã –¥–æ—Å—Ç—É–ø–Ω—ã

### –°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Ç–µ—Å—Ç–æ–≤

```
tests/api/
‚îú‚îÄ‚îÄ test_api_auth.py      # –¢–µ—Å—Ç—ã –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏
‚îú‚îÄ‚îÄ test_data.py          # –¢–µ—Å—Ç–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ
‚îú‚îÄ‚îÄ test_error_handlers.py # –¢–µ—Å—Ç—ã –æ–±—Ä–∞–±–æ—Ç–∫–∏ –æ—à–∏–±–æ–∫
‚îú‚îÄ‚îÄ test_models.py        # –¢–µ—Å—Ç—ã –º–æ–¥–µ–ª–µ–π –¥–∞–Ω–Ω—ã—Ö
‚îî‚îÄ‚îÄ conftest.py           # –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è pytest
```

## üìù –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ

### –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è

```bash
# –£—Ä–æ–≤–µ–Ω—å –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è (DEBUG, INFO, WARNING, ERROR)
AMANITA_API_LOG_LEVEL=DEBUG

# –ü—É—Ç—å –∫ —Ñ–∞–π–ª—É –ª–æ–≥–æ–≤
AMANITA_API_LOG_FILE=logs/amanita_api.log

# –ú–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–π —Ä–∞–∑–º–µ—Ä —Ñ–∞–π–ª–∞ –ª–æ–≥–æ–≤ (–≤ –±–∞–π—Ç–∞—Ö)
AMANITA_API_LOG_MAX_SIZE=10485760  # 10MB

# –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ñ–∞–π–ª–æ–≤ —Ä–æ—Ç–∞—Ü–∏–∏
AMANITA_API_LOG_BACKUP_COUNT=5
```

### –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ª–æ–≥–æ–≤

#### –ö–æ–Ω—Å–æ–ª—å–Ω—ã–π –≤—ã–≤–æ–¥ (—á–µ–ª–æ–≤–µ–∫–æ—á–∏—Ç–∞–µ–º—ã–π)
```
2024-01-15 10:30:45 - amanita_api - INFO - –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è AMANITA API –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
2024-01-15 10:30:45 - amanita_api - INFO - –ó–∞–ø—Ä–æ—Å –∫ –∫–æ—Ä–Ω–µ–≤–æ–º—É —ç–Ω–¥–ø–æ–∏–Ω—Ç—É
```

#### –§–∞–π–ª–æ–≤—ã–π –≤—ã–≤–æ–¥ (JSON —Å—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–π)
```json
{
  "timestamp": "2024-01-15T10:30:45.123456",
  "level": "INFO",
  "logger": "amanita_api",
  "message": "–ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è AMANITA API –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è",
  "module": "main",
  "function": "create_api_app",
  "line": 45,
  "log_level": "INFO",
  "log_file": "logs/amanita_api.log",
  "service_factory_available": true
}
```

## ‚öôÔ∏è –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è

### –û—Å–Ω–æ–≤–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏

```bash
# –û–∫—Ä—É–∂–µ–Ω–∏–µ
AMANITA_API_ENVIRONMENT=development

# –°–µ—Ä–≤–µ—Ä
AMANITA_API_HOST=0.0.0.0
AMANITA_API_PORT=8000

# CORS
AMANITA_API_CORS_ORIGINS=*
AMANITA_API_CORS_ALLOW_CREDENTIALS=true

# –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å
AMANITA_API_TRUSTED_HOSTS=*
```

### –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è

```bash
# URL –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏
AMANITA_API_DOCS_URL=/docs
AMANITA_API_REDOC_URL=/redoc
AMANITA_API_OPENAPI_URL=/openapi.json
```

## üîó –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å –±–ª–æ–∫—á–µ–π–Ω–æ–º

API –∏–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞–Ω —Å –ª–æ–∫–∞–ª—å–Ω–æ–π Hardhat –Ω–æ–¥–æ–π –∏ —Å–º–∞—Ä—Ç-–∫–æ–Ω—Ç—Ä–∞–∫—Ç–∞–º–∏:

- **AmanitaRegistry**: `0x5FbDB2315678afecb367f032d93F642f64180aa3`
- **InviteNFT**: `0xe7f1725E7734CE288F8367e1Bb143E90bb3F0512`
- **ProductRegistry**: `0xDc64a140Aa3E981100a9becA4E685f962f0cF6C9`

## üìä –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥

### –ß—Ç–µ–Ω–∏–µ –ª–æ–≥–æ–≤

```bash
# –ü—Ä–æ—Å–º–æ—Ç—Ä —Ç–µ–∫—É—â–∏—Ö –ª–æ–≥–æ–≤
tail -f logs/amanita_api.log

# –ü–æ–∏—Å–∫ –æ—à–∏–±–æ–∫
grep '"level":"ERROR"' logs/amanita_api.log

# –ü–æ–∏—Å–∫ –ø–æ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–º—É —ç–Ω–¥–ø–æ–∏–Ω—Ç—É
grep '"endpoint":"/health"' logs/amanita_api.log

# –ê–Ω–∞–ª–∏–∑ JSON –ª–æ–≥–æ–≤ —Å jq
cat logs/amanita_api.log | jq '.level' | sort | uniq -c
```

### Health Check

```bash
# –ë–∞–∑–æ–≤—ã–π health check
curl http://localhost:8000/health

# –î–µ—Ç–∞–ª—å–Ω–∞—è –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞
curl http://localhost:8000/health/detailed
```

## üöÄ –°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏

### –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç 1: –†–∞—Å—à–∏—Ä–µ–Ω–∏–µ —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç–∏
- [ ] –≠–Ω–¥–ø–æ–∏–Ω—Ç—ã –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –±–ª–æ–∫—á–µ–π–Ω–æ–º
- [ ] –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è ProductRegistry –∏ InviteNFT —Å–µ—Ä–≤–∏—Å–æ–≤
- [ ] API –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –∏–Ω–≤–∞–π—Ç–∞–º–∏

### –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç 2: –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ —Ç–µ—Å—Ç—ã
- [ ] –¢–µ—Å—Ç—ã —Å —Ä–µ–∞–ª—å–Ω—ã–º–∏ —Å–º–∞—Ä—Ç-–∫–æ–Ω—Ç—Ä–∞–∫—Ç–∞–º–∏
- [ ] End-to-end —Ç–µ—Å—Ç—ã
- [ ] –¢–µ—Å—Ç—ã –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏

### –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç 3: WordPress –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è
- [ ] API –¥–ª—è WooCommerce –ø–ª–∞–≥–∏–Ω–∞
- [ ] –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è –∑–∞–∫–∞–∑–æ–≤
- [ ] –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ç–æ–≤–∞—Ä–∞–º–∏ —á–µ—Ä–µ–∑ API

## üîß –û—Ç–ª–∞–¥–∫–∞

### –í–∫–ª—é—á–µ–Ω–∏–µ DEBUG –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è

```bash
export AMANITA_API_LOG_LEVEL=DEBUG
python -m uvicorn api.main:app --reload
```

### –ü—Ä–æ—Å–º–æ—Ç—Ä —Å—Ç—Ä—É–∫—Ç—É—Ä—ã –ª–æ–≥–æ–≤

```bash
# –ü–æ–∫–∞–∑–∞—Ç—å –≤—Å–µ –ø–æ–ª—è JSON –ª–æ–≥–∞
cat logs/amanita_api.log | jq 'keys' | head -1

# –ü–æ–∫–∞–∑–∞—Ç—å —É–Ω–∏–∫–∞–ª—å–Ω—ã–µ —É—Ä–æ–≤–Ω–∏ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è
cat logs/amanita_api.log | jq -r '.level' | sort | uniq

# –ü–æ–∫–∞–∑–∞—Ç—å —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É –ø–æ –º–æ–¥—É–ª—è–º
cat logs/amanita_api.log | jq -r '.module' | sort | uniq -c
```

## üõ°Ô∏è –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

- HMAC –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è –¥–ª—è –≤—Å–µ—Ö –∑–∞—â–∏—â–µ–Ω–Ω—ã—Ö —ç–Ω–¥–ø–æ–∏–Ω—Ç–æ–≤
- –í–∞–ª–∏–¥–∞—Ü–∏—è –≤—Ä–µ–º–µ–Ω–Ω—ã—Ö –º–µ—Ç–æ–∫ (timestamp window)
- –ó–∞—â–∏—Ç–∞ –æ—Ç replay –∞—Ç–∞–∫ (nonce cache)
- CORS –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –¥–ª—è –≤–µ–±-–∫–ª–∏–µ–Ω—Ç–æ–≤
- Trusted Host middleware
- –õ–æ–≥–∏ –Ω–µ —Å–æ–¥–µ—Ä–∂–∞—Ç —á—É–≤—Å—Ç–≤–∏—Ç–µ–ª—å–Ω–æ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏
- –†–æ—Ç–∞—Ü–∏—è –ª–æ–≥–æ–≤ –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–∞–µ—Ç –ø–µ—Ä–µ–ø–æ–ª–Ω–µ–Ω–∏–µ –¥–∏—Å–∫–∞

## ‚ö° –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å

- –ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –∑–∞–ø—Ä–æ—Å–æ–≤ (FastAPI)
- –ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–∞—è –∑–∞–ø–∏—Å—å –≤ —Ñ–∞–π–ª—ã –ª–æ–≥–æ–≤
- –ë—É—Ñ–µ—Ä–∏–∑–∞—Ü–∏—è –¥–ª—è –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏ I/O
- –†–æ—Ç–∞—Ü–∏—è –ª–æ–≥–æ–≤ –Ω–µ –±–ª–æ–∫–∏—Ä—É–µ—Ç –æ—Å–Ω–æ–≤–Ω–æ–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ
- –ú–∏–Ω–∏–º–∞–ª—å–Ω–æ–µ –≤–ª–∏—è–Ω–∏–µ –Ω–∞ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å API 