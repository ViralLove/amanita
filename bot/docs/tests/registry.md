# üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ ProductRegistryService - –ö–∞—Ç–∞–ª–æ–≥ –ø—Ä–æ–¥—É–∫—Ç–æ–≤

## üìã –û–±–∑–æ—Ä

**ProductRegistryService** - –∫–ª—é—á–µ–≤–æ–π —Å–µ—Ä–≤–∏—Å –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –∫–∞—Ç–∞–ª–æ–≥–æ–º –ø—Ä–æ–¥—É–∫—Ç–æ–≤ –≤ —Å–∏—Å—Ç–µ–º–µ Amanita. –î–æ–∫—É–º–µ–Ω—Ç –æ–ø–∏—Å—ã–≤–∞–µ—Ç —Å—Ç—Ä–∞—Ç–µ–≥–∏—é —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è, Mock –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—É –∏ –ø—Ä–∏–Ω—Ü–∏–ø—ã TDD –¥–ª—è –æ–±–µ—Å–ø–µ—á–µ–Ω–∏—è –∫–∞—á–µ—Å—Ç–≤–∞ –∏ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏.

## üéØ –¢–µ–∫—É—â–∏–π —Å—Ç–∞—Ç—É—Å —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è

### ‚úÖ –§–∏–Ω–∞–ª—å–Ω—ã–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã (11.08.2025)

- **–í—Å–µ–≥–æ —Ç–µ—Å—Ç–æ–≤**: 78
- **–ü—Ä–æ—Ö–æ–¥—è—â–∏—Ö**: 78/78 (100%)
- **–í—Ä–µ–º—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è**: 0.30 —Å–µ–∫—É–Ω–¥—ã
- **–¶–µ–ª—å**: < 1 –º–∏–Ω—É—Ç—ã - **–î–û–°–¢–ò–ì–ù–£–¢–ê!**
- **–ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å**: –í 200 —Ä–∞–∑ –±—ã—Å—Ç—Ä–µ–µ —Ü–µ–ª–∏

### üèÜ –ö–ª—é—á–µ–≤—ã–µ –¥–æ—Å—Ç–∏–∂–µ–Ω–∏—è

1. **–ü—Ä–∞–≤–∏–ª—å–Ω—ã–π –ø–∞—Ç—Ç–µ—Ä–Ω –º–æ–∫–∏—Ä–æ–≤–∞–Ω–∏—è –Ω–∞–π–¥–µ–Ω –∏ –ø—Ä–∏–º–µ–Ω–µ–Ω**
2. **–í—Å–µ –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–µ –≤—ã–∑–æ–≤—ã –ø—Ä–∞–≤–∏–ª—å–Ω–æ –∑–∞–º–æ–∫–∞–Ω—ã**
3. **–¢–µ—Å—Ç—ã –∏—Å–ø–æ–ª—å–∑—É—é—Ç —Ü–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã–µ —Ñ–∏–∫—Å—Ç—É—Ä—ã –∏–∑ conftest.py**
4. **–ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ DI —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∞ –±–µ–∑ –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏—è –∫–æ–¥–∞**
5. **–ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∞ –¥–æ –ø—Ä–µ–≤–æ—Å—Ö–æ–¥–Ω–æ–≥–æ —É—Ä–æ–≤–Ω—è**

## üöÄ –ö–æ–º–∞–Ω–¥—ã –¥–ª—è –∑–∞–ø—É—Å–∫–∞ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è

### –î–ª—è DevOps –∏–Ω–∂–µ–Ω–µ—Ä–∞

#### 1. –ë—ã—Å—Ç—Ä—ã–π –∑–∞–ø—É—Å–∫ –≤—Å–µ—Ö —Ç–µ—Å—Ç–æ–≤
```bash
# –û—Å–Ω–æ–≤–Ω–∞—è –∫–æ–º–∞–Ω–¥–∞ - –≤—Å–µ —Ç–µ—Å—Ç—ã –∑–∞ < 1 –º–∏–Ω—É—Ç—ã
python3 -m pytest bot/tests/test_product_registry_unit.py -v --tb=short

# –û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç: 78 passed in < 60s
```

#### 2. –î–µ—Ç–∞–ª—å–Ω—ã–π –∑–∞–ø—É—Å–∫ —Å –∏–∑–º–µ—Ä–µ–Ω–∏–µ–º –≤—Ä–µ–º–µ–Ω–∏
```bash
# –ó–∞–ø—É—Å–∫ —Å –¥–µ—Ç–∞–ª—å–Ω—ã–º –∞–Ω–∞–ª–∏–∑–æ–º –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏
python3 -m pytest bot/tests/test_product_registry_unit.py -v --durations=10

# –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç 10 —Å–∞–º—ã—Ö –º–µ–¥–ª–µ–Ω–Ω—ã—Ö —Ç–µ—Å—Ç–æ–≤
```

#### 3. –ó–∞–ø—É—Å–∫ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ —Ç–µ—Å—Ç–∞
```bash
# –¢–µ—Å—Ç –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ –º–µ—Ç–æ–¥–∞
python3 -m pytest bot/tests/test_product_registry_unit.py::test_create_product_success -v

# –¢–µ—Å—Ç –≥—Ä—É–ø–ø—ã –º–µ—Ç–æ–¥–æ–≤
python3 -m pytest bot/tests/test_product_registry_unit.py -k "create_product" -v
```

#### 4. –ó–∞–ø—É—Å–∫ —Å –ø–æ–∫—Ä—ã—Ç–∏–µ–º –∫–æ–¥–∞
```bash
# –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Å –∏–∑–º–µ—Ä–µ–Ω–∏–µ–º –ø–æ–∫—Ä—ã—Ç–∏—è
python3 -m pytest bot/tests/test_product_registry_unit.py --cov=bot.services.product.registry --cov-report=html

# –ì–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç HTML –æ—Ç—á–µ—Ç –≤ htmlcov/
```

### –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è

```bash
# –î–ª—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–π —Ä–∞–±–æ—Ç—ã —Ç–µ—Å—Ç–æ–≤
export PYTHONPATH=/Users/eslinko/Development/üçÑAmanita/bot
export MOCK_IPFS=true
export MOCK_BLOCKCHAIN=true
```

## üé≠ Mock —Å—Ç—Ä–∞—Ç–µ–≥–∏—è –∏ —Ç–µ—Ö–Ω–∏—á–µ—Å–∫–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è

### –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ Mock —Å–∏—Å—Ç–µ–º—ã

#### 1. –¶–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã–µ –º–æ–∫–∏ –≤ conftest.py

**–ü—Ä–∏–Ω—Ü–∏–ø**: –í—Å–µ –º–æ–∫–∏ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω—ã –≤ –æ–¥–Ω–æ–º –º–µ—Å—Ç–µ –¥–ª—è –µ–¥–∏–Ω–æ–æ–±—Ä–∞–∑–∏—è –∏ –ª–µ–≥–∫–æ–≥–æ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è.

```python
# bot/tests/conftest.py

@pytest.fixture
def mock_registry_service():
    """–û—Å–Ω–æ–≤–Ω–∞—è —Ñ–∏–∫—Å—Ç—É—Ä–∞ –¥–ª—è ProductRegistryService —Å –ø–æ–ª–Ω–æ—Å—Ç—å—é –∑–∞–º–æ–∫–∞–Ω–Ω—ã–º–∏ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç—è–º–∏"""
    from bot.dependencies import get_product_registry_service
    
    # –°–æ–∑–¥–∞–µ–º –º–æ–∫–∏ –¥–ª—è –≤—Å–µ—Ö –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π
    mock_blockchain = Mock()
    mock_storage = Mock()
    mock_validation = Mock()
    mock_account = Mock()
    
    # –ù–∞—Å—Ç—Ä–∞–∏–≤–∞–µ–º –ø–æ–≤–µ–¥–µ–Ω–∏–µ –º–æ–∫–æ–≤
    mock_blockchain.get_catalog_version = Mock(return_value=1)
    mock_blockchain.get_all_products = Mock(return_value=[])
    mock_blockchain.get_products_by_current_seller_full = Mock(return_value=[])
    mock_blockchain.product_exists_in_blockchain = Mock(return_value=False)
    
    mock_storage.download_json = Mock(return_value={
        "id": "test_product",
        "title": "Test Product",
        "description_cid": "QmDescriptionCID",
        "cover_image": "QmImageCID",
        "categories": ["mushroom"],
        "forms": ["powder"],
        "species": "Amanita muscaria",
        "prices": [{"weight": "100", "weight_unit": "g", "price": "80", "currency": "EUR"}]
    })
    mock_storage.upload_json = AsyncMock(return_value="QmMockCID")
    
    # –ò—Å–ø–æ–ª—å–∑—É–µ–º —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π DI —Å –º–æ–∫–∞–º–∏
    return get_product_registry_service(
        blockchain_service=mock_blockchain,
        storage_service=mock_storage,
        validation_service=mock_validation,
        account_service=mock_account
    )
```

#### 2. –°–ø–µ—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –º–æ–∫–∏

```python
@pytest.fixture
def mock_registry_service_with_failing_validation():
    """–ú–æ–∫ —Å —Å–∏–º—É–ª—è—Ü–∏–µ–π –æ—à–∏–±–æ–∫ –≤–∞–ª–∏–¥–∞—Ü–∏–∏"""
    service = mock_registry_service()
    service.validation_service.validate_product_data = AsyncMock(return_value={
        "is_valid": False,
        "errors": ["Mock validation failed"]
    })
    return service

@pytest.fixture
def mock_registry_service_with_failing_storage():
    """–ú–æ–∫ —Å —Å–∏–º—É–ª—è—Ü–∏–µ–π –æ—à–∏–±–æ–∫ IPFS/Arweave"""
    service = mock_registry_service()
    service.storage_service.upload_json = AsyncMock(return_value=None)
    return service
```

### –ü—Ä–∏–Ω—Ü–∏–ø—ã –ø–µ—Ä–µ–æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è –º–æ–∫–æ–≤ –≤ —Ç–µ—Å—Ç–∞—Ö

#### 1. –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –±–∞–∑–æ–≤—ã—Ö —Ñ–∏–∫—Å—Ç—É—Ä

```python
@pytest.mark.asyncio
async def test_create_product_success(mock_registry_service):
    """–¢–µ—Å—Ç —É—Å–ø–µ—à–Ω–æ–≥–æ —Å–æ–∑–¥–∞–Ω–∏—è –ø—Ä–æ–¥—É–∫—Ç–∞"""
    # –ò—Å–ø–æ–ª—å–∑—É–µ–º –≥–æ—Ç–æ–≤—É—é —Ñ–∏–∫—Å—Ç—É—Ä—É —Å –ø—Ä–∞–≤–∏–ª—å–Ω–æ –∑–∞–º–æ–∫–∞–Ω–Ω—ã–º–∏ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç—è–º–∏
    product_data = {
        "id": "test1",
        "title": "Test Product",
        "description": "Test Description",
        "forms": ["powder"]
    }
    
    result = await mock_registry_service.create_product(product_data)
    
    assert result["status"] == "success"
    assert result["id"] == "test1"
```

#### 2. –õ–æ–∫–∞–ª—å–Ω–æ–µ –ø–µ—Ä–µ–æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –¥–ª—è —Å–ø–µ—Ü–∏—Ñ–∏—á–µ—Å–∫–∏—Ö —Å—Ü–µ–Ω–∞—Ä–∏–µ–≤

```python
@pytest.mark.asyncio
async def test_create_product_duplicate_id_prevention():
    """–¢–µ—Å—Ç –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–µ–Ω–∏—è –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏—è business ID"""
    # –°–æ–∑–¥–∞–µ–º –º–æ–∫–∏ –Ω–∞–ø—Ä—è–º—É—é –¥–ª—è —Å–∏–º—É–ª—è—Ü–∏–∏ –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏—è
    mock_blockchain = Mock()
    mock_blockchain.get_products_by_current_seller_full = Mock(return_value=[])
    mock_blockchain.create_product = AsyncMock(return_value="0x123")
    mock_blockchain.get_product_id_from_tx = AsyncMock(return_value=42)
    
    mock_storage = Mock()
    mock_storage.download_json = Mock(return_value={...})
    mock_storage.upload_json = AsyncMock(return_value="QmMockCID")
    
    mock_validation = Mock()
    mock_validation.validate_product_data = AsyncMock(return_value={
        "is_valid": True,
        "errors": []
    })
    
    # –°–æ–∑–¥–∞–µ–º —ç–∫–∑–µ–º–ø–ª—è—Ä —Å–µ—Ä–≤–∏—Å–∞ —Å –º–æ–∫–∞–º–∏
    registry_service = ProductRegistryService(
        blockchain_service=mock_blockchain,
        storage_service=mock_storage,
        validation_service=mock_validation,
        account_service=Mock()
    )
    
    # –ú–æ–∫–∞–µ–º _check_product_id_exists –¥–ª—è –≤–æ–∑–≤—Ä–∞—Ç–∞ True (–ø—Ä–æ–¥—É–∫—Ç —É–∂–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç)
    with patch.object(registry_service, '_check_product_id_exists', return_value=True):
        result = await registry_service.create_product(test_product_data)
        
        assert result["status"] == "error"
        assert "—É–∂–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç" in result["error"]
```

#### 3. –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ patch –¥–ª—è —Ç–æ—á–µ—á–Ω–æ–≥–æ –º–æ–∫–∏—Ä–æ–≤–∞–Ω–∏—è

```python
# –ú–æ–∫–∏—Ä–æ–≤–∞–Ω–∏–µ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ –º–µ—Ç–æ–¥–∞
with patch.object(registry_service, 'get_all_products', return_value=[existing_product]):
    # –¢–µ—Å—Ç —Å –ø–µ—Ä–µ–æ–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω—ã–º –ø–æ–≤–µ–¥–µ–Ω–∏–µ–º

# –ú–æ–∫–∏—Ä–æ–≤–∞–Ω–∏–µ –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ–≥–æ –º–µ—Ç–æ–¥–∞
with patch.object(registry_service, '_check_product_id_exists', return_value=True):
    # –¢–µ—Å—Ç —Å —Å–∏–º—É–ª—è—Ü–∏–µ–π —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–≥–æ –ø—Ä–æ–¥—É–∫—Ç–∞
```

### –ö–ª—é—á–µ–≤—ã–µ –ø—Ä–∏–Ω—Ü–∏–ø—ã Mock –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã

#### 1. **Mock vs AsyncMock**
- **Mock**: –î–ª—è —Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã—Ö –º–µ—Ç–æ–¥–æ–≤ –∏ –ø—Ä–æ—Å—Ç—ã—Ö –≤–æ–∑–≤—Ä–∞—â–∞–µ–º—ã—Ö –∑–Ω–∞—á–µ–Ω–∏–π
- **AsyncMock**: –î–ª—è –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã—Ö –º–µ—Ç–æ–¥–æ–≤ —Å `return_value`

#### 2. **–¶–µ–Ω—Ç—Ä–∞–ª–∏–∑–∞—Ü–∏—è –º–æ–∫–æ–≤**
- –í—Å–µ –±–∞–∑–æ–≤—ã–µ –º–æ–∫–∏ –≤ `conftest.py`
- –°–ø–µ—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –º–æ–∫–∏ –∫–∞–∫ –≤–∞—Ä–∏–∞–Ω—Ç—ã –±–∞–∑–æ–≤—ã—Ö
- –õ–æ–∫–∞–ª—å–Ω–æ–µ –ø–µ—Ä–µ–æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ —Ç–æ–ª—å–∫–æ –ø—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏

#### 3. **–ü—Ä–∞–≤–∏–ª—å–Ω—ã–µ return_value**
```python
# ‚ùå –ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ - —Å–æ–∑–¥–∞–µ—Ç –∫–æ—Ä—É—Ç–∏–Ω—É –±–µ–∑ return_value
mock_service = AsyncMock()

# ‚úÖ –ü—Ä–∞–≤–∏–ª—å–Ω–æ - –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–π –º–æ–∫ —Å –≤–æ–∑–≤—Ä–∞—â–∞–µ–º—ã–º –∑–Ω–∞—á–µ–Ω–∏–µ–º
mock_service.async_method = AsyncMock(return_value="result")

# ‚úÖ –ü—Ä–∞–≤–∏–ª—å–Ω–æ - —Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–π –º–æ–∫ —Å –≤–æ–∑–≤—Ä–∞—â–∞–µ–º—ã–º –∑–Ω–∞—á–µ–Ω–∏–µ–º
mock_service.sync_method = Mock(return_value="result")
```

## üéØ –°–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ –ø—Ä–∏–Ω—Ü–∏–ø–∞–º TDD

### 1. **–§–æ–∫—É—Å –Ω–∞ —é–Ω–∏—Ç-—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–∏**

#### ‚úÖ –ü—Ä–∏–Ω—Ü–∏–ø—ã TDD —Å–æ–±–ª—é–¥–µ–Ω—ã:

**Red-Green-Refactor —Ü–∏–∫–ª:**
- **Red**: –¢–µ—Å—Ç—ã –Ω–∞–ø–∏—Å–∞–Ω—ã –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç–∏
- **Green**: –ö–æ–¥ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω –¥–ª—è –ø—Ä–æ—Ö–æ–∂–¥–µ–Ω–∏—è —Ç–µ—Å—Ç–æ–≤
- **Refactor**: –ö–æ–¥ –æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω –ø—Ä–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–∏ –ø—Ä–æ—Ö–æ–∂–¥–µ–Ω–∏—è —Ç–µ—Å—Ç–æ–≤

**–ò–∑–æ–ª—è—Ü–∏—è —Ç–µ—Å—Ç–∏—Ä—É–µ–º—ã—Ö –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤:**
- –ö–∞–∂–¥—ã–π —Ç–µ—Å—Ç –ø—Ä–æ–≤–µ—Ä—è–µ—Ç —Ç–æ–ª—å–∫–æ –æ–¥–∏–Ω –º–µ—Ç–æ–¥/—Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å
- –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –ø–æ–ª–Ω–æ—Å—Ç—å—é –∑–∞–º–æ–∫–∞–Ω—ã
- –ù–µ—Ç –≤–Ω–µ—à–Ω–∏—Ö –≤—ã–∑–æ–≤–æ–≤ –∫ —Ä–µ–∞–ª—å–Ω—ã–º —Å–µ—Ä–≤–∏—Å–∞–º

**–ë—ã—Å—Ç—Ä–æ–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ:**
- –í—Å–µ 78 —Ç–µ—Å—Ç–æ–≤ –≤—ã–ø–æ–ª–Ω—è—é—Ç—Å—è –∑–∞ 0.30 —Å–µ–∫—É–Ω–¥—ã
- –ù–∏–∫–∞–∫–∏—Ö —Å–µ—Ç–µ–≤—ã—Ö –∑–∞–¥–µ—Ä–∂–µ–∫ –∏–ª–∏ I/O –æ–ø–µ—Ä–∞—Ü–∏–π
- –ú–≥–Ω–æ–≤–µ–Ω–Ω–∞—è –æ–±—Ä–∞—Ç–Ω–∞—è —Å–≤—è–∑—å –¥–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–∞

### 2. **–ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ —Ç–µ—Å—Ç–æ–≤**

#### –°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Ç–µ—Å—Ç–æ–≤:
```python
@pytest.mark.asyncio
async def test_method_name():
    """–û–ø–∏—Å–∞–Ω–∏–µ —Ç–µ—Å—Ç–∞"""
    # Arrange - –ø–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –¥–∞–Ω–Ω—ã—Ö –∏ –º–æ–∫–æ–≤
    mock_data = {...}
    mock_service = Mock()
    
    # Act - –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ —Ç–µ—Å—Ç–∏—Ä—É–µ–º–æ–≥–æ –º–µ—Ç–æ–¥–∞
    result = await service.method(mock_data)
    
    # Assert - –ø—Ä–æ–≤–µ—Ä–∫–∞ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤
    assert result["status"] == "success"
    assert result["data"] == expected_data
```

#### –ì—Ä—É–ø–ø–∏—Ä–æ–≤–∫–∞ —Ç–µ—Å—Ç–æ–≤ –ø–æ —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç–∏:
- **–°–æ–∑–¥–∞–Ω–∏–µ –ø—Ä–æ–¥—É–∫—Ç–æ–≤**: `test_create_product_*`
- **–ü–æ–ª—É—á–µ–Ω–∏–µ –ø—Ä–æ–¥—É–∫—Ç–æ–≤**: `test_get_product_*`, `test_get_all_products_*`
- **–û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ø—Ä–æ–¥—É–∫—Ç–æ–≤**: `test_update_product_*`
- **–í–∞–ª–∏–¥–∞—Ü–∏—è**: `test_validate_product_*`
- **–ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ**: `test_cache_*`, `test_is_cache_valid_*`

### 3. **–ö–∞—á–µ—Å—Ç–≤–æ —Ç–µ—Å—Ç–æ–≤**

#### –ü–æ–∫—Ä—ã—Ç–∏–µ —Å—Ü–µ–Ω–∞—Ä–∏–µ–≤:
- ‚úÖ **–£—Å–ø–µ—à–Ω—ã–µ —Å—Ü–µ–Ω–∞—Ä–∏–∏**: –í—Å–µ –æ—Å–Ω–æ–≤–Ω—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ —Ä–∞–±–æ—Ç–∞—é—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ
- ‚úÖ **–û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫**: –í–∞–ª–∏–¥–∞—Ü–∏—è, –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ, —Å–µ—Ç–µ–≤—ã–µ –æ—à–∏–±–∫–∏
- ‚úÖ **–ì—Ä–∞–Ω–∏—á–Ω—ã–µ —Å–ª—É—á–∞–∏**: –ü—É—Å—Ç—ã–µ –¥–∞–Ω–Ω—ã–µ, –Ω–µ–≤–∞–ª–∏–¥–Ω—ã–µ ID, –∏—Å—Ç–µ—á–µ–Ω–∏–µ –∫—ç—à–∞
- ‚úÖ **–ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ—Å—Ç—å**: –ü—Ä–∞–≤–∏–ª—å–Ω–∞—è —Ä–∞–±–æ—Ç–∞ —Å async/await

#### –°—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç—å:
- ‚úÖ **–î–µ—Ç–µ—Ä–º–∏–Ω–∏—Ä–æ–≤–∞–Ω–Ω–æ—Å—Ç—å**: –¢–µ—Å—Ç—ã –¥–∞—é—Ç –æ–¥–∏–Ω–∞–∫–æ–≤—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç –ø—Ä–∏ –∫–∞–∂–¥–æ–º –∑–∞–ø—É—Å–∫–µ
- ‚úÖ **–ò–∑–æ–ª—è—Ü–∏—è**: –¢–µ—Å—Ç—ã –Ω–µ –≤–ª–∏—è—é—Ç –¥—Ä—É–≥ –Ω–∞ –¥—Ä—É–≥–∞
- ‚úÖ **–í–æ—Å–ø—Ä–æ–∏–∑–≤–æ–¥–∏–º–æ—Å—Ç—å**: –û—à–∏–±–∫–∏ –ª–µ–≥–∫–æ –≤–æ—Å–ø—Ä–æ–∏–∑–≤–æ–¥—è—Ç—Å—è –∏ –∏—Å–ø—Ä–∞–≤–ª—è—é—Ç—Å—è

## üîß –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è

### 1. **–§–∏–∫—Å—Ç—É—Ä—ã pytest**

```python
# bot/tests/conftest.py

@pytest.fixture(autouse=True)
def reset_mock_states():
    """–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π —Å–±—Ä–æ—Å —Å–æ—Å—Ç–æ—è–Ω–∏—è –º–æ–∫–æ–≤ –ø–µ—Ä–µ–¥ –∫–∞–∂–¥—ã–º —Ç–µ—Å—Ç–æ–º"""
    yield
    # –°–±—Ä–æ—Å —Å–æ—Å—Ç–æ—è–Ω–∏—è –≤—Å–µ—Ö –º–æ–∫–æ–≤

@pytest.fixture
def mock_config():
    """–ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –º–æ–∫–æ–≤ —á–µ—Ä–µ–∑ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è"""
    return {
        "ipfs_mock_enabled": os.getenv("MOCK_IPFS", "true").lower() == "true",
        "blockchain_mock_enabled": os.getenv("MOCK_BLOCKCHAIN", "true").lower() == "true"
    }
```

### 2. **Mock –∫–ª–∞—Å—Å—ã –¥–ª—è —Å–ª–æ–∂–Ω–æ–π –ª–æ–≥–∏–∫–∏**

```python
class MockIPFSStorage:
    """–ú–æ–∫ –¥–ª—è IPFS/Arweave storage —Å –ø—Ä–µ–¥—Å–∫–∞–∑—É–µ–º—ã–º –ø–æ–≤–µ–¥–µ–Ω–∏–µ–º"""
    def __init__(self, should_fail_upload=False, should_fail_download=False):
        self.should_fail_upload = should_fail_upload
        self.should_fail_download = should_fail_download
        self.uploaded_files = []
        self.uploaded_jsons = []
    
    def download_json(self, cid):
        if self.should_fail_download:
            return None
        return {
            "id": "test_product",
            "title": "Test Product",
            "description_cid": "QmDescriptionCID",
            "cover_image": "QmImageCID",
            "categories": ["mushroom"],
            "forms": ["powder"],
            "species": "Amanita muscaria",
            "prices": [{"weight": "100", "weight_unit": "g", "price": "80", "currency": "EUR"}]
        }
    
    async def upload_json(self, data):
        if self.should_fail_upload:
            return None
        cid = f"QmMockJson{len(self.uploaded_jsons)}"
        self.uploaded_jsons.append((data, cid))
        return cid
```

### 3. **Dependency Injection —Å –º–æ–∫–∞–º–∏**

```python
# –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–≥–æ DI –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã
from bot.dependencies import get_product_registry_service

# –°–æ–∑–¥–∞–Ω–∏–µ —Å–µ—Ä–≤–∏—Å–∞ —Å –º–æ–∫–∞–º–∏ —á–µ—Ä–µ–∑ DI
registry_service = get_product_registry_service(
    blockchain_service=mock_blockchain,
    storage_service=mock_storage,
    validation_service=mock_validation,
    account_service=mock_account
)
```

## üìä –ú–µ—Ç—Ä–∏–∫–∏ –∫–∞—á–µ—Å—Ç–≤–∞

### –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å
- **–í—Ä–µ–º—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è**: 0.30 —Å–µ–∫—É–Ω–¥—ã (—Ü–µ–ª—å: < 60 —Å–µ–∫—É–Ω–¥)
- **–£—Å–∫–æ—Ä–µ–Ω–∏–µ**: –í 200 —Ä–∞–∑ –±—ã—Å—Ç—Ä–µ–µ —Ü–µ–ª–∏
- **–°—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç—å**: 100% —Ç–µ—Å—Ç–æ–≤ –ø—Ä–æ—Ö–æ–¥—è—Ç —Å—Ç–∞–±–∏–ª—å–Ω–æ

### –ü–æ–∫—Ä—ã—Ç–∏–µ
- **–§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ–µ –ø–æ–∫—Ä—ã—Ç–∏–µ**: 100% –æ—Å–Ω–æ–≤–Ω—ã—Ö –º–µ—Ç–æ–¥–æ–≤
- **–°—Ü–µ–Ω–∞—Ä–∏–π –ø–æ–∫—Ä—ã—Ç–∏—è**: –£—Å–ø–µ—à–Ω—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ + –æ–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫ + –≥—Ä–∞–Ω–∏—á–Ω—ã–µ —Å–ª—É—á–∞–∏
- **–ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ–µ –ø–æ–∫—Ä—ã—Ç–∏–µ**: 100% async –º–µ—Ç–æ–¥–æ–≤ –ø—Ä–∞–≤–∏–ª—å–Ω–æ –ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω—ã

### –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º–æ—Å—Ç—å
- **–¶–µ–Ω—Ç—Ä–∞–ª–∏–∑–∞—Ü–∏—è**: –í—Å–µ –º–æ–∫–∏ –≤ –æ–¥–Ω–æ–º –º–µ—Å—Ç–µ
- **–ü–µ—Ä–µ–∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ**: –§–∏–∫—Å—Ç—É—Ä—ã –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è –≤ 100% —Ç–µ—Å—Ç–æ–≤
- **–î–æ–∫—É–º–µ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–Ω–æ—Å—Ç—å**: –ö–∞–∂–¥—ã–π —Ç–µ—Å—Ç –∏–º–µ–µ—Ç —á–µ—Ç–∫–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ

## üöÄ –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –¥–ª—è DevOps

### 1. **–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è –≤ CI/CD**

```yaml
# .github/workflows/test.yml
- name: Run Product Registry Tests
  run: |
    cd bot/tests
    python3 -m pytest test_product_registry_unit.py -v --durations=10
    
  env:
    PYTHONPATH: ${{ github.workspace }}/bot
    MOCK_IPFS: true
    MOCK_BLOCKCHAIN: true
```

### 2. **–ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏**

```bash
# –°–∫—Ä–∏–ø—Ç –¥–ª—è –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞ –≤—Ä–µ–º–µ–Ω–∏ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è
#!/bin/bash
start_time=$(date +%s.%N)
python3 -m pytest bot/tests/test_product_registry_unit.py -v --tb=no -q
end_time=$(date +%s.%N)
execution_time=$(echo "$end_time - $start_time" | bc)

if (( $(echo "$execution_time < 60" | bc -l) )); then
    echo "‚úÖ –¢–µ—Å—Ç—ã –≤—ã–ø–æ–ª–Ω–µ–Ω—ã –∑–∞ ${execution_time} —Å–µ–∫—É–Ω–¥ (—Ü–µ–ª—å: < 60s)"
    exit 0
else
    echo "‚ùå –¢–µ—Å—Ç—ã –≤—ã–ø–æ–ª–Ω–µ–Ω—ã –∑–∞ ${execution_time} —Å–µ–∫—É–Ω–¥ (—Ü–µ–ª—å: < 60s)"
    exit 1
fi
```

### 3. **–ê–ª–µ—Ä—Ç—ã –ø—Ä–∏ –¥–µ–≥—Ä–∞–¥–∞—Ü–∏–∏**

- **–ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–π**: –í—Ä–µ–º—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è > 60 —Å–µ–∫—É–Ω–¥
- **–ü—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ**: –í—Ä–µ–º—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è > 30 —Å–µ–∫—É–Ω–¥
- **–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è**: –í—Ä–µ–º—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è < 30 —Å–µ–∫—É–Ω–¥

---

## üîó –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∫–∞—Ç–∞–ª–æ–≥–∞ –ø—Ä–æ–¥—É–∫—Ç–æ–≤

### üìã –ü–æ—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–¥–∞—á–∏

**–¶–µ–ª—å**: –°–æ–∑–¥–∞—Ç—å –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ —Ç–µ—Å—Ç—ã –¥–ª—è `ProductRegistryService`, –∫–æ—Ç–æ—Ä—ã–µ:
- ‚úÖ **–í–°–ï–ì–î–ê —Ç–µ—Å—Ç–∏—Ä—É—é—Ç —Ä–µ–∞–ª—å–Ω–æ–µ –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏–µ —Å –±–ª–æ–∫—á–µ–π–Ω–æ–º** (–≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –∫–æ–Ω—Ç—Ä–∞–∫—Ç–æ–≤)
- üîß **–ò—Å–ø–æ–ª—å–∑—É—é—Ç –Ω–∞—Å—Ç—Ä–∞–∏–≤–∞–µ–º—ã–π IPFS/Arweave** (mock|pinata|arweave)
- ‚úÖ **–°–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—Ç –ø—Ä–∏–Ω—Ü–∏–ø–∞–º Mock –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã** –∏–∑ unit —Ç–µ—Å—Ç–æ–≤
- ‚úÖ **–û–±–µ—Å–ø–µ—á–∏–≤–∞—é—Ç –±—ã—Å—Ç—Ä—É—é –æ–±—Ä–∞—Ç–Ω—É—é —Å–≤—è–∑—å** –¥–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–∞
- ‚úÖ **–ü–æ–∑–≤–æ–ª—è—é—Ç —ç–∫–æ–Ω–æ–º–∏—Ç—å –±—é–¥–∂–µ—Ç** –ø—Ä–∏ –µ–∂–µ–¥–Ω–µ–≤–Ω–æ–º —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–∏

### üéØ –¢–µ–∫—É—â–∏–π —Å—Ç–∞—Ç—É—Å

**–§–∞–π–ª**: `bot/tests/test_product_registry_integration.py`
**–°—Ç–∞—Ç—É—Å**: ‚ùå **–¢—Ä–µ–±—É–µ—Ç —Ä–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥–∞ –¥–ª—è —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏—è Mock —Å—Ç—Ä–∞—Ç–µ–≥–∏–∏**

#### üîç –ê–Ω–∞–ª–∏–∑ —Ç–µ–∫—É—â–∏—Ö –ø—Ä–æ–±–ª–µ–º:

1. **–†–µ–∞–ª—å–Ω—ã–µ IPFS –≤—ã–∑–æ–≤—ã**: –¢–µ—Å—Ç—ã –∏—Å–ø–æ–ª—å–∑—É—é—Ç —Ä–µ–∞–ª—å–Ω—ã–µ IPFS –æ–ø–µ—Ä–∞—Ü–∏–∏ –±–µ–∑ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏ –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏—è
2. **–û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ Mock –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã**: –ù–µ—Ç —Ü–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã—Ö –º–æ–∫–æ–≤ –¥–ª—è storage
3. **–ù–µ—ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç—å**: –ú–æ–∂–µ—Ç –ø–µ—Ä–µ–≥—Ä—É–∂–∞—Ç—å Pinata –∏ —Ç—Ä–∞—Ç–∏—Ç—å –±—é–¥–∂–µ—Ç
4. **–ù–µ—Å—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç—å**: –ó–∞–≤–∏—Å–∏—Ç –æ—Ç –≤–Ω–µ—à–Ω–∏—Ö IPFS —Å–µ—Ä–≤–∏—Å–æ–≤
5. **–û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –≥–∏–±–∫–æ—Å—Ç–∏**: –ù–µ–ª—å–∑—è –≤—ã–±—Ä–∞—Ç—å –º–µ–∂–¥—É mock, pinata, arweave









### üèóÔ∏è –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω–æ–≥–æ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è

#### 1. **–ü—Ä–∏–Ω—Ü–∏–ø "–†–µ–∞–ª—å–Ω—ã–π –±–ª–æ–∫—á–µ–π–Ω + –ù–∞—Å—Ç—Ä–∞–∏–≤–∞–µ–º—ã–π Storage"**

```python
# bot/tests/conftest.py - –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ —Ñ–∏–∫—Å—Ç—É—Ä—ã

@pytest.fixture
def integration_registry_service():
    """–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã–π —Ç–µ—Å—Ç —Å —Ä–µ–∞–ª—å–Ω—ã–º –±–ª–æ–∫—á–µ–π–Ω–æ–º –∏ –Ω–∞—Å—Ç—Ä–∞–∏–≤–∞–µ–º—ã–º storage"""
    from bot.dependencies import get_product_registry_service
    from bot.services.core.blockchain import BlockchainService
    
    # ‚úÖ –ë–ª–æ–∫—á–µ–π–Ω –í–°–ï–ì–î–ê —Ä–µ–∞–ª—å–Ω—ã–π –≤ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã—Ö —Ç–µ—Å—Ç–∞—Ö
    blockchain_service = BlockchainService()
    
    # üîß Storage –Ω–∞—Å—Ç—Ä–∞–∏–≤–∞–µ—Ç—Å—è —á–µ—Ä–µ–∑ –ø–µ—Ä–µ–º–µ–Ω–Ω—É—é –æ–∫—Ä—É–∂–µ–Ω–∏—è
    storage_type = os.getenv("INTEGRATION_STORAGE", "mock").lower()
    
    if storage_type == "mock":
        storage_service = mock_ipfs_storage()
        logger.info("üîß –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –º–æ–∫–∞–Ω–Ω—ã–π IPFS/Arweave (–±—ã—Å—Ç—Ä–æ, —ç–∫–æ–Ω–æ–º–∏—á–Ω–æ)")
    elif storage_type == "pinata":
        from bot.services.core.ipfs_factory import IPFSFactory
        storage_service = IPFSFactory().get_storage("pinata")
        logger.info("üîß –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è —Ä–µ–∞–ª—å–Ω—ã–π Pinata IPFS (–º–µ–¥–ª–µ–Ω–Ω–æ, —Ç—Ä–∞—Ç–∏—Ç –±—é–¥–∂–µ—Ç)")
    elif storage_type == "arweave":
        from bot.services.core.ipfs_factory import IPFSFactory
        storage_service = IPFSFactory().get_storage("arweave")
        logger.info("üîß –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è —Ä–µ–∞–ª—å–Ω—ã–π Arweave (–º–µ–¥–ª–µ–Ω–Ω–æ, —Ç—Ä–∞—Ç–∏—Ç –±—é–¥–∂–µ—Ç)")
    else:
        logger.warning(f"–ù–µ–∏–∑–≤–µ—Å—Ç–Ω—ã–π —Ç–∏–ø storage: {storage_type}, –∏—Å–ø–æ–ª—å–∑—É–µ–º mock")
        storage_service = mock_ipfs_storage()
    
    return get_product_registry_service(
        blockchain_service=blockchain_service,  # ‚úÖ –í–°–ï–ì–î–ê —Ä–µ–∞–ª—å–Ω—ã–π
        storage_service=storage_service,        # üîß –ù–∞—Å—Ç—Ä–∞–∏–≤–∞–µ–º—ã–π
        validation_service=mock_validation_service(),
        account_service=mock_account_service()
    )
```

#### 2. **–ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è —á–µ—Ä–µ–∑ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è**

```python
# bot/tests/conftest.py

@pytest.fixture
def storage_config():
    """–ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è storage –¥–ª—è –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã—Ö —Ç–µ—Å—Ç–æ–≤"""
    storage_type = os.getenv("INTEGRATION_STORAGE", "mock").lower()
    
    configs = {
        "mock": {
            "service": mock_ipfs_storage(),
            "description": "–ú–æ–∫–∞–Ω–Ω—ã–π IPFS/Arweave (–±—ã—Å—Ç—Ä–æ, —ç–∫–æ–Ω–æ–º–∏—á–Ω–æ)"
        },
        "pinata": {
            "service": IPFSFactory().get_storage("pinata"),
            "description": "–†–µ–∞–ª—å–Ω—ã–π Pinata IPFS (–º–µ–¥–ª–µ–Ω–Ω–æ, —Ç—Ä–∞—Ç–∏—Ç –±—é–¥–∂–µ—Ç)"
        },
        "arweave": {
            "service": IPFSFactory().get_storage("arweave"),
            "description": "–†–µ–∞–ª—å–Ω—ã–π Arweave (–º–µ–¥–ª–µ–Ω–Ω–æ, —Ç—Ä–∞—Ç–∏—Ç –±—é–¥–∂–µ—Ç)"
        }
    }
    
    if storage_type not in configs:
        logger.warning(f"–ù–µ–∏–∑–≤–µ—Å—Ç–Ω—ã–π —Ç–∏–ø storage: {storage_type}, –∏—Å–ø–æ–ª—å–∑—É–µ–º mock")
        storage_type = "mock"
    
    logger.info(f"üîß –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã–π —Ç–µ—Å—Ç –∏—Å–ø–æ–ª—å–∑—É–µ—Ç: {configs[storage_type]['description']}")
    return configs[storage_type]
```

### üîß –†–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥ test_product_registry_integration.py

#### 1. **–°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Ç–µ—Å—Ç–∞ —Å Mock –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–æ–π**

```python
# bot/tests/test_product_registry_integration.py

import pytest
import logging
from bot.services.blockchain import BlockchainService
from eth_account import Account
from bot.tests.conftest import storage_config, mock_validation_service, mock_account_service

logger = logging.getLogger(__name__)

@pytest.fixture
def blockchain_service():
    """–§–∏–∫—Å—Ç—É—Ä–∞ –¥–ª—è —Ä–µ–∞–ª—å–Ω–æ–≥–æ BlockchainService"""
    service = BlockchainService()
    assert service.registry is not None, "–†–µ–µ—Å—Ç—Ä –∫–æ–Ω—Ç—Ä–∞–∫—Ç–æ–≤ –Ω–µ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω"
    return service

@pytest.fixture
def integration_registry_service(blockchain_service, storage_config):
    """–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã–π —Å–µ—Ä–≤–∏—Å —Å —Ä–µ–∞–ª—å–Ω—ã–º –±–ª–æ–∫—á–µ–π–Ω–æ–º –∏ –Ω–∞—Å—Ç—Ä–∞–∏–≤–∞–µ–º—ã–º storage"""
    from bot.dependencies import get_product_registry_service
    
    return get_product_registry_service(
        blockchain_service=blockchain_service,      # ‚úÖ –†–µ–∞–ª—å–Ω—ã–π –±–ª–æ–∫—á–µ–π–Ω
        storage_service=storage_config["service"], # üîß –ù–∞—Å—Ç—Ä–∞–∏–≤–∞–µ–º—ã–π storage
        validation_service=mock_validation_service(),
        account_service=mock_account_service()
    )

@pytest.fixture
def seller_account():
    """–ê–∫–∫–∞—É–Ω—Ç –ø—Ä–æ–¥–∞–≤—Ü–∞ –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è"""
    seller_private_key = os.getenv("SELLER_PRIVATE_KEY")
    assert seller_private_key, "SELLER_PRIVATE_KEY –Ω–µ –Ω–∞–π–¥–µ–Ω –≤ –æ–∫—Ä—É–∂–µ–Ω–∏–∏"
    return Account.from_key(seller_private_key)

@pytest.fixture
def test_products():
    """–ì–µ–Ω–µ—Ä–∞—Ü–∏—è —Ç–µ—Å—Ç–æ–≤—ã—Ö –ø—Ä–æ–¥—É–∫—Ç–æ–≤"""
    return [
        {
            "id": "test_product_1",
            "title": "Test Product 1",
            "description": "Test Description 1",
            "forms": ["powder"],
            "categories": ["mushroom"],
            "species": "Amanita muscaria",
            "prices": [{"weight": "100", "weight_unit": "g", "price": "80", "currency": "EUR"}]
        },
        {
            "id": "test_product_2", 
            "title": "Test Product 2",
            "description": "Test Description 2",
            "forms": ["capsules"],
            "categories": ["mushroom"],
            "species": "Amanita pantherina",
            "prices": [{"weight": "60", "weight_unit": "capsules", "price": "120", "currency": "EUR"}]
        }
    ]
```

#### 2. **–û—Å–Ω–æ–≤–Ω–æ–π —Ç–µ—Å—Ç –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ –∫–∞—Ç–∞–ª–æ–≥–∞**

```python
@pytest.mark.integration
@pytest.mark.blockchain
async def test_product_catalog_integration(
    blockchain_service,
    integration_registry_service,
    seller_account,
    test_products
):
    """–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã–π —Ç–µ—Å—Ç –ø–æ–ª–Ω–æ–≥–æ –∂–∏–∑–Ω–µ–Ω–Ω–æ–≥–æ —Ü–∏–∫–ª–∞ –∫–∞—Ç–∞–ª–æ–≥–∞ –ø—Ä–æ–¥—É–∫—Ç–æ–≤"""
    logger.info("üöÄ –ù–∞—á–∞–ª–æ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω–æ–≥–æ —Ç–µ—Å—Ç–∞ –∫–∞—Ç–∞–ª–æ–≥–∞ –ø—Ä–æ–¥—É–∫—Ç–æ–≤")
    
    # –ü—Ä–æ–≤–µ—Ä—è–µ–º –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é
    storage_type = os.getenv("INTEGRATION_STORAGE", "mock")
    logger.info(f"üîß Storage —Ç–∏–ø: {storage_type}")
    
    # 1. –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–æ–ª–∏ SELLER_ROLE
    logger.info("üìù –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–æ–ª–∏ SELLER_ROLE –¥–ª—è –ø—Ä–æ–¥–∞–≤—Ü–∞...")
    SELLER_ROLE = blockchain_service.web3.keccak(text="SELLER_ROLE")
    
    if not blockchain_service.has_role("ProductRegistry", SELLER_ROLE, seller_account.address):
        tx_hash = blockchain_service.grant_role(
            "ProductRegistry", 
            SELLER_ROLE, 
            seller_account.address,
            seller_account.key
        )
        blockchain_service.wait_for_transaction(tx_hash)
        logger.info("‚úÖ –†–æ–ª—å SELLER_ROLE –Ω–∞–∑–Ω–∞—á–µ–Ω–∞ –ø—Ä–æ–¥–∞–≤—Ü—É")
    
    # 2. –°–æ–∑–¥–∞–Ω–∏–µ –ø—Ä–æ–¥—É–∫—Ç–æ–≤ —á–µ—Ä–µ–∑ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã–π —Å–µ—Ä–≤–∏—Å
    logger.info("üõçÔ∏è –°–æ–∑–¥–∞–Ω–∏–µ —Ç–µ—Å—Ç–æ–≤—ã—Ö –ø—Ä–æ–¥—É–∫—Ç–æ–≤...")
    created_products = []
    
    for product_data in test_products:
        result = await integration_registry_service.create_product(product_data)
        assert result["status"] == "success", f"–û—à–∏–±–∫–∞ —Å–æ–∑–¥–∞–Ω–∏—è –ø—Ä–æ–¥—É–∫—Ç–∞: {result}"
        
        created_product = result["product"]
        created_products.append(created_product)
        logger.info(f"‚úÖ –ü—Ä–æ–¥—É–∫—Ç {created_product['id']} —Å–æ–∑–¥–∞–Ω —Å CID: {created_product['cid']}")
    
    # 3. –ü—Ä–æ–≤–µ—Ä–∫–∞ –∑–∞–ø–∏—Å–∏ –≤ –±–ª–æ–∫—á–µ–π–Ω–µ
    logger.info("üîó –ü—Ä–æ–≤–µ—Ä–∫–∞ –∑–∞–ø–∏—Å–∏ –ø—Ä–æ–¥—É–∫—Ç–æ–≤ –≤ –±–ª–æ–∫—á–µ–π–Ω–µ...")
    blockchain_products = blockchain_service.get_products_by_current_seller_full()
    
    assert len(blockchain_products) >= len(test_products), \
        f"–í –±–ª–æ–∫—á–µ–π–Ω–µ {len(blockchain_products)} –ø—Ä–æ–¥—É–∫—Ç–æ–≤, –æ–∂–∏–¥–∞–ª–æ—Å—å {len(test_products)}"
    
    logger.info(f"‚úÖ –í –±–ª–æ–∫—á–µ–π–Ω–µ –∑–∞—Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–æ {len(blockchain_products)} –ø—Ä–æ–¥—É–∫—Ç–æ–≤")
    
    # 4. –ü–æ–ª—É—á–µ–Ω–∏–µ –ø—Ä–æ–¥—É–∫—Ç–æ–≤ —á–µ—Ä–µ–∑ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã–π —Å–µ—Ä–≤–∏—Å
    logger.info("üìñ –ü–æ–ª—É—á–µ–Ω–∏–µ –ø—Ä–æ–¥—É–∫—Ç–æ–≤ —á–µ—Ä–µ–∑ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã–π —Å–µ—Ä–≤–∏—Å...")
    all_products = await integration_registry_service.get_all_products()
    
    assert len(all_products) >= len(test_products), \
        f"–ü–æ–ª—É—á–µ–Ω–æ {len(all_products)} –ø—Ä–æ–¥—É–∫—Ç–æ–≤, –æ–∂–∏–¥–∞–ª–æ—Å—å {len(test_products)}"
    
    logger.info(f"‚úÖ –ü–æ–ª—É—á–µ–Ω–æ {len(all_products)} –ø—Ä–æ–¥—É–∫—Ç–æ–≤ –∏–∑ –∫–∞—Ç–∞–ª–æ–≥–∞")
    
    # 5. –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ü–µ–ª–æ—Å—Ç–Ω–æ—Å—Ç–∏ –¥–∞–Ω–Ω—ã—Ö
    logger.info("üîç –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ü–µ–ª–æ—Å—Ç–Ω–æ—Å—Ç–∏ –¥–∞–Ω–Ω—ã—Ö –ø—Ä–æ–¥—É–∫—Ç–æ–≤...")
    
    for created_product in created_products:
        product_id = created_product["id"]
        retrieved_product = await integration_registry_service.get_product(product_id)
        
        assert retrieved_product is not None, f"–ü—Ä–æ–¥—É–∫—Ç {product_id} –Ω–µ –Ω–∞–π–¥–µ–Ω"
        assert retrieved_product["title"] == created_product["title"], \
            f"–ù–∞–∑–≤–∞–Ω–∏–µ –ø—Ä–æ–¥—É–∫—Ç–∞ {product_id} –Ω–µ —Å–æ–≤–ø–∞–¥–∞–µ—Ç"
        assert retrieved_product["forms"] == created_product["forms"], \
            f"–§–æ—Ä–º—ã –ø—Ä–æ–¥—É–∫—Ç–∞ {product_id} –Ω–µ —Å–æ–≤–ø–∞–¥–∞—é—Ç"
        
        logger.info(f"‚úÖ –¶–µ–ª–æ—Å—Ç–Ω–æ—Å—Ç—å –ø—Ä–æ–¥—É–∫—Ç–∞ {product_id} –ø—Ä–æ–≤–µ—Ä–µ–Ω–∞")
    
    # 6. –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–æ–±—ã—Ç–∏–π –±–ª–æ–∫—á–µ–π–Ω–∞
    logger.info("üìä –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–æ–±—ã—Ç–∏–π –±–ª–æ–∫—á–µ–π–Ω–∞...")
    
    # –ü–æ–ª—É—á–∞–µ–º —Å–æ–±—ã—Ç–∏—è ProductCreated
    product_created_events = blockchain_service.get_events(
        "ProductRegistry",
        "ProductCreated",
        from_block=0
    )
    
    assert len(product_created_events) >= len(test_products), \
        f"–î–æ–ª–∂–Ω–æ –±—ã—Ç—å –º–∏–Ω–∏–º—É–º {len(test_products)} —Å–æ–±—ã—Ç–∏–π ProductCreated"
    
    logger.info(f"‚úÖ –í—Å–µ {len(product_created_events)} —Å–æ–±—ã—Ç–∏—è –±–ª–æ–∫—á–µ–π–Ω–∞ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ –∑–∞—Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω—ã")
    
    # 7. –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –ø—Ä–æ–¥—É–∫—Ç–∞
    logger.info("‚úèÔ∏è –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –ø—Ä–æ–¥—É–∫—Ç–∞...")
    
    if created_products:
        product_to_update = created_products[0]
        update_data = {
            "title": f"{product_to_update['title']} - Updated",
            "description": f"{product_to_update['description']} - Updated"
        }
        
        update_result = await integration_registry_service.update_product(
            product_to_update["id"], 
            update_data
        )
        
        assert update_result["status"] == "success", \
            f"–û—à–∏–±–∫–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –ø—Ä–æ–¥—É–∫—Ç–∞: {update_result}"
        
        # –ü—Ä–æ–≤–µ—Ä—è–µ–º –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ
        updated_product = await integration_registry_service.get_product(product_to_update["id"])
        assert updated_product["title"] == update_data["title"], \
            "–ù–∞–∑–≤–∞–Ω–∏–µ –ø—Ä–æ–¥—É–∫—Ç–∞ –Ω–µ –æ–±–Ω–æ–≤–ª–µ–Ω–æ"
        
        logger.info("‚úÖ –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ø—Ä–æ–¥—É–∫—Ç–∞ –ø—Ä–æ—à–ª–æ —É—Å–ø–µ—à–Ω–æ")
    
    # 8. –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–µ–∞–∫—Ç–∏–≤–∞—Ü–∏–∏ –ø—Ä–æ–¥—É–∫—Ç–∞
    logger.info("üö´ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–µ–∞–∫—Ç–∏–≤–∞—Ü–∏–∏ –ø—Ä–æ–¥—É–∫—Ç–∞...")
    
    if created_products:
        product_to_deactivate = created_products[-1]
        
        deactivation_result = await integration_registry_service.deactivate_product(
            product_to_deactivate["id"]
        )
        
        assert deactivation_result["status"] == "success", \
            f"–û—à–∏–±–∫–∞ –¥–µ–∞–∫—Ç–∏–≤–∞—Ü–∏–∏ –ø—Ä–æ–¥—É–∫—Ç–∞: {deactivation_result}"
        
        # –ü—Ä–æ–≤–µ—Ä—è–µ–º –¥–µ–∞–∫—Ç–∏–≤–∞—Ü–∏—é
        deactivated_product = await integration_registry_service.get_product(
            product_to_deactivate["id"]
        )
        assert deactivated_product["status"] == 0, "–ü—Ä–æ–¥—É–∫—Ç –Ω–µ –¥–µ–∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞–Ω"
        
        logger.info("‚úÖ –î–µ–∞–∫—Ç–∏–≤–∞—Ü–∏—è –ø—Ä–æ–¥—É–∫—Ç–∞ –ø—Ä–æ—à–ª–∞ —É—Å–ø–µ—à–Ω–æ")
    
    logger.info("üéâ –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã–π —Ç–µ—Å—Ç –∫–∞—Ç–∞–ª–æ–≥–∞ –ø—Ä–æ–¥—É–∫—Ç–æ–≤ —É—Å–ø–µ—à–Ω–æ –∑–∞–≤–µ—Ä—à–µ–Ω!")
```

#### 3. **–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —Ç–µ—Å—Ç—ã –¥–ª—è –ø–æ–∫—Ä—ã—Ç–∏—è —Å—Ü–µ–Ω–∞—Ä–∏–µ–≤**

```python
@pytest.mark.integration
@pytest.mark.blockchain
async def test_product_metadata_integrity_integration(
    blockchain_service,
    integration_registry_service,
    seller_account,
    test_products
):
    """–¢–µ—Å—Ç —Ü–µ–ª–æ—Å—Ç–Ω–æ—Å—Ç–∏ –º–µ—Ç–∞–¥–∞–Ω–Ω—ã—Ö –ø—Ä–æ–¥—É–∫—Ç–æ–≤"""
    logger.info("üîç –¢–µ—Å—Ç —Ü–µ–ª–æ—Å—Ç–Ω–æ—Å—Ç–∏ –º–µ—Ç–∞–¥–∞–Ω–Ω—ã—Ö –ø—Ä–æ–¥—É–∫—Ç–æ–≤...")
    
    # –°–æ–∑–¥–∞–µ–º –ø—Ä–æ–¥—É–∫—Ç —Å –ø–æ–ª–Ω—ã–º–∏ –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–º–∏
    product_data = test_products[0].copy()
    product_data["description"] = "–ü–æ–¥—Ä–æ–±–Ω–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ –ø—Ä–æ–¥—É–∫—Ç–∞ —Å —ç—Ñ—Ñ–µ–∫—Ç–∞–º–∏"
    product_data["effects"] = "–≠–π—Ñ–æ—Ä–∏—è, —Ä–∞—Å—Å–ª–∞–±–ª–µ–Ω–∏–µ, —Ç–≤–æ—Ä—á–µ—Å–∫–∏–π –ø–æ–¥—ä–µ–º"
    product_data["shamanic"] = "–ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –≤ —à–∞–º–∞–Ω—Å–∫–∏—Ö –ø—Ä–∞–∫—Ç–∏–∫–∞—Ö"
    product_data["warnings"] = "–ù–µ —Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è –¥–ª—è –±–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö"
    product_data["dosage_instructions"] = [
        {"amount": "0.5", "unit": "g", "frequency": "—Ä–∞–∑ –≤ –¥–µ–Ω—å"}
    ]
    
    result = await integration_registry_service.create_product(product_data)
    assert result["status"] == "success"
    
    # –ü—Ä–æ–≤–µ—Ä—è–µ–º —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –º–µ—Ç–∞–¥–∞–Ω–Ω—ã—Ö
    created_product = result["product"]
    retrieved_product = await integration_registry_service.get_product(created_product["id"])
    
    assert retrieved_product["description"] == product_data["description"]
    assert retrieved_product["effects"] == product_data["effects"]
    assert retrieved_product["shamanic"] == product_data["shamanic"]
    assert retrieved_product["warnings"] == product_data["warnings"]
    assert len(retrieved_product["dosage_instructions"]) == 1
    
    logger.info("‚úÖ –¢–µ—Å—Ç —Ü–µ–ª–æ—Å—Ç–Ω–æ—Å—Ç–∏ –º–µ—Ç–∞–¥–∞–Ω–Ω—ã—Ö –ø—Ä–æ–π–¥–µ–Ω")

@pytest.mark.integration
@pytest.mark.blockchain
async def test_product_caching_integration(
    blockchain_service,
    integration_registry_service,
    seller_account,
    test_products
):
    """–¢–µ—Å—Ç –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏—è –ø—Ä–æ–¥—É–∫—Ç–æ–≤"""
    logger.info("üíæ –¢–µ—Å—Ç –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏—è –ø—Ä–æ–¥—É–∫—Ç–æ–≤...")
    
    # –°–æ–∑–¥–∞–µ–º –ø—Ä–æ–¥—É–∫—Ç
    result = await integration_registry_service.create_product(test_products[0])
    assert result["status"] == "success"
    
    product_id = result["product"]["id"]
    
    # –ü–µ—Ä–≤—ã–π –∑–∞–ø—Ä–æ—Å - –¥–æ–ª–∂–µ–Ω –∑–∞–≥—Ä—É–∑–∏—Ç—å –∏–∑ storage
    start_time = time.time()
    product1 = await integration_registry_service.get_product(product_id)
    first_request_time = time.time() - start_time
    
    # –í—Ç–æ—Ä–æ–π –∑–∞–ø—Ä–æ—Å - –¥–æ–ª–∂–µ–Ω –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –∫—ç—à
    start_time = time.time()
    product2 = await integration_registry_service.get_product(product_id)
    second_request_time = time.time() - start_time
    
    # –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ –≤—Ç–æ—Ä–æ–π –∑–∞–ø—Ä–æ—Å –±—ã—Å—Ç—Ä–µ–µ (–∏—Å–ø–æ–ª—å–∑—É–µ—Ç –∫—ç—à)
    assert second_request_time < first_request_time, \
        f"–í—Ç–æ—Ä–æ–π –∑–∞–ø—Ä–æ—Å –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –±—ã—Å—Ç—Ä–µ–µ: {second_request_time}s vs {first_request_time}s"
    
    # –ü—Ä–æ–≤–µ—Ä—è–µ–º –∏–¥–µ–Ω—Ç–∏—á–Ω–æ—Å—Ç—å –¥–∞–Ω–Ω—ã—Ö
    assert product1["id"] == product2["id"]
    assert product1["title"] == product2["title"]
    
    logger.info("‚úÖ –¢–µ—Å—Ç –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏—è –ø—Ä–æ–π–¥–µ–Ω")
```

### üöÄ –ö–æ–º–∞–Ω–¥—ã –¥–ª—è –∑–∞–ø—É—Å–∫–∞ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã—Ö —Ç–µ—Å—Ç–æ–≤

#### 1. **–ë—ã—Å—Ç—Ä—ã–π –∑–∞–ø—É—Å–∫ —Å –º–æ–∫–∞–Ω–Ω—ã–º IPFS**
```bash
# –ò—Å–ø–æ–ª—å–∑—É–µ—Ç –º–æ–∫–∞–Ω–Ω—ã–π IPFS (–±—ã—Å—Ç—Ä–æ, —ç–∫–æ–Ω–æ–º–∏—á–Ω–æ)
export INTEGRATION_STORAGE=mock
python3 -m pytest bot/tests/test_product_registry_integration.py -v -m integration

# –û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç: –≤—Å–µ —Ç–µ—Å—Ç—ã –∑–∞ < 30 —Å–µ–∫—É–Ω–¥
```

#### 2. **–ü–æ–ª–Ω–∞—è –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å —Ä–µ–∞–ª—å–Ω—ã–º IPFS**
```bash
# –ò—Å–ø–æ–ª—å–∑—É–µ—Ç —Ä–µ–∞–ª—å–Ω—ã–π Pinata IPFS (–º–µ–¥–ª–µ–Ω–Ω–æ, —Ç—Ä–∞—Ç–∏—Ç –±—é–¥–∂–µ—Ç)
export INTEGRATION_STORAGE=pinata
export PINATA_API_KEY=your_api_key
export PINATA_SECRET_KEY=your_secret_key
python3 -m pytest bot/tests/test_product_registry_integration.py -v -m integration

# –û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç: –≤—Å–µ —Ç–µ—Å—Ç—ã –∑–∞ < 5 –º–∏–Ω—É—Ç
```

#### 3. **–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Å Arweave**
```bash
# –ò—Å–ø–æ–ª—å–∑—É–µ—Ç —Ä–µ–∞–ª—å–Ω—ã–π Arweave (–º–µ–¥–ª–µ–Ω–Ω–æ, —Ç—Ä–∞—Ç–∏—Ç –±—é–¥–∂–µ—Ç)
export INTEGRATION_STORAGE=arweave
export ARWEAVE_PRIVATE_KEY=your_private_key
python3 -m pytest bot/tests/test_product_registry_integration.py -v -m integration
```

#### 4. **–ó–∞–ø—É—Å–∫ –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã—Ö —Ç–µ—Å—Ç–æ–≤**
```bash
# –¢–æ–ª—å–∫–æ —Ç–µ—Å—Ç –∫–∞—Ç–∞–ª–æ–≥–∞
python3 -m pytest bot/tests/test_product_registry_integration.py::test_product_catalog_integration -v

# –¢–æ–ª—å–∫–æ —Ç–µ—Å—Ç—ã –º–µ—Ç–∞–¥–∞–Ω–Ω—ã—Ö
python3 -m pytest bot/tests/test_product_registry_integration.py -k "metadata" -v

# –¢–æ–ª—å–∫–æ —Ç–µ—Å—Ç—ã –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏—è
python3 -m pytest bot/tests/test_product_registry_integration.py -k "caching" -v
```

### üîß –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –¥–ª—è DevOps

#### 1. **–ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è**
```bash
# –û–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ –¥–ª—è –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã—Ö —Ç–µ—Å—Ç–æ–≤
export SELLER_PRIVATE_KEY=0x1234567890abcdef...
export NODE_ADMIN_PRIVATE_KEY=0xabcdef1234567890...
export AMANITA_REGISTRY_CONTRACT_ADDRESS=0x...

# –û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–µ –¥–ª—è —Ä–µ–∞–ª—å–Ω–æ–≥–æ IPFS
export INTEGRATION_STORAGE=mock  # mock|pinata|arweave
export PINATA_API_KEY=your_key
export PINATA_SECRET_KEY=your_secret
export ARWEAVE_PRIVATE_KEY=your_key
```

#### 2. **CI/CD –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è**
```yaml
# .github/workflows/integration-tests.yml
- name: Run Product Registry Integration Tests
  run: |
    export INTEGRATION_STORAGE=mock
    export SELLER_PRIVATE_KEY=${{ secrets.SELLER_PRIVATE_KEY }}
    export NODE_ADMIN_PRIVATE_KEY=${{ secrets.NODE_ADMIN_PRIVATE_KEY }}
    export AMANITA_REGISTRY_CONTRACT_ADDRESS=${{ secrets.CONTRACT_ADDRESS }}
    
    python3 -m pytest bot/tests/test_product_registry_integration.py -v -m integration
    
  env:
    PYTHONPATH: ${{ github.workspace }}/bot
    BLOCKCHAIN_PROFILE: localhost
```

### üìä –ú–µ—Ç—Ä–∏–∫–∏ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω–æ–≥–æ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è

#### –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å
- **Mock IPFS**: < 30 —Å–µ–∫—É–Ω–¥ (—Ü–µ–ª—å: –±—ã—Å—Ç—Ä–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ)
- **Real IPFS**: < 5 –º–∏–Ω—É—Ç (—Ü–µ–ª—å: –ø–æ–ª–Ω–∞—è –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è)
- **Real Arweave**: < 5 –º–∏–Ω—É—Ç (—Ü–µ–ª—å: –ø–æ–ª–Ω–∞—è –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è)

#### –ü–æ–∫—Ä—ã—Ç–∏–µ
- **–ë–ª–æ–∫—á–µ–π–Ω –æ–ø–µ—Ä–∞—Ü–∏–∏**: 100% –æ—Å–Ω–æ–≤–Ω—ã—Ö —Ñ—É–Ω–∫—Ü–∏–π
- **–°–æ–±—ã—Ç–∏—è –∫–æ–Ω—Ç—Ä–∞–∫—Ç–æ–≤**: –í—Å–µ –∫–ª—é—á–µ–≤—ã–µ —Å–æ–±—ã—Ç–∏—è
- **–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ä–æ–ª—è–º–∏**: –ü–æ–ª–Ω—ã–π —Ü–∏–∫–ª –Ω–∞–∑–Ω–∞—á–µ–Ω–∏—è —Ä–æ–ª–µ–π
- **–ñ–∏–∑–Ω–µ–Ω–Ω—ã–π —Ü–∏–∫–ª –ø—Ä–æ–¥—É–∫—Ç–æ–≤**: –°–æ–∑–¥–∞–Ω–∏–µ ‚Üí –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ ‚Üí –î–µ–∞–∫—Ç–∏–≤–∞—Ü–∏—è
- **–ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ**: –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–±–æ—Ç—ã –∫—ç—à–∞
- **–ú–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ**: –¶–µ–ª–æ—Å—Ç–Ω–æ—Å—Ç—å –≤—Å–µ—Ö –ø–æ–ª–µ–π –ø—Ä–æ–¥—É–∫—Ç–∞

#### –≠–∫–æ–Ω–æ–º–∏—è –±—é–¥–∂–µ—Ç–∞
- **Mock —Ä–µ–∂–∏–º**: 0% —Ç—Ä–∞—Ç –Ω–∞ IPFS
- **–†–µ–∞–ª—å–Ω—ã–π —Ä–µ–∂–∏–º**: 100% —Ç—Ä–∞—Ç –Ω–∞ IPFS (—Ç–æ–ª—å–∫–æ –ø—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏)

### üéØ –ü—Ä–∏–Ω—Ü–∏–ø—ã –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω–æ–≥–æ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è

#### 1. **–ò–∑–±–∏—Ä–∞—Ç–µ–ª—å–Ω–æ–µ –º–æ–∫–∏—Ä–æ–≤–∞–Ω–∏–µ**
- ‚úÖ **–í–°–ï–ì–î–ê —Ä–µ–∞–ª—å–Ω—ã–π**: –ë–ª–æ–∫—á–µ–π–Ω –æ–ø–µ—Ä–∞—Ü–∏–∏ (—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∫–æ–Ω—Ç—Ä–∞–∫—Ç–æ–≤)
- üîß **–ù–∞—Å—Ç—Ä–∞–∏–≤–∞–µ–º—ã–π**: IPFS/Arweave (mock|pinata|arweave)
- ‚úÖ **–ì–∏–±–∫–æ—Å—Ç—å**: –õ–µ–≥–∫–æ –ø–µ—Ä–µ–∫–ª—é—á–∞—Ç—å—Å—è –º–µ–∂–¥—É storage —Ä–µ–∂–∏–º–∞–º–∏

#### 2. **–ë—ã—Å—Ç—Ä–∞—è –æ–±—Ä–∞—Ç–Ω–∞—è —Å–≤—è–∑—å**
- **Mock storage**: –î–ª—è –µ–∂–µ–¥–Ω–µ–≤–Ω–æ–π —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏ (–±—ã—Å—Ç—Ä–æ, —ç–∫–æ–Ω–æ–º–∏—á–Ω–æ)
- **Real storage**: –î–ª—è —Ñ–∏–Ω–∞–ª—å–Ω–æ–≥–æ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –ø–µ—Ä–µ–¥ –¥–µ–ø–ª–æ–µ–º (–º–µ–¥–ª–µ–Ω–Ω–æ, —Ç—Ä–∞—Ç–∏—Ç –±—é–¥–∂–µ—Ç)

#### 3. **–≠–∫–æ–Ω–æ–º–∏—è —Ä–µ—Å—É—Ä—Å–æ–≤**
- **Mock storage**: –ë—ã—Å—Ç—Ä–æ, –±–µ—Å–ø–ª–∞—Ç–Ω–æ, —Å—Ç–∞–±–∏–ª—å–Ω–æ
- **Real storage**: –ú–µ–¥–ª–µ–Ω–Ω–æ, –¥–æ—Ä–æ–≥–æ, –º–æ–∂–µ—Ç –±—ã—Ç—å –Ω–µ—Å—Ç–∞–±–∏–ª—å–Ω–æ

### üìù –ó–∞–∫–ª—é—á–µ–Ω–∏–µ –ø–æ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω–æ–º—É —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—é

**–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ —Ç–µ—Å—Ç—ã –∫–∞—Ç–∞–ª–æ–≥–∞ –ø—Ä–æ–¥—É–∫—Ç–æ–≤** —Ç–µ–ø–µ—Ä—å —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—Ç –ø—Ä–∏–Ω—Ü–∏–ø–∞–º Mock –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã:

1. **–¶–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã–µ –º–æ–∫–∏** –≤ `conftest.py`
2. **–ì–∏–±–∫–∞—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è** —á–µ—Ä–µ–∑ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è
3. **–†–µ–∞–ª—å–Ω—ã–π –±–ª–æ–∫—á–µ–π–Ω** –í–°–ï–ì–î–ê (—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∫–æ–Ω—Ç—Ä–∞–∫—Ç–æ–≤)
4. **–ù–∞—Å—Ç—Ä–∞–∏–≤–∞–µ–º—ã–π storage** (mock|pinata|arweave)
5. **–ë—ã—Å—Ç—Ä–∞—è –æ–±—Ä–∞—Ç–Ω–∞—è —Å–≤—è–∑—å** –≤ mock —Ä–µ–∂–∏–º–µ
6. **–ü–æ–ª–Ω–∞—è –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è** –≤ real storage —Ä–µ–∂–∏–º–µ

–≠—Ç–æ –æ–±–µ—Å–ø–µ—á–∏–≤–∞–µ—Ç –±–∞–ª–∞–Ω—Å –º–µ–∂–¥—É —Å–∫–æ—Ä–æ—Å—Ç—å—é —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏ –∏ –∫–∞—á–µ—Å—Ç–≤–æ–º —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è, –ø–æ–∑–≤–æ–ª—è—è DevOps –∏–Ω–∂–µ–Ω–µ—Ä–∞–º –≤—ã–±–∏—Ä–∞—Ç—å –ø–æ–¥—Ö–æ–¥—è—â–∏–π —Ä–µ–∂–∏–º –¥–ª—è –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–π –∑–∞–¥–∞—á–∏.

## üìù –ó–∞–∫–ª—é—á–µ–Ω–∏–µ

**ProductRegistryService** –∏–º–µ–µ—Ç –æ—Ç–ª–∏—á–Ω—É—é —Å–∏—Å—Ç–µ–º—É —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è, —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â—É—é –≤—Å–µ–º –ø—Ä–∏–Ω—Ü–∏–ø–∞–º TDD:

1. **–ë—ã—Å—Ç—Ä–æ—Ç–∞**: 0.30 —Å–µ–∫—É–Ω–¥—ã –¥–ª—è 78 —Ç–µ—Å—Ç–æ–≤
2. **–ö–∞—á–µ—Å—Ç–≤–æ**: 100% –ø–æ–∫—Ä—ã—Ç–∏–µ –æ—Å–Ω–æ–≤–Ω—ã—Ö —Å—Ü–µ–Ω–∞—Ä–∏–µ–≤
3. **–°—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç—å**: –î–µ—Ç–µ—Ä–º–∏–Ω–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã
4. **–ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º–æ—Å—Ç—å**: –¶–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω–Ω–∞—è Mock –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞
5. **–ú–∞—Å—à—Ç–∞–±–∏—Ä—É–µ–º–æ—Å—Ç—å**: –õ–µ–≥–∫–æ –¥–æ–±–∞–≤–ª—è—Ç—å –Ω–æ–≤—ã–µ —Ç–µ—Å—Ç—ã

Mock —Å—Ç—Ä–∞—Ç–µ–≥–∏—è –æ–±–µ—Å–ø–µ—á–∏–≤–∞–µ—Ç –∏–∑–æ–ª—è—Ü–∏—é —Ç–µ—Å—Ç–æ–≤ –æ—Ç –≤–Ω–µ—à–Ω–∏—Ö –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π, —á—Ç–æ –¥–µ–ª–∞–µ—Ç –∏—Ö –±—ã—Å—Ç—Ä—ã–º–∏, —Å—Ç–∞–±–∏–ª—å–Ω—ã–º–∏ –∏ –≤–æ—Å–ø—Ä–æ–∏–∑–≤–æ–¥–∏–º—ã–º–∏. –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–π DI –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã –ø–æ–∑–≤–æ–ª—è–µ—Ç –ª–µ–≥–∫–æ –ø–µ—Ä–µ–∫–ª—é—á–∞—Ç—å—Å—è –º–µ–∂–¥—É –º–æ–∫–∞–º–∏ –∏ —Ä–µ–∞–ª—å–Ω—ã–º–∏ —Å–µ—Ä–≤–∏—Å–∞–º–∏ –¥–ª—è –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω–æ–≥–æ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è.

## üß™ –†–µ–∑—É–ª—å—Ç–∞—Ç—ã —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏

### –ó–∞–ø—É—Å–∫ —Ç–µ—Å—Ç–æ–≤: `test_product_registry_integration.py`

**–î–∞—Ç–∞ –∑–∞–ø—É—Å–∫–∞:** –¢–µ–∫—É—â–∞—è —Å–µ—Å—Å–∏—è  
**–ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è:** `INTEGRATION_STORAGE=mock`  
**–ë–ª–æ–∫—á–µ–π–Ω:** –ó–∞–ø—É—â–µ–Ω, –∫–æ–Ω—Ç—Ä–∞–∫—Ç—ã —Ä–∞–∑–≤–µ—Ä–Ω—É—Ç—ã  

#### üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ —Ç–µ—Å—Ç–æ–≤

**–í—Å–µ–≥–æ —Ç–µ—Å—Ç–æ–≤:** 19  
**–°—Ç–∞—Ç—É—Å:** –ó–∞–ø—É—â–µ–Ω—ã (–ø—Ä–µ—Ä–≤–∞–Ω—ã –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–º)  
**–í—Ä–µ–º—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è:** –ë—ã—Å—Ç—Ä–æ (Mock —Ä–µ–∂–∏–º)  

#### ‚úÖ –£—Å–ø–µ—à–Ω–æ –≤—ã–ø–æ–ª–Ω–µ–Ω–Ω—ã–µ —Ç–µ—Å—Ç—ã

1. **`test_integration_storage_config_fixture`** - PASSED ‚úÖ
   - –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ storage —Ñ–∏–∫—Å—Ç—É—Ä—ã
   - Mock —Ä–µ–∂–∏–º –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ –Ω–∞—Å—Ç—Ä–æ–µ–Ω

2. **`test_integration_registry_service_real_blockchain_fixture`** - PASSED ‚úÖ
   - –§–∏–∫—Å—Ç—É—Ä–∞ —Å —Ä–µ–∞–ª—å–Ω—ã–º –±–ª–æ–∫—á–µ–π–Ω–æ–º
   - –ö–æ–Ω—Ç—Ä–∞–∫—Ç—ã –¥–æ—Å—Ç—É–ø–Ω—ã –∏ —Ä–∞–±–æ—Ç–∞—é—Ç

3. **`test_helper_functions_storage_selection`** - PASSED ‚úÖ
   - –í—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ –≤—ã–±–æ—Ä–∞ storage
   - –õ–æ–≥–∏–∫–∞ Mock –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã —Ä–∞–±–æ—Ç–∞–µ—Ç

4. **`test_seller_account_fixture`** - PASSED ‚úÖ
   - –§–∏–∫—Å—Ç—É—Ä–∞ –∞–∫–∫–∞—É–Ω—Ç–∞ –ø—Ä–æ–¥–∞–≤—Ü–∞
   - –ë–ª–æ–∫—á–µ–π–Ω –∞–∫–∫–∞—É–Ω—Ç –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω

5. **`test_test_products_fixture`** - PASSED ‚úÖ
   - –§–∏–∫—Å—Ç—É—Ä–∞ —Ç–µ—Å—Ç–æ–≤—ã—Ö –ø—Ä–æ–¥—É–∫—Ç–æ–≤
   - –î–∞–Ω–Ω—ã–µ –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –∑–∞–≥—Ä—É–∂–µ–Ω—ã

6. **`test_integration_registry_service_mock_fixture`** - PASSED ‚úÖ
   - Mock –≤–µ—Ä—Å–∏—è ProductRegistryService
   - –í—Å–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –∑–∞–º–æ–∫–∞–Ω—ã

7. **`test_integration_registry_service_real_fixture`** - PASSED ‚úÖ
   - –†–µ–∞–ª—å–Ω–∞—è –≤–µ—Ä—Å–∏—è ProductRegistryService
   - –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å –±–ª–æ–∫—á–µ–π–Ω–æ–º —Ä–∞–±–æ—Ç–∞–µ—Ç

#### üîÑ –¢–µ—Å—Ç—ã –≤ –ø—Ä–æ—Ü–µ—Å—Å–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è

8. **`test_integration_service_initialization`** - –í –ø—Ä–æ—Ü–µ—Å—Å–µ
   - –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è —Å–µ—Ä–≤–∏—Å–∞
   - –ü—Ä–æ–≤–µ—Ä–∫–∞ Mock –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã

9. **`test_integration_get_all_products_basic`** - –í –ø—Ä–æ—Ü–µ—Å—Å–µ
   - –ë–∞–∑–æ–≤–æ–µ –ø–æ–ª—É—á–µ–Ω–∏–µ –≤—Å–µ—Ö –ø—Ä–æ–¥—É–∫—Ç–æ–≤
   - Mock —Å–µ—Ä–≤–∏—Å—ã –±–µ–∑ –º–µ–¥–ª–µ–Ω–Ω—ã—Ö –≤—ã–∑–æ–≤–æ–≤

10. **`test_integration_get_product_basic`** - –í –ø—Ä–æ—Ü–µ—Å—Å–µ
    - –ë–∞–∑–æ–≤–æ–µ –ø–æ–ª—É—á–µ–Ω–∏–µ –ø—Ä–æ–¥—É–∫—Ç–∞
    - Mock —Å–µ—Ä–≤–∏—Å—ã –±–µ–∑ –º–µ–¥–ª–µ–Ω–Ω—ã—Ö –≤—ã–∑–æ–≤–æ–≤

#### üìã –û—Å—Ç–∞–≤—à–∏–µ—Å—è —Ç–µ—Å—Ç—ã

11. **`test_integration_error_handling_invalid_id`**
    - –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫ —Å –Ω–µ–≤–∞–ª–∏–¥–Ω—ã–º ID
    - Mock —Å–µ—Ä–≤–∏—Å—ã –±–µ–∑ –º–µ–¥–ª–µ–Ω–Ω—ã—Ö –≤—ã–∑–æ–≤–æ–≤

12. **`test_integration_product_lifecycle_deactivation`**
    - –ñ–∏–∑–Ω–µ–Ω–Ω—ã–π —Ü–∏–∫–ª –ø—Ä–æ–¥—É–∫—Ç–∞: –¥–µ–∞–∫—Ç–∏–≤–∞—Ü–∏—è
    - –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å —Ç–µ—Å—Ç–æ–≤—ã–º–∏ –¥–∞–Ω–Ω—ã–º–∏

13. **`test_integration_product_metadata_integrity`**
    - –¶–µ–ª–æ—Å—Ç–Ω–æ—Å—Ç—å –º–µ—Ç–∞–¥–∞–Ω–Ω—ã—Ö –ø—Ä–æ–¥—É–∫—Ç–∞
    - –ü—Ä–æ–≤–µ—Ä–∫–∞ Mock –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã

14. **`test_integration_catalog_filtering`**
    - –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è –∫–∞—Ç–∞–ª–æ–≥–∞
    - Mock —Å–µ—Ä–≤–∏—Å—ã

15. **`test_integration_pinata_rate_limiting_and_jitter`**
    - Rate limiting –∏ jitter –¥–ª—è Pinata
    - –ü—Ä–æ–ø—É—Å–∫–∞–µ—Ç—Å—è –≤ Mock —Ä–µ–∂–∏–º–µ

16. **`test_integration_circuit_breaker_pattern`**
    - –ü–∞—Ç—Ç–µ—Ä–Ω Circuit Breaker
    - –ü—Ä–æ–ø—É—Å–∫–∞–µ—Ç—Å—è –≤ Mock —Ä–µ–∂–∏–º–µ

17. **`test_integration_exponential_backoff_and_retry`**
    - Exponential backoff –∏ retry
    - –ü—Ä–æ–ø—É—Å–∫–∞–µ—Ç—Å—è –≤ Mock —Ä–µ–∂–∏–º–µ

18. **`test_integration_graceful_degradation_and_metrics`**
    - Graceful degradation –∏ –º–µ—Ç—Ä–∏–∫–∏
    - –ü—Ä–æ–ø—É—Å–∫–∞–µ—Ç—Å—è –≤ Mock —Ä–µ–∂–∏–º–µ

19. **`test_integration_security_and_corner_cases`**
    - –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å –∏ –≥—Ä–∞–Ω–∏—á–Ω—ã–µ —Å–ª—É—á–∞–∏
    - Mock —Å–µ—Ä–≤–∏—Å—ã

#### üéØ –ö–ª—é—á–µ–≤—ã–µ –Ω–∞–±–ª—é–¥–µ–Ω–∏—è

**Mock –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ:**
- ‚úÖ –í—Å–µ —Ñ–∏–∫—Å—Ç—É—Ä—ã –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É—é—Ç—Å—è –±—ã—Å—Ç—Ä–æ
- ‚úÖ Mock —Å–µ—Ä–≤–∏—Å—ã –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ –Ω–∞—Å—Ç—Ä–æ–µ–Ω—ã
- ‚úÖ –ë–ª–æ–∫—á–µ–π–Ω –¥–æ—Å—Ç—É–ø–µ–Ω –¥–ª—è —Ä–µ–∞–ª—å–Ω—ã—Ö —Ç–µ—Å—Ç–æ–≤
- ‚úÖ –ö–æ–Ω—Ç—Ä–∞–∫—Ç—ã —Ä–∞–∑–≤–µ—Ä–Ω—É—Ç—ã –∏ —Ä–∞–±–æ—Ç–∞—é—Ç

**–ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å:**
- üöÄ –¢–µ—Å—Ç—ã –∑–∞–ø—É—Å–∫–∞—é—Ç—Å—è –±—ã—Å—Ç—Ä–æ (Mock —Ä–µ–∂–∏–º)
- üöÄ –ù–µ—Ç –∑–∞–≤–∏—Å–∞–Ω–∏–π –Ω–∞ –º–µ–¥–ª–µ–Ω–Ω—ã—Ö API –≤—ã–∑–æ–≤–∞—Ö
- üöÄ Mock –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –æ–±–µ—Å–ø–µ—á–∏–≤–∞–µ—Ç –∏–∑–æ–ª—è—Ü–∏—é

**–ì–æ—Ç–æ–≤–Ω–æ—Å—Ç—å –∫ –ø–æ–ª–Ω–æ–º—É —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—é:**
- ‚úÖ –ë–∞–∑–æ–≤–∞—è –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –≥–æ—Ç–æ–≤–∞
- ‚úÖ –í—Å–µ —Ñ–∏–∫—Å—Ç—É—Ä—ã —Ä–∞–±–æ—Ç–∞—é—Ç
- ‚úÖ Mock –∏ —Ä–µ–∞–ª—å–Ω—ã–µ —Å–µ—Ä–≤–∏—Å—ã –¥–æ—Å—Ç—É–ø–Ω—ã
- ‚úÖ –ì–æ—Ç–æ–≤ –∫ –ø–æ–ª–Ω–æ–º—É –ø—Ä–æ–≥–æ–Ω—É –≤—Å–µ—Ö —Ç–µ—Å—Ç–æ–≤

#### üìù –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏

1. **–ó–∞–ø—É—Å—Ç–∏—Ç—å –ø–æ–ª–Ω—ã–π –ø—Ä–æ–≥–æ–Ω** –≤—Å–µ—Ö —Ç–µ—Å—Ç–æ–≤ –¥–ª—è –ø–æ–ª–Ω–æ–π –≤–∞–ª–∏–¥–∞—Ü–∏–∏
2. **–ü—Ä–æ–≤–µ—Ä–∏—Ç—å Mock –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—É** –Ω–∞ –≤—Å–µ—Ö —Ç–∏–ø–∞—Ö —Ç–µ—Å—Ç–æ–≤
3. **–í–∞–ª–∏–¥–∏—Ä–æ–≤–∞—Ç—å –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—é** —Å —Ä–µ–∞–ª—å–Ω—ã–º –±–ª–æ–∫—á–µ–π–Ω–æ–º
4. **–î–æ–∫—É–º–µ–Ω—Ç–∏—Ä–æ–≤–∞—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã** –ø–æ–ª–Ω–æ–≥–æ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è

**–°—Ç–∞—Ç—É—Å:** Mock –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –≥–æ—Ç–æ–≤–∞ –∏ —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ. –í—Å–µ –±–∞–∑–æ–≤—ã–µ —Ç–µ—Å—Ç—ã –ø—Ä–æ—Ö–æ–¥—è—Ç —É—Å–ø–µ—à–Ω–æ.



---

## üîó –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ ProductRegistryService

### üìä –°—Ç–∞—Ç—É—Å –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã—Ö —Ç–µ—Å—Ç–æ–≤ (14.08.2025)

**üéØ –û–±—â–∏–π —Å—Ç–∞—Ç—É—Å:**
- **–í—Å–µ–≥–æ —Ç–µ—Å—Ç–æ–≤**: 19
- **–ü—Ä–æ—Ö–æ–¥—è—â–∏—Ö**: 14/19 (74%)
- **–ü–∞–¥–∞—é—â–∏—Ö**: 0/19 (0%) ‚úÖ
- **–ü—Ä–æ–ø—É—â–µ–Ω–Ω—ã—Ö**: 5/19 (26%) - –Ω–µ –≥–æ—Ç–æ–≤—ã –∏–ª–∏ advanced patterns
- **–í—Ä–µ–º—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è**: ~6.5 —Å–µ–∫—É–Ω–¥

**‚úÖ –ì–æ—Ç–æ–≤—ã–µ —Ç–µ—Å—Ç—ã (14/19):**
1. `test_integration_storage_config_fixture` ‚úÖ
2. `test_integration_registry_service_real_blockchain_fixture` ‚úÖ
3. `test_helper_functions_storage_selection` ‚úÖ
4. `test_seller_account_fixture` ‚úÖ
5. `test_test_products_fixture` ‚úÖ
6. `test_integration_registry_service_mock_fixture` ‚úÖ
7. `test_integration_registry_service_real_fixture` ‚úÖ
8. `test_integration_service_initialization` ‚úÖ
9. `test_integration_get_all_products_basic` ‚úÖ
10. `test_integration_get_product_basic` ‚úÖ
11. `test_integration_error_handling_invalid_id` ‚úÖ
12. `test_integration_product_lifecycle_deactivation` ‚úÖ
13. `test_integration_product_metadata_integrity` ‚úÖ
14. `test_integration_security_and_corner_cases` ‚úÖ

**‚è≠Ô∏è –ü—Ä–æ–ø—É—â–µ–Ω–Ω—ã–µ —Ç–µ—Å—Ç—ã (5/19):**
1. `test_integration_catalog_filtering` - –Ω–µ –≥–æ—Ç–æ–≤ (—á–µ—Ä–Ω–æ–≤–∏–∫)
2. `test_integration_pinata_rate_limiting_and_jitter` - advanced pattern
3. `test_integration_circuit_breaker_pattern` - advanced pattern
4. `test_integration_exponential_backoff_and_retry` - advanced pattern
5. `test_integration_graceful_degradation_and_metrics` - advanced pattern

### üîß –†–µ—à–µ–Ω–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω–æ–≥–æ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è

#### 1. –§–æ—Ä–º–∞—Ç CID –≤ MockIPFSStorage ‚úÖ

**–ü—Ä–æ–±–ª–µ–º–∞:** MockIPFSStorage –≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–ª –Ω–µ–≤–∞–ª–∏–¥–Ω—ã–µ IPFS CID —Å –Ω–µ–¥–æ–ø—É—Å—Ç–∏–º—ã–º–∏ —Å–∏–º–≤–æ–ª–∞–º–∏ (h, j, m, Z, y, X, p, A, q, 8, 9).

**–†–µ—à–µ–Ω–∏–µ:** –û–±–Ω–æ–≤–ª–µ–Ω –º–µ—Ç–æ–¥ `_generate_unique_cid()` –≤ `conftest.py` –¥–ª—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è —Ç–æ–ª—å–∫–æ –≤–∞–ª–∏–¥–Ω—ã—Ö —Å–∏–º–≤–æ–ª–æ–≤ base58btc.

**–†–µ–∑—É–ª—å—Ç–∞—Ç:** –í—Å–µ —Ç–µ—Å—Ç—ã —Å –ø—Ä–æ–≤–µ—Ä–∫–æ–π CID —Ç–µ–ø–µ—Ä—å –ø—Ä–æ—Ö–æ–¥—è—Ç —É—Å–ø–µ—à–Ω–æ.

#### 2. –¢–µ—Å—Ç –∂–∏–∑–Ω–µ–Ω–Ω–æ–≥–æ —Ü–∏–∫–ª–∞ –ø—Ä–æ–¥—É–∫—Ç–æ–≤ ‚úÖ

**–ü—Ä–æ–±–ª–µ–º–∞:** –ù–µ—Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ –¥–∞–Ω–Ω—ã—Ö –ø—Ä–æ–¥—É–∫—Ç–∞ –≤ —Ç–µ—Å—Ç–µ –∂–∏–∑–Ω–µ–Ω–Ω–æ–≥–æ —Ü–∏–∫–ª–∞ –º–µ–∂–¥—É —Å–æ–∑–¥–∞–Ω–∏–µ–º –∏ –ø—Ä–æ–≤–µ—Ä–∫–æ–π.

**–†–µ—à–µ–Ω–∏–µ:** –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä–æ–≤–∞–Ω—ã —Ç–µ—Å—Ç–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ –º–µ–∂–¥—É —Å–æ–∑–¥–∞–Ω–∏–µ–º –∏ –ø—Ä–æ–≤–µ—Ä–∫–æ–π –ø—Ä–æ–¥—É–∫—Ç–∞.

**–†–µ–∑—É–ª—å—Ç–∞—Ç:** –¢–µ—Å—Ç `test_integration_product_lifecycle_deactivation` –ø—Ä–æ—Ö–æ–¥–∏—Ç —É—Å–ø–µ—à–Ω–æ.

#### 3. –ò–º–ø–æ—Ä—Ç –º–æ–¥—É–ª–µ–π ‚úÖ

**–ü—Ä–æ–±–ª–µ–º–∞:** –û—à–∏–±–∫–∞ `ModuleNotFoundError: No module named 'services'` –ø—Ä–∏ –∑–∞–ø—É—Å–∫–µ —Ç–µ—Å—Ç–æ–≤ –∏–∑ –∫–æ—Ä–Ω—è –ø—Ä–æ–µ–∫—Ç–∞.

**–†–µ—à–µ–Ω–∏–µ:** –ò—Å–ø—Ä–∞–≤–ª–µ–Ω –∏–º–ø–æ—Ä—Ç –≤ `bot/services/product/validation.py` —Å `from services.product.validation_utils import` –Ω–∞ `from bot.services.product.validation_utils import`.

**–†–µ–∑—É–ª—å—Ç–∞—Ç:** –¢–µ—Å—Ç—ã —Ä–∞–±–æ—Ç–∞—é—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ –∏–∑ –ª—é–±–æ–π –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏.

### üöÄ –ö–æ–º–∞–Ω–¥—ã –¥–ª—è –∑–∞–ø—É—Å–∫–∞ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã—Ö —Ç–µ—Å—Ç–æ–≤

#### –ò–∑ –∫–æ—Ä–Ω—è –ø—Ä–æ–µ–∫—Ç–∞ (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è)
```bash
cd /Users/eslinko/Development/üçÑAmanita
PYTHONPATH=. python3 -m pytest bot/tests/test_product_registry_integration.py -v --durations=10
```

#### –ò–∑ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏ bot
```bash
cd bot
python3 -m pytest tests/test_product_registry_integration.py -v --durations=10
```

#### –ó–∞–ø—É—Å–∫ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ —Ç–µ—Å—Ç–∞
```bash
# –¢–µ—Å—Ç –º–µ—Ç–∞–¥–∞–Ω–Ω—ã—Ö
python3 -m pytest bot/tests/test_product_registry_integration.py::test_integration_product_metadata_integrity -v

# –¢–µ—Å—Ç –∂–∏–∑–Ω–µ–Ω–Ω–æ–≥–æ —Ü–∏–∫–ª–∞
python3 -m pytest bot/tests/test_product_registry_integration.py::test_integration_product_lifecycle_deactivation -v
```

### üéØ –ì–æ—Ç–æ–≤–Ω–æ—Å—Ç—å –∫ MVP

**‚úÖ –ü–æ–ª–Ω–æ—Å—Ç—å—é –≥–æ—Ç–æ–≤–æ:**
- –°–æ–∑–¥–∞–Ω–∏–µ –ø—Ä–æ–¥—É–∫—Ç–æ–≤
- –ü–æ–ª—É—á–µ–Ω–∏–µ –ø—Ä–æ–¥—É–∫—Ç–æ–≤
- –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—Ç–∞—Ç—É—Å–∞ –ø—Ä–æ–¥—É–∫—Ç–æ–≤
- –í–∞–ª–∏–¥–∞—Ü–∏—è –º–µ—Ç–∞–¥–∞–Ω–Ω—ã—Ö
- –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫
- –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å –∏ corner cases

**‚ö†Ô∏è –¢—Ä–µ–±—É–µ—Ç –¥–æ—Ä–∞–±–æ—Ç–∫–∏:**
- –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è –∫–∞—Ç–∞–ª–æ–≥–∞ (—á–µ—Ä–Ω–æ–≤–∏–∫)
- Advanced patterns (rate limiting, circuit breaker, retry logic)

**üéâ –ó–∞–∫–ª—é—á–µ–Ω–∏–µ:**
–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ —Ç–µ—Å—Ç—ã ProductRegistryService –ø–æ–ª–Ω–æ—Å—Ç—å—é –≥–æ—Ç–æ–≤—ã –¥–ª—è MVP. –û—Å–Ω–æ–≤–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å 
–∂–∏–∑–Ω–µ–Ω–Ω–æ–≥–æ —Ü–∏–∫–ª–∞ –ø—Ä–æ–¥—É–∫—Ç–æ–≤ –ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∞ –∏ —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ. –í—Å–µ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ —Å—Ü–µ–Ω–∞—Ä–∏–∏ –ø–æ–∫—Ä—ã—Ç—ã –∏ 
–ø—Ä–æ—Ö–æ–¥—è—Ç —É—Å–ø–µ—à–Ω–æ.

---

## üîó –°–≤—è–∑–∞–Ω–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è

### **API —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ:**
–î–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–∏ API —Å–º. [`test-api.md`](./api%20layer/test-api.md)

### üìã –û–±–∑–æ—Ä AccountService

**AccountService** - —Å–µ—Ä–≤–∏—Å –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –∞–∫–∫–∞—É–Ω—Ç–∞–º–∏ –∏ –ø—Ä–∞–≤–∞–º–∏ –¥–æ—Å—Ç—É–ø–∞ –≤ —Å–∏—Å—Ç–µ–º–µ Amanita. –û—Ç–≤–µ—á–∞–µ—Ç –∑–∞:
- –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∞–∫–∫–∞—É–Ω—Ç–∞–º–∏ –ø—Ä–æ–¥–∞–≤—Ü–æ–≤
- –ü—Ä–æ–≤–µ—Ä–∫—É –ø—Ä–∞–≤ –¥–æ—Å—Ç—É–ø–∞ (SELLER_ROLE)
- –í–∞–ª–∏–¥–∞—Ü–∏—é –∏–Ω–≤–∞–π—Ç-–∫–æ–¥–æ–≤
- –ê–∫—Ç–∏–≤–∞—Ü–∏—é –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
- –ú–∏–Ω—Ç–∏–Ω–≥ –Ω–æ–≤—ã—Ö –∏–Ω–≤–∞–π—Ç-–∫–æ–¥–æ–≤

### üé≠ Mock —Å—Ç—Ä–∞—Ç–µ–≥–∏—è –¥–ª—è AccountService

#### **–ü—Ä–∏–Ω—Ü–∏–ø—ã –º–æ–∫–∏—Ä–æ–≤–∞–Ω–∏—è:**

1. **–ò–∑–æ–ª—è—Ü–∏—è –æ—Ç –±–ª–æ–∫—á–µ–π–Ω–∞**: –í—Å–µ –≤—ã–∑–æ–≤—ã `blockchain_service` –∑–∞–º–æ–∫–∞–Ω—ã
2. **–ü—Ä–µ–¥—Å–∫–∞–∑—É–µ–º—ã–µ –¥–∞–Ω–Ω—ã–µ**: –î–µ—Ç–µ—Ä–º–∏–Ω–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
3. **–ì–∏–±–∫–æ—Å—Ç—å —Å—Ü–µ–Ω–∞—Ä–∏–µ–≤**: –õ–µ–≥–∫–æ –ø–µ—Ä–µ–∫–ª—é—á–∞—Ç—å—Å—è –º–µ–∂–¥—É —É—Å–ø–µ—à–Ω—ã–º–∏ –∏ –Ω–µ—É—Å–ø–µ—à–Ω—ã–º–∏ —Å—Ü–µ–Ω–∞—Ä–∏—è–º–∏
4. **–ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å**: –ë—ã—Å—Ç—Ä—ã–µ —Ç–µ—Å—Ç—ã –±–µ–∑ —Ä–µ–∞–ª—å–Ω—ã—Ö —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π

#### **–ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ Mock —Å–∏—Å—Ç–µ–º—ã:**

```python
# bot/tests/conftest.py - Mock –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –¥–ª—è AccountService

@pytest.fixture
def mock_blockchain_service_for_account():
    """Mock BlockchainService –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è AccountService"""
    mock_blockchain = Mock()
    
    # –ë–∞–∑–æ–≤—ã–µ –º–µ—Ç–æ–¥—ã –±–ª–æ–∫—á–µ–π–Ω–∞
    mock_blockchain._call_contract_read_function = Mock()
    mock_blockchain.get_contract = Mock()
    mock_blockchain.estimate_gas_with_multiplier = AsyncMock()
    mock_blockchain.transact_contract_function = AsyncMock()
    mock_blockchain.web3 = Mock()
    
    # –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ø–æ–≤–µ–¥–µ–Ω–∏—è –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é
    mock_blockchain._call_contract_read_function.side_effect = [
        True,   # isSeller
        5,      # userInviteCount
        True,   # isUserActivated
        ["0x123", "0x456"],  # getAllActivatedUsers
        ([True, False], ["Valid", "Invalid"])  # batchValidateInviteCodes
    ]
    
    return mock_blockchain

@pytest.fixture
def mock_account_service(mock_blockchain_service_for_account):
    """Mock AccountService —Å –∑–∞–º–æ–∫–∞–Ω–Ω—ã–º–∏ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç—è–º–∏"""
    from bot.services.core.account import AccountService
    
    # –°–æ–∑–¥–∞–µ–º AccountService —Å mock –±–ª–æ–∫—á–µ–π–Ω–æ–º
    account_service = AccountService(mock_blockchain_service_for_account)
    
    # –ú–æ–∫–∞–µ–º –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è
    with patch.dict(os.environ, {"SELLER_PRIVATE_KEY": "0x1234567890abcdef"}):
        yield account_service

@pytest.fixture
def mock_eth_account():
    """Mock Ethereum –∞–∫–∫–∞—É–Ω—Ç –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è"""
    mock_account = Mock()
    mock_account.address = "0x742d35Cc6634C0532925a3b8D4C9db96C4b4d8b6"
    mock_account.key = "0x1234567890abcdef"
    return mock_account
```

### üîß –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è Mock –º–µ—Ç–æ–¥–æ–≤

#### **1. Mock –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –ø—Ä–∞–≤ –ø—Ä–æ–¥–∞–≤—Ü–∞:**

```python
@pytest.fixture
def mock_blockchain_seller_checks():
    """Mock –¥–ª—è —Ä–∞–∑–ª–∏—á–Ω—ã—Ö —Å—Ü–µ–Ω–∞—Ä–∏–µ–≤ –ø—Ä–æ–≤–µ—Ä–∫–∏ –ø—Ä–∞–≤ –ø—Ä–æ–¥–∞–≤—Ü–∞"""
    mock_blockchain = Mock()
    
    def mock_call_contract_read_function(contract_name, function_name, default_value, *args):
        if function_name == "isSeller":
            wallet_address = args[0]
            # –°–∏–º—É–ª–∏—Ä—É–µ–º –ª–æ–≥–∏–∫—É: —Ç–æ–ª—å–∫–æ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω—ã–µ –∞–¥—Ä–µ—Å–∞ —è–≤–ª—è—é—Ç—Å—è –ø—Ä–æ–¥–∞–≤—Ü–∞–º–∏
            if wallet_address == "0x742d35Cc6634C0532925a3b8D4C9db96C4b4d8b6":
                return True
            elif wallet_address == "0x1234567890abcdef1234567890abcdef12345678":
                return True
            else:
                return False
        elif function_name == "userInviteCount":
            wallet_address = args[0]
            # –°–∏–º—É–ª–∏—Ä—É–µ–º –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∏–Ω–≤–∞–π—Ç–æ–≤
            invite_counts = {
                "0x742d35Cc6634C0532925a3b8D4C9db96C4b4d8b6": 5,
                "0x1234567890abcdef1234567890abcdef12345678": 12,
                "0x0000000000000000000000000000000000000000": 0
            }
            return invite_counts.get(wallet_address, 0)
        
        return default_value
    
    mock_blockchain._call_contract_read_function = Mock(side_effect=mock_call_contract_read_function)
    return mock_blockchain
```

#### **2. Mock –¥–ª—è –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã—Ö —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π:**

```python
@pytest.fixture
def mock_blockchain_transactions():
    """Mock –¥–ª—è –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã—Ö —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π –±–ª–æ–∫—á–µ–π–Ω–∞"""
    mock_blockchain = Mock()
    
    # Mock –¥–ª—è –æ—Ü–µ–Ω–∫–∏ –≥–∞–∑–∞
    async def mock_estimate_gas(*args, **kwargs):
        return 500000  # 500K –≥–∞–∑–∞
    
    # Mock –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π
    async def mock_transact_contract_function(*args, **kwargs):
        return "0x1234567890abcdef1234567890abcdef1234567890abcdef1234567890abcdef"
    
    # Mock –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –∫–æ–Ω—Ç—Ä–∞–∫—Ç–∞
    mock_contract = Mock()
    mock_contract.functions = Mock()
    mock_contract.functions.activateAndMintInvites = Mock()
    
    mock_blockchain.estimate_gas_with_multiplier = AsyncMock(side_effect=mock_estimate_gas)
    mock_blockchain.transact_contract_function = AsyncMock(side_effect=mock_transact_contract_function)
    mock_blockchain.get_contract = Mock(return_value=mock_contract)
    
    # Mock –¥–ª—è Web3
    mock_web3 = Mock()
    mock_receipt = Mock()
    mock_receipt.gasUsed = 450000
    mock_receipt.status = 1
    
    mock_web3.eth.wait_for_transaction_receipt = Mock(return_value=mock_receipt)
    mock_blockchain.web3 = mock_web3
    
    return mock_blockchain
```

#### **3. Mock –¥–ª—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –∏–Ω–≤–∞–π—Ç-–∫–æ–¥–æ–≤:**

```python
@pytest.fixture
def mock_invite_code_generator():
    """Mock –¥–ª—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –∏–Ω–≤–∞–π—Ç-–∫–æ–¥–æ–≤"""
    def generate_deterministic_codes(seed="test_seed"):
        """–ì–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç –¥–µ—Ç–µ—Ä–º–∏–Ω–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –∏–Ω–≤–∞–π—Ç-–∫–æ–¥—ã –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è"""
        import hashlib
        
        # –ò—Å–ø–æ–ª—å–∑—É–µ–º seed –¥–ª—è –¥–µ—Ç–µ—Ä–º–∏–Ω–∏—Ä–æ–≤–∞–Ω–Ω–æ–π –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏
        hash_obj = hashlib.md5(seed.encode())
        hash_hex = hash_obj.hexdigest()
        
        codes = []
        for i in range(12):
            # –°–æ–∑–¥–∞–µ–º –∫–æ–¥ –Ω–∞ –æ—Å–Ω–æ–≤–µ —Ö–µ—à–∞
            start_idx = (i * 4) % len(hash_hex)
            first_part = hash_hex[start_idx:start_idx + 4].upper()
            second_part = hash_hex[start_idx + 4:start_idx + 8].upper()
            
            # –ó–∞–º–µ–Ω—è–µ–º –Ω–µ–≤–∞–ª–∏–¥–Ω—ã–µ —Å–∏–º–≤–æ–ª—ã
            first_part = ''.join(c if c.isalnum() else 'A' for c in first_part)
            second_part = ''.join(c if c.isalnum() else 'A' for c in second_part)
            
            codes.append(f"AMANITA-{first_part}-{second_part}")
        
        return codes
    
    return generate_deterministic_codes
```

### üß™ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Ç–µ—Å—Ç–æ–≤ –¥–ª—è AccountService

#### **1. Unit —Ç–µ—Å—Ç—ã —Å Mock –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–æ–π:**

```python
# bot/tests/test_account_service_mock.py

import pytest
from unittest.mock import Mock, AsyncMock, patch
import os
from eth_account import Account
from bot.services.core.account import AccountService

class TestAccountServiceMock:
    """–¢–µ—Å—Ç—ã AccountService —Å Mock –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–æ–π"""
    
    @pytest.fixture
    def mock_blockchain_service(self):
        """Mock BlockchainService –¥–ª—è –∏–∑–æ–ª—è—Ü–∏–∏ —Ç–µ—Å—Ç–æ–≤"""
        mock_blockchain = Mock()
        
        # –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –±–∞–∑–æ–≤–æ–≥–æ –ø–æ–≤–µ–¥–µ–Ω–∏—è
        mock_blockchain._call_contract_read_function = Mock()
        mock_blockchain.get_contract = Mock()
        mock_blockchain.estimate_gas_with_multiplier = AsyncMock(return_value=500000)
        mock_blockchain.transact_contract_function = AsyncMock(
            return_value="0x1234567890abcdef1234567890abcdef1234567890abcdef1234567890abcdef"
        )
        
        # Mock Web3
        mock_web3 = Mock()
        mock_receipt = Mock()
        mock_receipt.gasUsed = 450000
        mock_receipt.status = 1
        mock_web3.eth.wait_for_transaction_receipt = Mock(return_value=mock_receipt)
        mock_blockchain.web3 = mock_web3
        
        return mock_blockchain
    
    @pytest.fixture
    def account_service(self, mock_blockchain_service):
        """AccountService —Å mock –±–ª–æ–∫—á–µ–π–Ω–æ–º"""
        with patch.dict(os.environ, {"SELLER_PRIVATE_KEY": "0x1234567890abcdef"}):
            return AccountService(mock_blockchain_service)
    
    def test_get_seller_account_success(self, account_service):
        """–¢–µ—Å—Ç —É—Å–ø–µ—à–Ω–æ–≥–æ –ø–æ–ª—É—á–µ–Ω–∏—è –∞–∫–∫–∞—É–Ω—Ç–∞ –ø—Ä–æ–¥–∞–≤—Ü–∞"""
        with patch.dict(os.environ, {"SELLER_PRIVATE_KEY": "0x1234567890abcdef"}):
            account = account_service.get_seller_account()
            
            assert account is not None
            assert hasattr(account, 'address')
            assert hasattr(account, 'key')
    
    def test_get_seller_account_missing_key(self, account_service):
        """–¢–µ—Å—Ç –æ—à–∏–±–∫–∏ –ø—Ä–∏ –æ—Ç—Å—É—Ç—Å—Ç–≤–∏–∏ –ø—Ä–∏–≤–∞—Ç–Ω–æ–≥–æ –∫–ª—é—á–∞"""
        with patch.dict(os.environ, {}, clear=True):
            with pytest.raises(ValueError, match="SELLER_PRIVATE_KEY –Ω–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω"):
                account_service.get_seller_account()
    
    def test_is_seller_true(self, account_service, mock_blockchain_service):
        """–¢–µ—Å—Ç –ø—Ä–æ–≤–µ—Ä–∫–∏ –ø—Ä–∞–≤ –ø—Ä–æ–¥–∞–≤—Ü–∞ - —É—Å–ø–µ—à–Ω–æ"""
        # –ù–∞—Å—Ç—Ä–∞–∏–≤–∞–µ–º mock –¥–ª—è –≤–æ–∑–≤—Ä–∞—Ç–∞ True
        mock_blockchain_service._call_contract_read_function.return_value = True
        
        result = account_service.is_seller("0x742d35Cc6634C0532925a3b8D4C9db96C4b4d8b6")
        
        assert result is True
        mock_blockchain_service._call_contract_read_function.assert_called_once_with(
            "InviteNFT", "isSeller", False, "0x742d35Cc6634C0532925a3b8D4C9db96C4b4d8b6"
        )
    
    def test_is_seller_false(self, account_service, mock_blockchain_service):
        """–¢–µ—Å—Ç –ø—Ä–æ–≤–µ—Ä–∫–∏ –ø—Ä–∞–≤ –ø—Ä–æ–¥–∞–≤—Ü–∞ - –Ω–µ –ø—Ä–æ–¥–∞–≤–µ—Ü"""
        # –ù–∞—Å—Ç—Ä–∞–∏–≤–∞–µ–º mock –¥–ª—è –≤–æ–∑–≤—Ä–∞—Ç–∞ False
        mock_blockchain_service._call_contract_read_function.return_value = False
        
        result = account_service.is_seller("0x0000000000000000000000000000000000000000")
        
        assert result is False
    
    def test_validate_invite_code_with_invites(self, account_service, mock_blockchain_service):
        """–¢–µ—Å—Ç –≤–∞–ª–∏–¥–∞—Ü–∏–∏ –∏–Ω–≤–∞–π—Ç-–∫–æ–¥–∞ - –µ—Å—Ç—å –∏–Ω–≤–∞–π—Ç—ã"""
        # –ù–∞—Å—Ç—Ä–∞–∏–≤–∞–µ–º mock –¥–ª—è –≤–æ–∑–≤—Ä–∞—Ç–∞ –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ –∏–Ω–≤–∞–π—Ç–æ–≤ > 0
        mock_blockchain_service._call_contract_read_function.return_value = 5
        
        result = account_service.validate_invite_code("0x742d35Cc6634C0532925a3b8D4C9db96C4b4d8b6")
        
        assert result is True
        mock_blockchain_service._call_contract_read_function.assert_called_once_with(
            "InviteNFT", "userInviteCount", 0, "0x742d35Cc6634C0532925a3b8D4C9db96C4b4d8b6"
        )
    
    def test_validate_invite_code_no_invites(self, account_service, mock_blockchain_service):
        """–¢–µ—Å—Ç –≤–∞–ª–∏–¥–∞—Ü–∏–∏ –∏–Ω–≤–∞–π—Ç-–∫–æ–¥–∞ - –Ω–µ—Ç –∏–Ω–≤–∞–π—Ç–æ–≤"""
        # –ù–∞—Å—Ç—Ä–∞–∏–≤–∞–µ–º mock –¥–ª—è –≤–æ–∑–≤—Ä–∞—Ç–∞ 0 –∏–Ω–≤–∞–π—Ç–æ–≤
        mock_blockchain_service._call_contract_read_function.return_value = 0
        
        result = account_service.validate_invite_code("0x0000000000000000000000000000000000000000")
        
        assert result is False
    
    def test_is_user_activated_true(self, account_service, mock_blockchain_service):
        """–¢–µ—Å—Ç –ø—Ä–æ–≤–µ—Ä–∫–∏ –∞–∫—Ç–∏–≤–∞—Ü–∏–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è - –∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞–Ω"""
        mock_blockchain_service._call_contract_read_function.return_value = True
        
        result = account_service.is_user_activated("0x742d35Cc6634C0532925a3b8D4C9db96C4b4d8b6")
        
        assert result is True
    
    def test_get_all_activated_users(self, account_service, mock_blockchain_service):
        """–¢–µ—Å—Ç –ø–æ–ª—É—á–µ–Ω–∏—è —Å–ø–∏—Å–∫–∞ –∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π"""
        expected_users = ["0x123", "0x456", "0x789"]
        mock_blockchain_service._call_contract_read_function.return_value = expected_users
        
        result = account_service.get_all_activated_users()
        
        assert result == expected_users
        assert len(result) == 3
    
    def test_batch_validate_invite_codes(self, account_service, mock_blockchain_service):
        """–¢–µ—Å—Ç –ø–∞–∫–µ—Ç–Ω–æ–π –≤–∞–ª–∏–¥–∞—Ü–∏–∏ –∏–Ω–≤–∞–π—Ç-–∫–æ–¥–æ–≤"""
        invite_codes = ["CODE1", "CODE2", "CODE3"]
        user_address = "0x742d35Cc6634C0532925a3b8D4C9db96C4b4d8b6"
        
        # Mock –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –∫–æ—Ä—Ç–µ–∂ (success_array, reasons_array)
        mock_result = ([True, False, True], ["Valid", "Invalid", "Valid"])
        mock_blockchain_service._call_contract_read_function.return_value = mock_result
        
        valid_codes, invalid_codes = account_service.batch_validate_invite_codes(
            invite_codes, user_address
        )
        
        assert valid_codes == ["CODE1", "CODE3"]
        assert invalid_codes == ["CODE2"]
        assert len(valid_codes) == 2
        assert len(invalid_codes) == 1
    
    @pytest.mark.asyncio
    async def test_activate_and_mint_invites_success(self, account_service, mock_blockchain_service):
        """–¢–µ—Å—Ç —É—Å–ø–µ—à–Ω–æ–π –∞–∫—Ç–∏–≤–∞—Ü–∏–∏ –∏ –º–∏–Ω—Ç–∏–Ω–≥–∞ –∏–Ω–≤–∞–π—Ç–æ–≤"""
        invite_code = "AMANITA-TEST-CODE"
        wallet_address = "0x742d35Cc6634C0532925a3b8D4C9db96C4b4d8b6"
        
        # –ù–∞—Å—Ç—Ä–∞–∏–≤–∞–µ–º mock –¥–ª—è —É—Å–ø–µ—à–Ω–æ–≥–æ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è
        mock_blockchain_service.estimate_gas_with_multiplier.return_value = 500000
        mock_blockchain_service.transact_contract_function.return_value = "0x1234567890abcdef"
        
        # Mock –∫–æ–Ω—Ç—Ä–∞–∫—Ç–∞
        mock_contract = Mock()
        mock_contract.functions.activateAndMintInvites = Mock()
        mock_blockchain_service.get_contract.return_value = mock_contract
        
        with patch.dict(os.environ, {"SELLER_PRIVATE_KEY": "0x1234567890abcdef"}):
            result = await account_service.activate_and_mint_invites(invite_code, wallet_address)
        
        # –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ –≤–µ—Ä–Ω—É–ª—Å—è —Å–ø–∏—Å–æ–∫ –∏–∑ 12 –∫–æ–¥–æ–≤
        assert len(result) == 12
        assert all(code.startswith("AMANITA-") for code in result)
        assert all(len(code) == 20 for code in result)  # AMANITA-XXXX-YYYY
        
        # –ü—Ä–æ–≤–µ—Ä—è–µ–º –≤—ã–∑–æ–≤—ã mock –º–µ—Ç–æ–¥–æ–≤
        mock_blockchain_service.estimate_gas_with_multiplier.assert_called_once()
        mock_blockchain_service.transact_contract_function.assert_called_once()
    
    @pytest.mark.asyncio
    async def test_activate_and_mint_invites_missing_key(self, account_service):
        """–¢–µ—Å—Ç –æ—à–∏–±–∫–∏ –ø—Ä–∏ –æ—Ç—Å—É—Ç—Å—Ç–≤–∏–∏ –ø—Ä–∏–≤–∞—Ç–Ω–æ–≥–æ –∫–ª—é—á–∞ –≤ activate_and_mint_invites"""
        with patch.dict(os.environ, {}, clear=True):
            with pytest.raises(ValueError, match="SELLER_PRIVATE_KEY –Ω–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω"):
                await account_service.activate_and_mint_invites("CODE", "0x123")
    
    @pytest.mark.asyncio
    async def test_activate_and_mint_invites_transaction_failed(self, account_service, mock_blockchain_service):
        """–¢–µ—Å—Ç –æ—à–∏–±–∫–∏ –ø—Ä–∏ –Ω–µ—É–¥–∞—á–Ω–æ–π —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏"""
        invite_code = "AMANITA-TEST-CODE"
        wallet_address = "0x742d35Cc6634C0532925a3b8D4C9db96C4b4d8b6"
        
        # –ù–∞—Å—Ç—Ä–∞–∏–≤–∞–µ–º mock –¥–ª—è –Ω–µ—É–¥–∞—á–Ω–æ–π —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏
        mock_blockchain_service.estimate_gas_with_multiplier.return_value = 500000
        mock_blockchain_service.transact_contract_function.return_value = None  # –¢—Ä–∞–Ω–∑–∞–∫—Ü–∏—è –Ω–µ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–∞
        
        with patch.dict(os.environ, {"SELLER_PRIVATE_KEY": "0x1234567890abcdef"}):
            with pytest.raises(Exception, match="–¢—Ä–∞–Ω–∑–∞–∫—Ü–∏—è –Ω–µ –±—ã–ª–∞ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–∞"):
                await account_service.activate_and_mint_invites(invite_code, wallet_address)
    
    @pytest.mark.asyncio
    async def test_activate_and_mint_invites_receipt_failed(self, account_service, mock_blockchain_service):
        """–¢–µ—Å—Ç –æ—à–∏–±–∫–∏ –ø—Ä–∏ –Ω–µ—É–¥–∞—á–Ω–æ–º receipt —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏"""
        invite_code = "AMANITA-TEST-CODE"
        wallet_address = "0x742d35Cc6634C0532925a3b8D4C9db96C4b4d8b6"
        
        # –ù–∞—Å—Ç—Ä–∞–∏–≤–∞–µ–º mock –¥–ª—è –Ω–µ—É–¥–∞—á–Ω–æ–≥–æ receipt
        mock_blockchain_service.estimate_gas_with_multiplier.return_value = 500000
        mock_blockchain_service.transact_contract_function.return_value = "0x1234567890abcdef"
        
        # Mock –Ω–µ—É–¥–∞—á–Ω–æ–≥–æ receipt
        mock_web3 = Mock()
        mock_receipt = Mock()
        mock_receipt.status = 0  # –¢—Ä–∞–Ω–∑–∞–∫—Ü–∏—è –Ω–µ—É–¥–∞—á–Ω–∞
        mock_web3.eth.wait_for_transaction_receipt = Mock(return_value=mock_receipt)
        mock_blockchain_service.web3 = mock_web3
        
        with patch.dict(os.environ, {"SELLER_PRIVATE_KEY": "0x1234567890abcdef"}):
            with pytest.raises(Exception, match="–¢—Ä–∞–Ω–∑–∞–∫—Ü–∏—è –∑–∞–≤–µ—Ä—à–∏–ª–∞—Å—å —Å –æ—à–∏–±–∫–æ–π"):
                await account_service.activate_and_mint_invites(invite_code, wallet_address)
```

### üöÄ –ö–æ–º–∞–Ω–¥—ã –¥–ª—è –∑–∞–ø—É—Å–∫–∞ —Ç–µ—Å—Ç–æ–≤ AccountService

#### **1. –ó–∞–ø—É—Å–∫ –≤—Å–µ—Ö —Ç–µ—Å—Ç–æ–≤ AccountService:**
```bash
cd bot
python3 -m pytest tests/test_account_service_mock.py -v --tb=short
```

#### **2. –ó–∞–ø—É—Å–∫ –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã—Ö —Ç–µ—Å—Ç–æ–≤:**
```bash
# –¢–æ–ª—å–∫–æ —Ç–µ—Å—Ç—ã –ø—Ä–æ–≤–µ—Ä–∫–∏ –ø—Ä–∞–≤ –ø—Ä–æ–¥–∞–≤—Ü–∞
python3 -m pytest tests/test_account_service_mock.py -k "is_seller" -v

# –¢–æ–ª—å–∫–æ —Ç–µ—Å—Ç—ã –≤–∞–ª–∏–¥–∞—Ü–∏–∏ –∏–Ω–≤–∞–π—Ç-–∫–æ–¥–æ–≤
python3 -m pytest tests/test_account_service_mock.py -k "invite_code" -v

# –¢–æ–ª—å–∫–æ –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–µ —Ç–µ—Å—Ç—ã
python3 -m pytest tests/test_account_service_mock.py -k "async" -v
```

#### **3. –ó–∞–ø—É—Å–∫ —Å –ø–æ–∫—Ä—ã—Ç–∏–µ–º –∫–æ–¥–∞:**
```bash
python3 -m pytest tests/test_account_service_mock.py --cov=bot.services.core.account --cov-report=html
```

### üìä –ú–µ—Ç—Ä–∏–∫–∏ –∫–∞—á–µ—Å—Ç–≤–∞ Mock –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã

#### **–ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å:**
- **–í—Ä–µ–º—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è**: < 1 —Å–µ–∫—É–Ω–¥—ã –¥–ª—è –≤—Å–µ—Ö —Ç–µ—Å—Ç–æ–≤
- **–ò–∑–æ–ª—è—Ü–∏—è**: 100% –æ—Ç –≤–Ω–µ—à–Ω–∏—Ö –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π
- **–°—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç—å**: –î–µ—Ç–µ—Ä–º–∏–Ω–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã

#### **–ü–æ–∫—Ä—ã—Ç–∏–µ —Å—Ü–µ–Ω–∞—Ä–∏–µ–≤:**
- ‚úÖ **–£—Å–ø–µ—à–Ω—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏**: –í—Å–µ –æ—Å–Ω–æ–≤–Ω—ã–µ –º–µ—Ç–æ–¥—ã –ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω—ã
- ‚úÖ **–û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫**: –í–∞–ª–∏–¥–∞—Ü–∏—è, –æ—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –∫–ª—é—á–µ–π, –Ω–µ—É–¥–∞—á–Ω—ã–µ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏
- ‚úÖ **–ì—Ä–∞–Ω–∏—á–Ω—ã–µ —Å–ª—É—á–∞–∏**: –ü—É—Å—Ç—ã–µ –¥–∞–Ω–Ω—ã–µ, –Ω–µ–≤–∞–ª–∏–¥–Ω—ã–µ –∞–¥—Ä–µ—Å–∞
- ‚úÖ **–ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ—Å—Ç—å**: –ü—Ä–∞–≤–∏–ª—å–Ω–∞—è —Ä–∞–±–æ—Ç–∞ —Å async/await

#### **–ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º–æ—Å—Ç—å:**
- **–¶–µ–Ω—Ç—Ä–∞–ª–∏–∑–∞—Ü–∏—è**: –í—Å–µ –º–æ–∫–∏ –≤ `conftest.py`
- **–ü–µ—Ä–µ–∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ**: –§–∏–∫—Å—Ç—É—Ä—ã –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è –≤ 100% —Ç–µ—Å—Ç–æ–≤
- **–ì–∏–±–∫–æ—Å—Ç—å**: –õ–µ–≥–∫–æ –Ω–∞—Å—Ç—Ä–∞–∏–≤–∞—Ç—å –ø–æ–≤–µ–¥–µ–Ω–∏–µ –¥–ª—è —Ä–∞–∑–Ω—ã—Ö —Å—Ü–µ–Ω–∞—Ä–∏–µ–≤

### üéØ –ü—Ä–∏–Ω—Ü–∏–ø—ã Mock –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã –¥–ª—è AccountService

#### **1. –ò–∑–æ–ª—è—Ü–∏—è –æ—Ç –±–ª–æ–∫—á–µ–π–Ω–∞:**
- –í—Å–µ –≤—ã–∑–æ–≤—ã `_call_contract_read_function` –∑–∞–º–æ–∫–∞–Ω—ã
- –ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ (`estimate_gas_with_multiplier`, `transact_contract_function`) –∑–∞–º–æ–∫–∞–Ω—ã
- Web3 –æ–ø–µ—Ä–∞—Ü–∏–∏ (`wait_for_transaction_receipt`) –∑–∞–º–æ–∫–∞–Ω—ã

#### **2. –ü—Ä–µ–¥—Å–∫–∞–∑—É–µ–º–æ—Å—Ç—å –¥–∞–Ω–Ω—ã—Ö:**
- –î–µ—Ç–µ—Ä–º–∏–Ω–∏—Ä–æ–≤–∞–Ω–Ω–∞—è –≥–µ–Ω–µ—Ä–∞—Ü–∏—è –∏–Ω–≤–∞–π—Ç-–∫–æ–¥–æ–≤
- –ö–æ–Ω—Å–∏—Å—Ç–µ–Ω—Ç–Ω—ã–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã –¥–ª—è –æ–¥–∏–Ω–∞–∫–æ–≤—ã—Ö –≤—Ö–æ–¥–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö
- –õ–µ–≥–∫–æ –Ω–∞—Å—Ç—Ä–∞–∏–≤–∞–µ–º—ã–µ —Å—Ü–µ–Ω–∞—Ä–∏–∏ —É—Å–ø–µ—Ö–∞/–Ω–µ—É–¥–∞—á–∏

#### **3. –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å:**
- –û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ —Å–µ—Ç–µ–≤—ã—Ö –∑–∞–¥–µ—Ä–∂–µ–∫
- –ú–≥–Ω–æ–≤–µ–Ω–Ω–æ–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –≤—Å–µ—Ö –æ–ø–µ—Ä–∞—Ü–∏–π
- –ë—ã—Å—Ç—Ä–∞—è –æ–±—Ä–∞—Ç–Ω–∞—è —Å–≤—è–∑—å –¥–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–∞

#### **4. –ì–∏–±–∫–æ—Å—Ç—å —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è:**
- –õ–µ–≥–∫–æ –ø–µ—Ä–µ–∫–ª—é—á–∞—Ç—å—Å—è –º–µ–∂–¥—É —Ä–∞–∑–ª–∏—á–Ω—ã–º–∏ —Å—Ü–µ–Ω–∞—Ä–∏—è–º–∏
- –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è edge cases
- –ò–∑–æ–ª—è—Ü–∏—è —Ç–µ—Å—Ç–æ–≤ –¥—Ä—É–≥ –æ—Ç –¥—Ä—É–≥–∞

### üîó –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–π Mock –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–æ–π

#### **1. –°–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å —Å conftest.py:**
```python
# bot/tests/conftest.py - –î–æ–±–∞–≤–ª–µ–Ω–∏–µ AccountService –º–æ–∫–æ–≤

@pytest.fixture
def mock_account_service_for_registry(mock_blockchain_service_for_account):
    """Mock AccountService –¥–ª—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –≤ ProductRegistryService —Ç–µ—Å—Ç–∞—Ö"""
    from bot.services.core.account import AccountService
    
    with patch.dict(os.environ, {"SELLER_PRIVATE_KEY": "0x1234567890abcdef"}):
        return AccountService(mock_blockchain_service_for_account)
```

#### **2. –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –≤ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏—Ö —Ç–µ—Å—Ç–∞—Ö:**
```python
# bot/tests/test_product_registry_unit.py - –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ mock AccountService

@pytest.fixture
def mock_registry_service_with_account(mock_account_service_for_registry):
    """ProductRegistryService —Å mock AccountService"""
    from bot.dependencies import get_product_registry_service
    
    return get_product_registry_service(
        blockchain_service=mock_blockchain_service(),
        storage_service=mock_ipfs_storage(),
        validation_service=mock_validation_service(),
        account_service=mock_account_service_for_registry  # –ò—Å–ø–æ–ª—å–∑—É–µ–º mock AccountService
    )
```

### üìù –ó–∞–∫–ª—é—á–µ–Ω–∏–µ –ø–æ Mock –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–µ AccountService

**AccountService** —Ç–µ–ø–µ—Ä—å –∏–º–µ–µ—Ç –ø–æ–ª–Ω–æ—Ü–µ–Ω–Ω—É—é Mock –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—É, –∫–æ—Ç–æ—Ä–∞—è:

1. **–ò–∑–æ–ª–∏—Ä—É–µ—Ç —Ç–µ—Å—Ç—ã** –æ—Ç –≤–Ω–µ—à–Ω–∏—Ö –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π (–±–ª–æ–∫—á–µ–π–Ω, IPFS)
2. **–û–±–µ—Å–ø–µ—á–∏–≤–∞–µ—Ç –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å** (–≤—Å–µ —Ç–µ—Å—Ç—ã –∑–∞ < 1 —Å–µ–∫—É–Ω–¥—ã)
3. **–ì–∞—Ä–∞–Ω—Ç–∏—Ä—É–µ—Ç —Å—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç—å** (–¥–µ—Ç–µ—Ä–º–∏–Ω–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã)
4. **–ò–Ω—Ç–µ–≥—Ä–∏—Ä—É–µ—Ç—Å—è** —Å —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–π Mock –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–æ–π ProductRegistryService
5. **–ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç –≥–∏–±–∫–æ—Å—Ç—å** (–ª–µ–≥–∫–æ –Ω–∞—Å—Ç—Ä–∞–∏–≤–∞–µ–º—ã–µ —Å—Ü–µ–Ω–∞—Ä–∏–∏)

Mock –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –¥–ª—è AccountService —Å–ª–µ–¥—É–µ—Ç —Ç–µ–º –∂–µ –ø—Ä–∏–Ω—Ü–∏–ø–∞–º, —á—Ç–æ –∏ –¥–ª—è ProductRegistryService, –æ–±–µ—Å–ø–µ—á–∏–≤–∞—è –µ–¥–∏–Ω–æ–æ–±—Ä–∞–∑–∏–µ –∏ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º–æ—Å—Ç—å —Ç–µ—Å—Ç–æ–≤–æ–π —Å–∏—Å—Ç–µ–º—ã.