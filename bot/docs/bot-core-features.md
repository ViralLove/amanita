# Требования к онбордингу и функционалу бота Amanita

## 1. Требования к онбордингу пользователя
- При активации инвайта для нового пользователя должен создаваться крипто-адрес (кошелек).
- Приватный ключ/seed-фраза должны храниться безопасно (желательно — только на стороне пользователя, либо с шифрованием).
- Пользователь должен получить seed-фразу для резервного копирования.
- При удалении и повторной установке бота пользователь должен иметь возможность восстановить свой адрес по seed-фразе (как в обычном криптокошельке).
- Вся логика активации инвайта, генерации новых инвайтов, проверки статуса и истории должна быть реализована через смарт-контракт InviteNFT.

## 2. Требования к онбордингу и авторизации продавца
- Продавец (seller) должен иметь возможность авторизоваться в боте через seed-фразу (или приватный ключ).
- После авторизации продавец получает доступ к расширенному функционалу (администрирование магазина, минтинг инвайтов, аналитика и т.д.).
- Роли пользователя и продавца должны быть четко разделены в интерфейсе и логике бота.

## 3. Безопасность
- Приватные ключи/seed-фразы не должны храниться на сервере в открытом виде.
- Пользователь должен быть предупрежден о необходимости сохранить seed-фразу.
- Восстановление доступа возможно только по seed-фразе (без возможности восстановления через поддержку).

---

# GAP-анализ текущей реализации бота

## Что уже реализовано:
- Есть базовый flow онбординга: выбор языка, приветствие, переход к вводу инвайта.
- Реализован сервис для работы с контрактом InviteNFT (BlockchainService), поддерживающий все необходимые методы для проверки и активации инвайтов, генерации новых инвайтов, проверки статуса пользователя и инвайта.
- Локализация сообщений и шаблоны для разных языков.
- Интеграционные тесты, моделирующие полный flow онбординга на уровне смарт-контракта.

## Чего не хватает для полного онбординга и поддержки ролей:

### 1. Генерация и хранение кошелька пользователя
- [ ] Нет генерации seed-фразы и приватного ключа на этапе активации инвайта.
- [ ] Нет безопасного хранения seed-фразы/приватного ключа на стороне пользователя (например, с шифрованием или только локально).
- [ ] Нет механизма передачи seed-фразы пользователю (например, через отдельное сообщение с предупреждением).
- [ ] Нет восстановления кошелька по seed-фразе при повторной установке бота.

### 2. Авторизация продавца
- [ ] Нет отдельного flow для авторизации продавца через seed-фразу/приватный ключ.
- [ ] Нет разграничения ролей (user/seller) в логике и интерфейсе бота.
- [ ] Нет отдельного набора команд и интерфейса для продавца (администрирование, минтинг, аналитика).

### 3. Безопасность
- [ ] Нет явного предупреждения пользователя о необходимости сохранить seed-фразу.
- [ ] Нет проверки, что seed-фраза не хранится на сервере в открытом виде.

### 4. UX и дополнительные сценарии
- [ ] Нет сценария повторного входа пользователя по seed-фразе.
- [ ] Нет сценария повторного входа продавца по seed-фразе.
- [ ] Нет уведомлений и подсказок по резервному копированию и восстановлению доступа.

---

## Рекомендации по доработке
- Реализовать генерацию и безопасную передачу seed-фразы пользователю при активации инвайта.
- Добавить сценарий восстановления кошелька по seed-фразе для пользователя и продавца.
- Ввести разделение ролей и соответствующие интерфейсы/команды в боте.
- Усилить безопасность хранения приватных данных (минимум — не хранить на сервере, максимум — использовать шифрование на устройстве пользователя).
- Добавить подробные инструкции и предупреждения для пользователей о важности seed-фразы.

# План работы
1. Проектирование архитектуры хранения и восстановления кошельков (seed-фраза, приватный ключ)
2. Реализация пользовательского онбординга с генерацией и передачей seed-фразы
3. Реализация сценария восстановления кошелька по seed-фразе для пользователя
4. Реализация сценария авторизации продавца по seed-фразе/приватному ключу
5. Введение и разграничение ролей (user/seller) в логике и интерфейсе бота
6. Реализация функционала для продавца (администрирование, минтинг, аналитика)
7. Усиление безопасности и UX: предупреждения, инструкции, отсутствие хранения приватных данных на сервере
8. Интеграционное тестирование полного flow для обеих ролей