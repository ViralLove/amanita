# üß™ –≠—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ —Ç–µ—Å—Ç–æ–≤ API

## üéØ –ü—Ä–∏–Ω—Ü–∏–ø—ã —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è API

### ‚úÖ **–ü–†–ê–í–ò–õ–¨–ù–´–ô –ü–û–î–•–û–î (–∫–æ—Ç–æ—Ä—ã–π –º—ã –∏—Å–ø–æ–ª—å–∑—É–µ–º):**
- **–°–µ—Ä–≤–∏—Å–Ω—ã–π —Å–ª–æ–π —É–∂–µ –ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω** ‚Üí –º–æ–∫–∞–µ–º —Å–µ—Ä–≤–∏—Å—ã –≤ API —Ç–µ—Å—Ç–∞—Ö
- **API —Ç–µ—Å—Ç—ã —Ñ–æ–∫—É—Å–∏—Ä—É—é—Ç—Å—è –Ω–∞:** HTTP –ª–æ–≥–∏–∫–µ, –≤–∞–ª–∏–¥–∞—Ü–∏–∏, –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏, –º–∞—Ä—à—Ä—É—Ç–∏–∑–∞—Ü–∏–∏
- **–ú–∏–Ω–∏–º—É–º –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã—Ö —Ç–µ—Å—Ç–æ–≤** ‚Üí —Ç–æ–ª—å–∫–æ –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è —Å–ª–æ–µ–≤
- **–ë—ã—Å—Ç—Ä—ã–µ –∏ –Ω–∞–¥–µ–∂–Ω—ã–µ —Ç–µ—Å—Ç—ã** ‚Üí –±–µ–∑ –≤–Ω–µ—à–Ω–∏—Ö –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π

### ‚ùå **–ù–ï–ü–†–ê–í–ò–õ–¨–ù–´–ô –ü–û–î–•–û–î (–∫–æ—Ç–æ—Ä—ã–π –∏–∑–±–µ–≥–∞–µ–º):**
- –î—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ —Ç–µ—Å—Ç–æ–≤ —Å–µ—Ä–≤–∏—Å–Ω–æ–≥–æ —Å–ª–æ—è
- –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∏ –≤ API —Ç–µ—Å—Ç–∞—Ö
- –ú–µ–¥–ª–µ–Ω–Ω—ã–µ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ —Ç–µ—Å—Ç—ã
- –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç—å –æ—Ç –≤–Ω–µ—à–Ω–∏—Ö —Å–µ—Ä–≤–∏—Å–æ–≤

## üèóÔ∏è –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è API

### üìä **–°–ª–æ–∏ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è:**

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ                    API TESTS (100% –º–æ–∫–∏)                   ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ  HTTP Logic ‚îÇ Validation ‚îÇ Auth ‚îÇ Routing ‚îÇ Error Handling ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                              ‚îÇ
                              ‚ñº
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ              SERVICE LAYER (—É–∂–µ –ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω)             ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ  Business Logic ‚îÇ Data Processing ‚îÇ External Integrations  ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

### üé≠ **–°—Ç—Ä–∞—Ç–µ–≥–∏—è –º–æ–∫–∏—Ä–æ–≤–∞–Ω–∏—è:**

```python
# –í API —Ç–µ—Å—Ç–∞—Ö –º–æ–∫–∞–µ–º –í–°–ï —Å–µ—Ä–≤–∏—Å—ã
@pytest.fixture
def mock_product_registry_service():
    """–ü–æ–ª–Ω–æ—Å—Ç—å—é –∑–∞–º–æ–∫–∞–Ω–Ω—ã–π ProductRegistryService –¥–ª—è –Ω–æ–≤–æ–π –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã —Å organic_components"""
    mock_service = Mock()
    mock_service.create_product = AsyncMock(return_value={
        "status": "success",
        "id": "test_product_001",
        "blockchain_id": "123",
        "metadata_cid": "QmValidCID123...",
        "tx_hash": "0x1234567890abcdef..."
    })
    return mock_service

@pytest.fixture
def mock_blockchain_service():
    """–ü–æ–ª–Ω–æ—Å—Ç—å—é –∑–∞–º–æ–∫–∞–Ω–Ω—ã–π BlockchainService"""
    mock_service = Mock()
    mock_service.get_product = AsyncMock(return_value=MockProduct())
    return mock_service
```

## üìÅ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Ç–µ—Å—Ç–æ–≤ API

### üóÇÔ∏è **–û—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏—è —Ñ–∞–π–ª–æ–≤:**

```
bot/tests/api/
‚îú‚îÄ‚îÄ unit/                          # Unit —Ç–µ—Å—Ç—ã API –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤
‚îÇ   ‚îú‚îÄ‚îÄ test_models.py            # Pydantic –º–æ–¥–µ–ª–∏ (–≤–∫–ª—é—á–∞—è OrganicComponentAPI)
‚îÇ   ‚îú‚îÄ‚îÄ test_dependencies.py      # Dependency injection
‚îÇ   ‚îú‚îÄ‚îÄ test_utils.py             # API —É—Ç–∏–ª–∏—Ç—ã
‚îÇ   ‚îî‚îÄ‚îÄ test_middleware.py        # Middleware –ª–æ–≥–∏–∫–∞
‚îÇ
‚îú‚îÄ‚îÄ integration/                   # –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ —Ç–µ—Å—Ç—ã API
‚îÇ   ‚îú‚îÄ‚îÄ test_products_api.py      # Products endpoints —Å organic_components
‚îÇ   ‚îú‚îÄ‚îÄ test_api_keys_api.py      # API keys endpoints
‚îÇ   ‚îú‚îÄ‚îÄ test_health_api.py        # Health endpoints
‚îÇ   ‚îî‚îÄ‚îÄ test_auth_api.py          # Authentication
‚îÇ
‚îú‚îÄ‚îÄ fixtures/                      # –¶–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã–µ —Ñ–∏–∫—Å—Ç—É—Ä—ã
‚îÇ   ‚îú‚îÄ‚îÄ conftest.py               # –û—Å–Ω–æ–≤–Ω—ã–µ —Ñ–∏–∫—Å—Ç—É—Ä—ã
‚îÇ   ‚îú‚îÄ‚îÄ mock_services.py          # –ú–æ–∫–∏ —Å–µ—Ä–≤–∏—Å–æ–≤
‚îÇ   ‚îî‚îÄ‚îÄ test_data.py              # –¢–µ—Å—Ç–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ —Å organic_components
‚îÇ
‚îî‚îÄ‚îÄ e2e/                          # End-to-end —Ç–µ—Å—Ç—ã (–º–∏–Ω–∏–º–∞–ª—å–Ω–æ)
    ‚îî‚îÄ‚îÄ test_api_connectivity.py  # –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è —Å–ª–æ–µ–≤
```

## üß™ –¢–∏–ø—ã —Ç–µ—Å—Ç–æ–≤ API

### 1. **Unit —Ç–µ—Å—Ç—ã (80% –ø–æ–∫—Ä—ã—Ç–∏—è)**

#### **–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ Pydantic –º–æ–¥–µ–ª–µ–π —Å organic_components:**
```python
def test_organic_component_api_validation():
    """–¢–µ—Å—Ç –≤–∞–ª–∏–¥–∞—Ü–∏–∏ –º–æ–¥–µ–ª–∏ OrganicComponentAPI"""
    # –í–∞–ª–∏–¥–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ
    valid_component = {
        "biounit_id": "amanita_muscaria",
        "description_cid": "QmdoqBWBZoupjQWFfBxMJD5N9dJSFTyjVEV1AVL8oNEVSG",
        "proportion": "100%"
    }
    component = OrganicComponentAPI(**valid_component)
    assert component.biounit_id == "amanita_muscaria"
    assert component.proportion == "100%"
    
    # –ù–µ–≤–∞–ª–∏–¥–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ - –ø—É—Å—Ç–æ–π biounit_id
    with pytest.raises(ValidationError):
        OrganicComponentAPI(
            biounit_id="",
            description_cid="QmValidCID123...",
            proportion="100%"
        )
    
    # –ù–µ–≤–∞–ª–∏–¥–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ - –Ω–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π CID
    with pytest.raises(InvalidCIDError):
        OrganicComponentAPI(
            biounit_id="amanita_muscaria",
            description_cid="invalid_cid",
            proportion="100%"
        )

def test_product_upload_in_model_validation():
    """–¢–µ—Å—Ç –≤–∞–ª–∏–¥–∞—Ü–∏–∏ –º–æ–¥–µ–ª–∏ ProductUploadIn —Å organic_components"""
    # –í–∞–ª–∏–¥–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ —Å organic_components
    valid_data = {
        "id": "test_product_001",
        "title": "Amanita Muscaria ‚Äî Powder",
        "organic_components": [
            {
                "biounit_id": "amanita_muscaria",
                "description_cid": "QmdoqBWBZoupjQWFfBxMJD5N9dJSFTyjVEV1AVL8oNEVSG",
                "proportion": "100%"
            }
        ],
        "cover_image": "QmYrs5gAMeZEmiFAJnmRcD19rpCpXF52ssMJ6X2oWrxWWj",
        "categories": ["mushroom", "medicinal"],
        "forms": ["powder"],
        "species": "Amanita Muscaria",
        "prices": [
            {
                "weight": "100",
                "weight_unit": "g",
                "price": "80",
                "currency": "EUR"
            }
        ]
    }
    product = ProductUploadIn(**valid_data)
    assert product.title == "Amanita Muscaria ‚Äî Powder"
    assert len(product.organic_components) == 1
    assert product.organic_components[0].biounit_id == "amanita_muscaria"
    
    # –ù–µ–≤–∞–ª–∏–¥–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ - –æ—Ç—Å—É—Ç—Å—Ç–≤—É—é—Ç organic_components
    with pytest.raises(ValidationError):
        ProductUploadIn(
            id="test_002",
            title="Test Product",
            organic_components=[],  # –ü—É—Å—Ç–æ–π —Å–ø–∏—Å–æ–∫
            cover_image="QmValidCID123...",
            categories=["test"],
            forms=["powder"],
            species="Test Species",
            prices=[{"weight": "100", "weight_unit": "g", "price": "50", "currency": "EUR"}]
        )
    
    # –ù–µ–≤–∞–ª–∏–¥–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ - –¥—É–±–ª–∏—Ä—É—é—â–∏–µ—Å—è biounit_id
    with pytest.raises(ValidationError):
        ProductUploadIn(
            id="test_003",
            title="Test Product",
            organic_components=[
                {
                    "biounit_id": "amanita_muscaria",  # –î—É–±–ª–∏—Ä—É—é—â–∏–π—Å—è ID
                    "description_cid": "QmCID1...",
                    "proportion": "70%"
                },
                {
                    "biounit_id": "amanita_muscaria",  # –î—É–±–ª–∏—Ä—É—é—â–∏–π—Å—è ID
                    "description_cid": "QmCID2...",
                    "proportion": "30%"
                }
            ],
            cover_image="QmValidCID123...",
            categories=["test"],
            forms=["powder"],
            species="Test Species",
            prices=[{"weight": "100", "weight_unit": "g", "price": "50", "currency": "EUR"}]
        )
```

#### **–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ Dependency Injection:**
```python
async def test_get_product_registry_service():
    """–¢–µ—Å—Ç –ø–æ–ª—É—á–µ–Ω–∏—è ProductRegistryService –∏–∑ DI –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞"""
    service = await get_product_registry_service()
    assert isinstance(service, ProductRegistryService)
    assert hasattr(service, 'create_product')
    assert hasattr(service, 'update_product')
```

#### **–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ Middleware:**
```python
async def test_hmac_middleware_valid_signature():
    """–¢–µ—Å—Ç HMAC middleware —Å –≤–∞–ª–∏–¥–Ω–æ–π –ø–æ–¥–ø–∏—Å—å—é"""
    # –¢–µ—Å—Ç–∏—Ä—É–µ–º —Ç–æ–ª—å–∫–æ –ª–æ–≥–∏–∫—É middleware, –Ω–µ —Ä–µ–∞–ª—å–Ω—ã–µ —Å–µ—Ä–≤–∏—Å—ã
```

### 2. **–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ —Ç–µ—Å—Ç—ã API (15% –ø–æ–∫—Ä—ã—Ç–∏—è)**

#### **–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ HTTP endpoints —Å organic_components:**
```python
@pytest.mark.asyncio
async def test_create_product_endpoint_success_with_organic_components(
    client: AsyncClient,
    mock_product_registry_service,
    valid_product_data_with_organic_components,
    valid_hmac_headers
):
    """–¢–µ—Å—Ç —É—Å–ø–µ—à–Ω–æ–≥–æ —Å–æ–∑–¥–∞–Ω–∏—è –ø—Ä–æ–¥—É–∫—Ç–∞ —Å organic_components —á–µ—Ä–µ–∑ API"""
    # Arrange
    with patch('bot.api.dependencies.get_product_registry_service', 
               return_value=mock_product_registry_service):
        
        # Act
        response = await client.post(
            "/api/products/upload",
            json={"products": [valid_product_data_with_organic_components]},
            headers=valid_hmac_headers
        )
        
        # Assert
        assert response.status_code == 200
        result = response.json()
        assert result["results"][0]["status"] == "success"
        assert "blockchain_id" in result["results"][0]
        
        # –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ —Å–µ—Ä–≤–∏—Å –±—ã–ª –≤—ã–∑–≤–∞–Ω
        mock_product_registry_service.create_product.assert_called_once()

@pytest.mark.asyncio
async def test_update_product_endpoint_with_organic_components(
    client: AsyncClient,
    mock_product_registry_service,
    valid_product_update_data,
    valid_hmac_headers
):
    """–¢–µ—Å—Ç –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –ø—Ä–æ–¥—É–∫—Ç–∞ —Å organic_components —á–µ—Ä–µ–∑ API"""
    # Arrange
    product_id = "test_product_001"
    with patch('bot.api.dependencies.get_product_registry_service', 
               return_value=mock_product_registry_service):
        
        # Act
        response = await client.put(
            f"/api/products/{product_id}",
            json=valid_product_update_data,
            headers=valid_hmac_headers
        )
        
        # Assert
        assert response.status_code == 200
        result = response.json()
        assert result["status"] == "success"
        
        # –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ —Å–µ—Ä–≤–∏—Å –±—ã–ª –≤—ã–∑–≤–∞–Ω
        mock_product_registry_service.update_product.assert_called_once()
```

#### **–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –≤–∞–ª–∏–¥–∞—Ü–∏–∏ API —Å organic_components:**
```python
@pytest.mark.asyncio
async def test_create_product_validation_error_missing_organic_components(
    client: AsyncClient,
    invalid_product_data_missing_organic_components,
    valid_hmac_headers
):
    """–¢–µ—Å—Ç –≤–∞–ª–∏–¥–∞—Ü–∏–∏ –¥–∞–Ω–Ω—ã—Ö —Å –æ—Ç—Å—É—Ç—Å—Ç–≤—É—é—â–∏–º–∏ organic_components"""
    response = await client.post(
        "/api/products/upload",
        json={"products": [invalid_product_data_missing_organic_components]},
        headers=valid_hmac_headers
    )
    
    assert response.status_code == 422
    error_detail = response.json()["detail"]
    assert "organic_components" in str(error_detail).lower()

@pytest.mark.asyncio
async def test_create_product_validation_error_invalid_organic_components(
    client: AsyncClient,
    invalid_product_data_invalid_organic_components,
    valid_hmac_headers
):
    """–¢–µ—Å—Ç –≤–∞–ª–∏–¥–∞—Ü–∏–∏ –¥–∞–Ω–Ω—ã—Ö —Å –Ω–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–º–∏ organic_components"""
    response = await client.post(
        "/api/products/upload",
        json={"products": [invalid_product_data_invalid_organic_components]},
        headers=valid_hmac_headers
    )
    
    assert response.status_code == 422
    error_detail = response.json()["detail"]
    assert "validation error" in str(error_detail).lower()
```

### 3. **End-to-End —Ç–µ—Å—Ç—ã (5% –ø–æ–∫—Ä—ã—Ç–∏—è)**

#### **–ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è —Å–ª–æ–µ–≤:**
```python
@pytest.mark.asyncio
async def test_api_service_layer_connection():
    """–¢–µ—Å—Ç —á—Ç–æ API –ø—Ä–∞–≤–∏–ª—å–Ω–æ –ø–æ–¥–∫–ª—é—á–∞–µ—Ç—Å—è –∫ —Å–µ—Ä–≤–∏—Å–Ω–æ–º—É —Å–ª–æ—é"""
    # –ú–∏–Ω–∏–º–∞–ª—å–Ω—ã–π —Ç–µ—Å—Ç –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã
    # –ù–ï —Ç–µ—Å—Ç–∏—Ä—É–µ–º –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫—É, —Ç–æ–ª—å–∫–æ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ
```

## üîß –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è

### **1. –¶–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã–µ –º–æ–∫–∏ —Å–µ—Ä–≤–∏—Å–æ–≤ –¥–ª—è organic_components:**

```python
# bot/tests/api/fixtures/mock_services.py

class MockProductRegistryService:
    """–ü–æ–ª–Ω–æ—Å—Ç—å—é –∑–∞–º–æ–∫–∞–Ω–Ω—ã–π ProductRegistryService –¥–ª—è API —Ç–µ—Å—Ç–æ–≤ —Å organic_components"""
    
    def __init__(self):
        self.create_product = AsyncMock()
        self.get_product = AsyncMock()
        self.update_product = AsyncMock()
        self.delete_product = AsyncMock()
        self.validate_product = AsyncMock()
        
        # –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ø–æ–≤–µ–¥–µ–Ω–∏—è –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é –¥–ª—è organic_components
        self.create_product.return_value = {
            "status": "success",
            "id": "test_product_001",
            "blockchain_id": "123",
            "metadata_cid": "QmValidCID123...",
            "tx_hash": "0x1234567890abcdef..."
        }
        
        self.get_product.return_value = MockProduct(
            id="test_product_001",
            title="Test Product",
            organic_components=[
                MockOrganicComponent(
                    biounit_id="amanita_muscaria",
                    description_cid="QmValidCID123...",
                    proportion="100%"
                )
            ],
            status=1
        )
        
        self.validate_product.return_value = True

class MockOrganicComponent:
    """–ú–æ–∫ –¥–ª—è –æ—Ä–≥–∞–Ω–∏—á–µ—Å–∫–æ–≥–æ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞"""
    def __init__(self, biounit_id, description_cid, proportion):
        self.biounit_id = biounit_id
        self.description_cid = description_cid
        self.proportion = proportion

@pytest.fixture
def mock_product_registry_service():
    """–§–∏–∫—Å—Ç—É—Ä–∞ –¥–ª—è –∑–∞–º–æ–∫–∞–Ω–Ω–æ–≥–æ ProductRegistryService"""
    return MockProductRegistryService()
```

### **2. –¢–µ—Å—Ç–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ —Å organic_components:**

```python
# bot/tests/api/fixtures/test_data.py

@pytest.fixture
def valid_product_data_with_organic_components():
    """–í–∞–ª–∏–¥–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è –ø—Ä–æ–¥—É–∫—Ç–∞ —Å organic_components"""
    return {
        "id": "amanita_muscaria_powder_001",
        "title": "Amanita Muscaria ‚Äî Powder",
        "organic_components": [
            {
                "biounit_id": "amanita_muscaria",
                "description_cid": "QmdoqBWBZoupjQWFfBxMJD5N9dJSFTyjVEV1AVL8oNEVSG",
                "proportion": "100%"
            }
        ],
        "cover_image": "QmYrs5gAMeZEmiFAJnmRcD19rpCpXF52ssMJ6X2oWrxWWj",
        "categories": ["mushroom", "medicinal"],
        "forms": ["powder"],
        "species": "Amanita Muscaria",
        "prices": [
            {
                "weight": "100",
                "weight_unit": "g",
                "price": "80",
                "currency": "EUR"
            }
        ]
    }

@pytest.fixture
def valid_product_update_data():
    """–í–∞–ª–∏–¥–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –ø—Ä–æ–¥—É–∫—Ç–∞ —Å organic_components"""
    return {
        "title": "Amanita Muscaria ‚Äî Premium Powder",
        "organic_components": [
            {
                "biounit_id": "amanita_muscaria",
                "description_cid": "QmdoqBWBZoupjQWFfBxMJD5N9dJSFTyjVEV1AVL8oNEVSG",
                "proportion": "100%"
            }
        ],
        "cover_image": "QmYrs5gAMeZEmiFAJnmRcD19rpCpXF52ssMJ6X2oWrxWWj",
        "categories": ["mushroom", "medicinal", "premium"],
        "forms": ["powder", "capsules"],
        "species": "Amanita Muscaria"
    }

@pytest.fixture
def invalid_product_data_missing_organic_components():
    """–ù–µ–≤–∞–ª–∏–¥–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ —Å –æ—Ç—Å—É—Ç—Å—Ç–≤—É—é—â–∏–º–∏ organic_components"""
    return {
        "id": "test_product_001",
        "title": "Test Product",
        # organic_components –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç - –¥–æ–ª–∂–Ω–æ –≤—ã–∑–≤–∞—Ç—å –æ—à–∏–±–∫—É –≤–∞–ª–∏–¥–∞—Ü–∏–∏
        "cover_image": "QmValidCID123...",
        "categories": ["test"],
        "forms": ["powder"],
        "species": "Test Species",
        "prices": [
            {
                "weight": "100",
                "weight_unit": "g",
                "price": "50",
                "currency": "EUR"
            }
        ]
    }

@pytest.fixture
def invalid_product_data_invalid_organic_components():
    """–ù–µ–≤–∞–ª–∏–¥–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ —Å –Ω–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–º–∏ organic_components"""
    return {
        "id": "test_product_002",
        "title": "Test Product",
        "organic_components": [
            {
                "biounit_id": "",  # –ü—É—Å—Ç–æ–π biounit_id
                "description_cid": "QmValidCID123...",
                "proportion": "100%"
            }
        ],
        "cover_image": "QmValidCID123...",
        "categories": ["test"],
        "forms": ["powder"],
        "species": "Test Species",
        "prices": [
            {
                "weight": "100",
                "weight_unit": "g",
                "price": "50",
                "currency": "EUR"
            }
        ]
    }

@pytest.fixture
def multi_component_product_data():
    """–î–∞–Ω–Ω—ã–µ –¥–ª—è –º–Ω–æ–≥–æ–∫–æ–º–ø–æ–Ω–µ–Ω—Ç–Ω–æ–≥–æ –ø—Ä–æ–¥—É–∫—Ç–∞"""
    return {
        "id": "premium_blend_001",
        "title": "Premium Mushroom Blend",
        "organic_components": [
            {
                "biounit_id": "amanita_muscaria",
                "description_cid": "QmdoqBWBZoupjQWFfBxMJD5N9dJSFTyjVEV1AVL8oNEVSG",
                "proportion": "60%"
            },
            {
                "biounit_id": "blue_lotus",
                "description_cid": "QmBlueLotusCID1234567890123456789012345678901234567890",
                "proportion": "25%"
            },
            {
                "biounit_id": "chaga",
                "description_cid": "QmChagaCID1234567890123456789012345678901234567890",
                "proportion": "15%"
            }
        ],
        "cover_image": "QmYrs5gAMeZEmiFAJnmRcD19rpCpXF52ssMJ6X2oWrxWWj",
        "categories": ["mushroom", "medicinal", "premium", "blend"],
        "forms": ["powder", "capsules"],
        "species": "Mixed Mushroom Blend",
        "prices": [
            {
                "weight": "100",
                "weight_unit": "g",
                "price": "120",
                "currency": "EUR"
            },
            {
                "weight": "250",
                "weight_unit": "g",
                "price": "280",
                "currency": "EUR"
            }
        ]
    }

@pytest.fixture
def invalid_product_data_duplicate_biounit_ids():
    """–ù–µ–≤–∞–ª–∏–¥–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ —Å –¥—É–±–ª–∏—Ä—É—é—â–∏–º–∏—Å—è biounit_id"""
    return {
        "id": "test_product_003",
        "title": "Test Product",
        "organic_components": [
            {
                "biounit_id": "amanita_muscaria",  # –î—É–±–ª–∏—Ä—É—é—â–∏–π—Å—è ID
                "description_cid": "QmCID1...",
                "proportion": "70%"
            },
            {
                "biounit_id": "amanita_muscaria",  # –î—É–±–ª–∏—Ä—É—é—â–∏–π—Å—è ID
                "description_cid": "QmCID2...",
                "proportion": "30%"
            }
        ],
        "cover_image": "QmValidCID123...",
        "categories": ["test"],
        "forms": ["powder"],
        "species": "Test Species",
        "prices": [
            {
                "weight": "100",
                "weight_unit": "g",
                "price": "50",
                "currency": "EUR"
            }
        ]
    }
```

### **3. HTTP –∫–ª–∏–µ–Ω—Ç –¥–ª—è —Ç–µ—Å—Ç–æ–≤:**

```python
# bot/tests/api/fixtures/conftest.py

@pytest.fixture
async def client():
    """Async HTTP –∫–ª–∏–µ–Ω—Ç –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è API"""
    from bot.api.main import app
    from httpx import AsyncClient
    
    async with AsyncClient(app=app, base_url="http://test") as client:
        yield client

@pytest.fixture
def valid_hmac_headers():
    """–í–∞–ª–∏–¥–Ω—ã–µ HMAC –∑–∞–≥–æ–ª–æ–≤–∫–∏ –¥–ª—è –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏"""
    return {
        "X-API-Key": "test-api-key",
        "X-Timestamp": str(int(time.time())),
        "X-Signature": "valid-signature-hash"
    }
```

## üìä –ú–µ—Ç—Ä–∏–∫–∏ –∫–∞—á–µ—Å—Ç–≤–∞ —Ç–µ—Å—Ç–æ–≤

### **–¶–µ–ª–µ–≤—ã–µ –ø–æ–∫–∞–∑–∞—Ç–µ–ª–∏:**

- **–í—Ä–µ–º—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è:** < 5 —Å–µ–∫—É–Ω–¥ –¥–ª—è –≤—Å–µ—Ö API —Ç–µ—Å—Ç–æ–≤
- **–ü–æ–∫—Ä—ã—Ç–∏–µ –∫–æ–¥–∞:** 90%+ –¥–ª—è API —Å–ª–æ—è
- **–ò–∑–æ–ª—è—Ü–∏—è:** 100% –º–æ–∫–∏ –¥–ª—è –≤–Ω–µ—à–Ω–∏—Ö –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π
- **–ù–∞–¥–µ–∂–Ω–æ—Å—Ç—å:** 0% flaky —Ç–µ—Å—Ç–æ–≤
- **–ß–∏—Ç–∞–µ–º–æ—Å—Ç—å:** –ü–æ–Ω—è—Ç–Ω—ã–µ –Ω–∞–∑–≤–∞–Ω–∏—è –∏ —Å—Ç—Ä—É–∫—Ç—É—Ä–∞

### **–ú–µ—Ç—Ä–∏–∫–∏ —É—Å–ø–µ—Ö–∞:**

```bash
# –ë—ã—Å—Ç—Ä—ã–µ —Ç–µ—Å—Ç—ã
pytest bot/tests/api/ -v --durations=10
# –û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç: –≤—Å–µ —Ç–µ—Å—Ç—ã < 100ms

# –ü–æ–ª–Ω–æ–µ –ø–æ–∫—Ä—ã—Ç–∏–µ
pytest bot/tests/api/ --cov=bot.api --cov-report=html
# –û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç: 90%+ coverage

# –ò–∑–æ–ª—è—Ü–∏—è –æ—Ç –≤–Ω–µ—à–Ω–∏—Ö –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π
pytest bot/tests/api/ --tb=short
# –û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç: 0 network calls, 0 external dependencies

# –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ organic_components
pytest bot/tests/api/ -k "organic_components" -v
# –û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç: –≤—Å–µ —Ç–µ—Å—Ç—ã —Å organic_components –ø—Ä–æ—Ö–æ–¥—è—Ç
```

## üéØ –ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞ —Ç–∞–∫–æ–≥–æ –ø–æ–¥—Ö–æ–¥–∞

### **1. –°–∫–æ—Ä–æ—Å—Ç—å:**
- ‚úÖ –¢–µ—Å—Ç—ã –≤—ã–ø–æ–ª–Ω—è—é—Ç—Å—è –∑–∞ –º–∏–ª–ª–∏—Å–µ–∫—É–Ω–¥—ã
- ‚úÖ –ù–µ—Ç –æ–∂–∏–¥–∞–Ω–∏—è –≤–Ω–µ—à–Ω–∏—Ö —Å–µ—Ä–≤–∏—Å–æ–≤
- ‚úÖ –ü–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ

### **2. –ù–∞–¥–µ–∂–Ω–æ—Å—Ç—å:**
- ‚úÖ 0% flaky —Ç–µ—Å—Ç–æ–≤
- ‚úÖ –ü—Ä–µ–¥—Å–∫–∞–∑—É–µ–º—ã–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã
- ‚úÖ –ò–∑–æ–ª—è—Ü–∏—è –æ—Ç –≤–Ω–µ—à–Ω–∏—Ö –ø—Ä–æ–±–ª–µ–º

### **3. –ü–æ–¥–¥–µ—Ä–∂–∫–∞:**
- ‚úÖ –õ–µ–≥–∫–æ –æ–±–Ω–æ–≤–ª—è—Ç—å –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ API
- ‚úÖ –ß–µ—Ç–∫–æ–µ —Ä–∞–∑–¥–µ–ª–µ–Ω–∏–µ –æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç–∏
- ‚úÖ –ü—Ä–æ—Å—Ç–∞—è –æ—Ç–ª–∞–¥–∫–∞

### **4. –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å:**
- ‚úÖ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –≤—Å–µ—Ö API —Å—Ü–µ–Ω–∞—Ä–∏–µ–≤
- ‚úÖ –í–∞–ª–∏–¥–∞—Ü–∏—è –≤—Ö–æ–¥–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö (–≤–∫–ª—é—á–∞—è organic_components)
- ‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞ –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏
- ‚úÖ –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫

## üöÄ –ü–ª–∞–Ω –≤–Ω–µ–¥—Ä–µ–Ω–∏—è

### **–≠—Ç–∞–ø 1: –†–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏—Ö —Ç–µ—Å—Ç–æ–≤ (1-2 –¥–Ω—è)**
1. –°–æ–∑–¥–∞—Ç—å —Ü–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã–µ –º–æ–∫–∏ —Å–µ—Ä–≤–∏—Å–æ–≤ –¥–ª—è organic_components
2. –ü–µ—Ä–µ–ø–∏—Å–∞—Ç—å —Ç–µ—Å—Ç—ã –¥–ª—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –Ω–æ–≤—ã—Ö –º–æ–¥–µ–ª–µ–π –¥–∞–Ω–Ω—ã—Ö
3. –£–±—Ä–∞—Ç—å –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç –≤–Ω–µ—à–Ω–∏—Ö —Å–µ—Ä–≤–∏—Å–æ–≤

### **–≠—Ç–∞–ø 2: –†–∞—Å—à–∏—Ä–µ–Ω–∏–µ –ø–æ–∫—Ä—ã—Ç–∏—è –¥–ª—è organic_components (2-3 –¥–Ω—è)**
1. –î–æ–±–∞–≤–∏—Ç—å —Ç–µ—Å—Ç—ã –¥–ª—è –≤—Å–µ—Ö API endpoints —Å organic_components
2. –°–æ–∑–¥–∞—Ç—å —Ç–µ—Å—Ç—ã –≤–∞–ª–∏–¥–∞—Ü–∏–∏ –Ω–æ–≤—ã—Ö Pydantic –º–æ–¥–µ–ª–µ–π
3. –î–æ–±–∞–≤–∏—Ç—å —Ç–µ—Å—Ç—ã middleware –∏ –≤–∞–ª–∏–¥–∞—Ü–∏–∏

### **–≠—Ç–∞–ø 3: –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –∏ CI/CD (1 –¥–µ–Ω—å)**
1. –ù–∞—Å—Ç—Ä–æ–∏—Ç—å –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ
2. –ò–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞—Ç—å –≤ CI/CD pipeline
3. –î–æ–±–∞–≤–∏—Ç—å –º–µ—Ç—Ä–∏–∫–∏ –∫–∞—á–µ—Å—Ç–≤–∞ –¥–ª—è organic_components

## üîÑ –û–±–Ω–æ–≤–ª–µ–Ω–∏—è –¥–ª—è –Ω–æ–≤–æ–π –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã

### **–ö–ª—é—á–µ–≤—ã–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è –≤ API:**

**1. –ù–æ–≤–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–¥—É–∫—Ç–æ–≤:**
- ‚ùå **–£–±—Ä–∞–Ω–æ:** `description`, `description_cid`, `gallery`, `attributes`, `business_id`
- ‚úÖ **–î–æ–±–∞–≤–ª–µ–Ω–æ:** `organic_components` —Å –¥–µ—Ç–∞–ª—å–Ω–æ–π –≤–∞–ª–∏–¥–∞—Ü–∏–µ–π
- ‚úÖ **–£–ª—É—á—à–µ–Ω–æ:** –í–∞–ª–∏–¥–∞—Ü–∏—è –≤—Å–µ—Ö –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã—Ö –ø–æ–ª–µ–π

**2. –ù–æ–≤—ã–µ –ø—Ä–∞–≤–∏–ª–∞ –≤–∞–ª–∏–¥–∞—Ü–∏–∏:**
- `organic_components`: –û–±—è–∑–∞—Ç–µ–ª—å–Ω–æ–µ –ø–æ–ª–µ, –º–∏–Ω–∏–º—É–º 1 —ç–ª–µ–º–µ–Ω—Ç
- `biounit_id`: –£–Ω–∏–∫–∞–ª—å–Ω—ã–π –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞
- `description_cid`: –í–∞–ª–∏–¥–Ω—ã–π CID —Ñ–æ—Ä–º–∞—Ç (Qm + 44 —Å–∏–º–≤–æ–ª–∞)
- `proportion`: –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º—ã–µ —Ñ–æ—Ä–º–∞—Ç—ã (50%, 100g, 30ml, kg, l, oz, lb, fl_oz)

**3. –ù–æ–≤—ã–µ Pydantic –º–æ–¥–µ–ª–∏:**
- `OrganicComponentAPI`: –°—Ç—Ä–æ–≥–∞—è –≤–∞–ª–∏–¥–∞—Ü–∏—è –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤
- `ProductUploadIn`: –°–æ–∑–¥–∞–Ω–∏–µ –ø—Ä–æ–¥—É–∫—Ç–æ–≤ —Å organic_components
- `ProductUpdateIn`: –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ø—Ä–æ–¥—É–∫—Ç–æ–≤ —Å organic_components
- `ProductCreateFromDict`: –°–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å —Å —Ç–µ—Å—Ç–∞–º–∏

### **–ü—Ä–∏–º–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –≤ —Ç–µ—Å—Ç–∞—Ö:**

**–í–∞–ª–∏–¥–∞—Ü–∏—è organic_components:**
```python
# –¢–µ—Å—Ç —É–Ω–∏–∫–∞–ª—å–Ω–æ—Å—Ç–∏ biounit_id
def test_organic_components_unique_biounit_id():
    """–¢–µ—Å—Ç —á—Ç–æ biounit_id –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å —É–Ω–∏–∫–∞–ª—å–Ω—ã–º"""
    with pytest.raises(ValidationError, match="biounit_id –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å —É–Ω–∏–∫–∞–ª—å–Ω—ã–º"):
        ProductUploadIn(
            id="test",
            title="Test",
            organic_components=[
                {"biounit_id": "same_id", "description_cid": "QmCID1...", "proportion": "50%"},
                {"biounit_id": "same_id", "description_cid": "QmCID2...", "proportion": "50%"}
            ],
            cover_image="QmValidCID...",
            categories=["test"],
            forms=["powder"],
            species="Test",
            prices=[{"weight": "100", "weight_unit": "g", "price": "50", "currency": "EUR"}]
        )

# –¢–µ—Å—Ç –≤–∞–ª–∏–¥–∞—Ü–∏–∏ –ø—Ä–æ–ø–æ—Ä—Ü–∏–π
def test_organic_components_proportion_validation():
    """–¢–µ—Å—Ç –≤–∞–ª–∏–¥–∞—Ü–∏–∏ —Ñ–æ—Ä–º–∞—Ç–∞ –ø—Ä–æ–ø–æ—Ä—Ü–∏–π"""
    with pytest.raises(ValidationError, match="–ù–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç –ø—Ä–æ–ø–æ—Ä—Ü–∏–∏"):
        OrganicComponentAPI(
            biounit_id="test",
            description_cid="QmValidCID123...",
            proportion="invalid_format"
        )
```

## üéâ –ó–∞–∫–ª—é—á–µ–Ω–∏–µ

**–î–∞, –≤—ã –∞–±—Å–æ–ª—é—Ç–Ω–æ –ø—Ä–∞–≤—ã!** –ï—Å–ª–∏ —Å–µ—Ä–≤–∏—Å–Ω—ã–π —Å–ª–æ–π —É–∂–µ –ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω, —Ç–æ –≤ API —Ç–µ—Å—Ç–∞—Ö –Ω—É–∂–Ω–æ:

1. **–ú–æ–∫–∞—Ç—å –≤—Å–µ —Å–µ—Ä–≤–∏—Å—ã** ‚Üí –¥–ª—è —Å–∫–æ—Ä–æ—Å—Ç–∏ –∏ –Ω–∞–¥–µ–∂–Ω–æ—Å—Ç–∏
2. **–§–æ–∫—É—Å–∏—Ä–æ–≤–∞—Ç—å—Å—è –Ω–∞ API –ª–æ–≥–∏–∫–µ** ‚Üí HTTP, –≤–∞–ª–∏–¥–∞—Ü–∏—è, –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è
3. **–ú–∏–Ω–∏–º—É–º –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã—Ö —Ç–µ—Å—Ç–æ–≤** ‚Üí —Ç–æ–ª—å–∫–æ –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è —Å–ª–æ–µ–≤
4. **100% –∏–∑–æ–ª—è—Ü–∏—è** ‚Üí –æ—Ç –≤–Ω–µ—à–Ω–∏—Ö –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π

**–ù–æ–≤–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ —Å organic_components:**
- ‚úÖ **–ü–æ–¥–¥–µ—Ä–∂–∫–∞ –º–Ω–æ–≥–æ–∫–æ–º–ø–æ–Ω–µ–Ω—Ç–Ω—ã—Ö –ø—Ä–æ–¥—É–∫—Ç–æ–≤** ‚Üí –≥–∏–±–∫–æ—Å—Ç—å –∏ –º–∞—Å—à—Ç–∞–±–∏—Ä—É–µ–º–æ—Å—Ç—å
- ‚úÖ **–°—Ç—Ä–æ–≥–∞—è –≤–∞–ª–∏–¥–∞—Ü–∏—è** ‚Üí –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–µ–Ω–∏–µ –Ω–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö
- ‚úÖ **–ò–Ω—Ñ–æ—Ä–º–∞—Ç–∏–≤–Ω—ã–µ –æ—à–∏–±–∫–∏** ‚Üí –±—ã—Å—Ç—Ä–æ–µ –≤—ã—è–≤–ª–µ–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º
- ‚úÖ **–°–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å —Å —Ç–µ—Å—Ç–∞–º–∏** ‚Üí –ø–ª–∞–≤–Ω—ã–π –ø–µ—Ä–µ—Ö–æ–¥ –Ω–∞ –Ω–æ–≤—É—é –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—É

**–†–µ–∑—É–ª—å—Ç–∞—Ç:** –ë—ã—Å—Ç—Ä—ã–µ, –Ω–∞–¥–µ–∂–Ω—ã–µ, –ø–æ–Ω—è—Ç–Ω—ã–µ —Ç–µ—Å—Ç—ã API —Å –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π –Ω–æ–≤–æ–π –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã organic_components, –∫–æ—Ç–æ—Ä—ã–µ –¥–µ–π—Å—Ç–≤–∏—Ç–µ–ª—å–Ω–æ —Ç–µ—Å—Ç–∏—Ä—É—é—Ç API, –∞ –Ω–µ –¥—É–±–ª–∏—Ä—É—é—Ç —Ç–µ—Å—Ç—ã —Å–µ—Ä–≤–∏—Å–Ω–æ–≥–æ —Å–ª–æ—è.
