<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Amanita Web3 Wallet</title>
  <script src="https://telegram.org/js/telegram-web-app.js"></script>
  <link rel="stylesheet" href="styles.css" />

  <!-- –í—Å—Ç—Ä–æ–µ–Ω–Ω—ã–π —Å–∫—Ä–∏–ø—Ç –¥–ª—è —Ä–∞–Ω–Ω–µ–π –ø—Ä–æ–≤–µ—Ä–∫–∏ –∏ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è -->
  <script>
    console.log("üîç –ù–∞—á–∞–ª–æ –∑–∞–≥—Ä—É–∑–∫–∏ —Å—Ç—Ä–∞–Ω–∏—Ü—ã");
    
    // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è –≤ –∫–æ–Ω—Å–æ–ª—å –∏ –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—É
    function logStatus(message, isError = false) {
      console.log(message);
      // –ü–æ—Å–ª–µ –∑–∞–≥—Ä—É–∑–∫–∏ DOM –¥–æ–±–∞–≤–∏–º —Å–æ–æ–±—â–µ–Ω–∏–µ –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—É
      document.addEventListener('DOMContentLoaded', function() {
        const logElem = document.getElementById('init-log');
        if (logElem) {
          const line = document.createElement('div');
          line.textContent = message;
          if (isError) line.style.color = 'red';
          logElem.appendChild(line);
        }
      });
    }

    // –ü—Ä–æ–≤–µ—Ä–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ ethers
    window.ethersLoaded = false;
    
    function checkEthers() {
      if (typeof ethers !== 'undefined') {
        window.ethersLoaded = true;
        logStatus("‚úÖ ethers.js —É—Å–ø–µ—à–Ω–æ –∑–∞–≥—Ä—É–∂–µ–Ω");
      } else {
        logStatus("‚ùå ethers.js –Ω–µ –∑–∞–≥—Ä—É–∂–µ–Ω", true);
      }
    }

    // –°–æ–±—ã—Ç–∏–µ –æ—à–∏–±–∫–∏ –∑–∞–≥—Ä—É–∑–∫–∏ —Å–∫—Ä–∏–ø—Ç–∞
    window.addEventListener('error', function(e) {
      if (e.target.tagName === 'SCRIPT') {
        logStatus(`‚ùå –û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Å–∫—Ä–∏–ø—Ç–∞: ${e.target.src}`, true);
      }
    }, true);
    
    logStatus("üîç –°–∫—Ä–∏–ø—Ç –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ –≤—ã–ø–æ–ª–Ω–µ–Ω");

    // –î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ Telegram WebApp
    window.tgWebAppData = {};
    
    console.log("WebApp –∑–∞–ø—É—â–µ–Ω");
    if (window.Telegram && window.Telegram.WebApp) {
        // –°–æ–æ–±—â–∞–µ–º Telegram —á—Ç–æ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –≥–æ—Ç–æ–≤–æ
        window.Telegram.WebApp.ready();
        
        console.log("–ó–∞–ø—É—â–µ–Ω –≤ Telegram WebApp");
        console.log("–î–∞–Ω–Ω—ã–µ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏:", window.Telegram.WebApp.initData);
        
        // –°–æ—Ö—Ä–∞–Ω—è–µ–º –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ WebApp –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ
        window.tgWebAppData = {
            platform: window.Telegram.WebApp.platform || '–Ω–µ–∏–∑–≤–µ—Å—Ç–Ω–æ',
            version: window.Telegram.WebApp.version || '–Ω–µ–∏–∑–≤–µ—Å—Ç–Ω–æ',
            colorScheme: window.Telegram.WebApp.colorScheme || '–Ω–µ–∏–∑–≤–µ—Å—Ç–Ω–æ',
            initDataUnsafe: window.Telegram.WebApp.initDataUnsafe || {},
            viewportHeight: window.Telegram.WebApp.viewportHeight,
            viewportStableHeight: window.Telegram.WebApp.viewportStableHeight
        };
        
        // –†–∞—Å—à–∏—Ä—è–µ–º WebApp –Ω–∞ –ø–æ–ª–Ω—É—é –≤—ã—Å–æ—Ç—É
        window.Telegram.WebApp.expand();
        
        // –†–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ —Å–æ–±—ã—Ç–∏—è –∑–∞–∫—Ä—ã—Ç–∏—è WebApp
        window.Telegram.WebApp.onEvent('viewportChanged', function() {
            logStatus(`üì± –ò–∑–º–µ–Ω–µ–Ω–∏–µ viewport: ${window.Telegram.WebApp.viewportHeight}px`);
            updateTelegramInfo();
        });
    } else {
        console.log("–ó–∞–ø—É—â–µ–Ω –≤ –æ–±—ã—á–Ω–æ–º –±—Ä–∞—É–∑–µ—Ä–µ");
        window.tgWebAppData.isBrowser = true;
    }
    
    // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ Telegram WebApp –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ
    function updateTelegramInfo() {
        document.addEventListener('DOMContentLoaded', function() {
            const telegramInfoElem = document.getElementById('telegram-info');
            if (!telegramInfoElem) return;
            
            if (window.Telegram && window.Telegram.WebApp) {
                telegramInfoElem.innerHTML = `
                    <div>‚úÖ <strong>Telegram WebApp –∞–∫—Ç–∏–≤–µ–Ω</strong></div>
                    <div>–ü–ª–∞—Ç—Ñ–æ—Ä–º–∞: ${window.tgWebAppData.platform}</div>
                    <div>–í–µ—Ä—Å–∏—è: ${window.tgWebAppData.version}</div>
                    <div>–¶–≤–µ—Ç–æ–≤–∞—è —Å—Ö–µ–º–∞: ${window.tgWebAppData.colorScheme}</div>
                    <div>–í—ã—Å–æ—Ç–∞ viewport: ${window.Telegram.WebApp.viewportHeight}px</div>
                    <div>User ID: ${window.tgWebAppData.initDataUnsafe.user?.id || '–Ω–µ—Ç'}</div>
                    <div>–ú–µ—Ç–æ–¥ –∑–∞–ø—É—Å–∫–∞: –∏–∑ ${window.tgWebAppData.initDataUnsafe.start_param || '–æ—Å–Ω–æ–≤–Ω–æ–≥–æ –º–µ–Ω—é'}</div>
                `;
            } else {
                telegramInfoElem.innerHTML = `
                    <div>‚ö†Ô∏è <strong>–ó–∞–ø—É—â–µ–Ω–æ –≤ –æ–±—ã—á–Ω–æ–º –±—Ä–∞—É–∑–µ—Ä–µ</strong></div>
                    <div>URL: ${window.location.href}</div>
                    <div>User Agent: ${navigator.userAgent}</div>
                `;
            }
        });
    }
    
    // –í—ã–∑—ã–≤–∞–µ–º —Ñ—É–Ω–∫—Ü–∏—é –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏
    updateTelegramInfo();
  </script>
  
  <!-- –ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω—ã–µ —Å–ø–æ—Å–æ–±—ã –∑–∞–≥—Ä—É–∑–∫–∏ ethers -->
  <script>
    // –ü–æ–ø—Ä–æ–±—É–µ–º –∑–∞–≥—Ä—É–∑–∏—Ç—å –±–∏–±–ª–∏–æ—Ç–µ–∫—É –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏
    logStatus("üîÑ –ü—ã—Ç–∞–µ–º—Å—è –∑–∞–≥—Ä—É–∑–∏—Ç—å ethers.js –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏");
    const script = document.createElement('script');
    script.src = "https://cdn.ethers.io/lib/ethers-5.7.2.umd.min.js";
    script.type = "text/javascript"; 
    script.onload = function() {
      logStatus("‚úÖ ethers.js –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ –∑–∞–≥—Ä—É–∂–µ–Ω");
      window.ethersLoaded = true;
      checkEthers();
    };
    script.onerror = function() {
      logStatus("‚ùå –û—à–∏–±–∫–∞ –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–æ–π –∑–∞–≥—Ä—É–∑–∫–∏ ethers.js, –ø—Ä–æ–±—É–µ–º –∞–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω—ã–π –∏—Å—Ç–æ—á–Ω–∏–∫", true);
      // –ü—Ä–æ–±—É–µ–º –∑–∞–≥—Ä—É–∑–∏—Ç—å —Å unpkg –∫–∞–∫ –∞–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω—ã–π –∏—Å—Ç–æ—á–Ω–∏–∫
      const unpkgScript = document.createElement('script');
      unpkgScript.src = "https://unpkg.com/ethers@5.7.2/dist/ethers.umd.min.js";
      unpkgScript.type = "text/javascript";
      unpkgScript.onload = function() {
        logStatus("‚úÖ ethers.js —É—Å–ø–µ—à–Ω–æ –∑–∞–≥—Ä—É–∂–µ–Ω —Å unpkg!");
        window.ethersLoaded = true;
        checkEthers();
      };
      unpkgScript.onerror = function() {
        logStatus("‚ùå –ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–≥—Ä—É–∑–∏—Ç—å ethers.js –Ω–∏ —Å –æ–¥–Ω–æ–≥–æ –∏—Å—Ç–æ—á–Ω–∏–∫–∞", true);
      };
      document.head.appendChild(unpkgScript);
    };
    document.head.appendChild(script);
  </script>
  
  <!-- –†–µ–∑–µ—Ä–≤–Ω–∞—è –∑–∞–≥—Ä—É–∑–∫–∞ —á–µ—Ä–µ–∑ jsdelivr -->
  <script src="https://cdn.jsdelivr.net/npm/ethers@5.7.2/dist/ethers.umd.min.js" 
          type="text/javascript"
          onerror="logStatus('‚ùå –û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ ethers.js —á–µ—Ä–µ–∑ jsdelivr', true)"></script>
  
  <script src="main.js" defer></script>
</head>
<body>
  <header>
    <h1 class="main-title" data-l10n="app_title">AMANITA</h1>
    <p class="subtitle" data-l10n="app_subtitle">–ö–æ—à–µ–ª—ë–∫ –º–∏—Ü–µ–ª–∏—è üå±</p>
  </header>  
  <div id="app">
    <p class="note" data-l10n="welcome_note">–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å –≤ —Ä–æ—â—É AMANITA. –ó–¥–µ—Å—å —Ç—ã –º–æ–∂–µ—à—å —Å–æ–∑–¥–∞—Ç—å –∏–ª–∏ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–∏—Ç—å —Å–≤–æ–π –ø—É—Ç—å üçÑ</p>

    <!-- –°—Ç–∞—Ç—É—Å–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ –æ –∑–∞–≥—Ä—É–∑–∫–µ –±–∏–±–ª–∏–æ—Ç–µ–∫–∏ 
    <div id="init-status">
      <p>–°—Ç–∞—Ç—É—Å –∑–∞–≥—Ä—É–∑–∫–∏ –±–∏–±–ª–∏–æ—Ç–µ–∫–∏: <span id="ethers-status">–ü—Ä–æ–≤–µ—Ä–∫–∞...</span></p>
      <div id="init-log" style="background:#f5f5f5; padding:10px; max-height:150px; overflow:auto; font-size:12px;"></div>
    </div>-->

    <!-- –î–∏–∞–≥–Ω–æ—Å—Ç–∏—á–µ—Å–∫–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ Telegram WebApp 
    <div id="telegram-diagnostic" style="margin: 15px 0; padding: 10px; border: 1px solid #ccc; border-radius: 5px;">
      <h3>–î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ Telegram WebApp</h3>
      <div id="telegram-info">–ó–∞–≥—Ä—É–∑–∫–∞ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏...</div>
      <div style="margin-top: 10px;">
        <button onclick="toggleTelegramDebug()">–ü–æ–∫–∞–∑–∞—Ç—å —Ä–∞—Å—à–∏—Ä–µ–Ω–Ω—É—é –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é</button>
      </div>
      <div id="telegram-debug" style="display:none; margin-top: 10px; background: #f0f0f0; padding: 10px; font-size: 12px;"></div>
    </div>-->

    <!-- –°—Ç–∞—Ç—É—Å–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ, –≤–∏–¥–∏–º–æ —Ç–æ–ª—å–∫–æ –ø—Ä–∏ –Ω–∞–ª–∏—á–∏–∏ —Ç–µ–∫—Å—Ç–∞ -->
    <div id="status-message" class="view hidden"></div>

    <!-- –†–µ–∂–∏–º –≤—ã–±–æ—Ä–∞ –¥–µ–π—Å—Ç–≤–∏—è -->
    <div id="start-screen" class="view hidden">
      <p data-l10n="choose_action">–í—ã–±–µ—Ä–∏—Ç–µ –¥–µ–π—Å—Ç–≤–∏–µ –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –≤–∞—à–∏–º –∫—Ä–∏–ø—Ç–æ–∫–æ—à–µ–ª—å–∫–æ–º:</p>
      <div class="button-container centered">
        <button id="create-btn" class="shaman-button" data-l10n="btn_create_wallet"><span class="icon">üÜï</span> –°–æ–∑–¥–∞—Ç—å –Ω–æ–≤—ã–π –∫–æ—à–µ–ª—ë–∫</button>
        <button id="restore-btn" class="shaman-button" data-l10n="btn_restore_wallet"><span class="icon">üîÑ</span> –í–æ—Å—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –ø–æ –º—É—Ö–æ–º–æ—Ä–Ω–æ–º—É –ø–∞—Ä–æ–ª—é</button>
      </div>
    </div>

    <!-- –†–µ–∂–∏–º –∑–∞–≥—Ä—É–∑–∫–∏ –≤–æ –≤—Ä–µ–º—è –æ–ø–µ—Ä–∞—Ü–∏–π -->
    <div id="loading-screen" class="view hidden">
      <p class="loading" id="loading-text" data-l10n="loading_create">–°–æ–∑–¥–∞–µ–º –∫–æ—à–µ–ª–µ–∫, –ø–æ–∂–∞–ª—É–π—Å—Ç–∞ –ø–æ–¥–æ–∂–¥–∏—Ç–µ...</p>
    </div>

    <!-- –†–µ–∂–∏–º —Å–∏–¥ —Ñ—Ä–∞–∑—ã -->
    <div id="seed-screen" class="view hidden">
      <!-- –ê–¥—Ä–µ—Å –∫–æ—à–µ–ª—å–∫–∞ (—É–¥–∞–∏—Ç—å –ø–æ—Å–ª–µ —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ–π –æ—Ç–ª–∞–¥–∫–∏)
      <p><strong data-l10n="wallet_address_label">–í–∞—à –∞–¥—Ä–µ—Å –∫–æ—à–µ–ª—å–∫–∞:</strong></p>
      <p id="wallet-address" class="mono"></p>-->

      <h2 class="mushroom-title" data-l10n="seed_phrase_label">üçÑ –í–∞—à –º—É—Ö–æ–º–æ—Ä–Ω—ã–π –ø–∞—Ä–æ–ª—å (12 —Å–ª–æ–≤):</h2>
      <div class="warning-box" data-l10n="seed_warning">
        ‚ö†Ô∏è –°–æ—Ö—Ä–∞–Ω–∏—Ç–µ —ç—Ç—É —Ñ—Ä–∞–∑—É –≤ –Ω–∞–¥–µ–∂–Ω–æ–º –º–µ—Å—Ç–µ! –° –µ—ë –ø–æ–º–æ—â—å—é –≤—ã —Å–º–æ–∂–µ—Ç–µ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –¥–æ—Å—Ç—É–ø –∫ –∫–æ—à–µ–ª—å–∫—É.
      </div>

      <div class="seed-container">
        <textarea readonly id="wallet-mnemonic" class="seed-display mono sensitive"></textarea>
        <div class="button-row centered seed-actions">
          <button id="reveal-seed-btn" class="button-secondary" data-l10n="btn_reveal_seed"><span class="icon">üëÅÔ∏è</span> –ü–æ–∫–∞–∑–∞—Ç—å / —Å–∫—Ä—ã—Ç—å –º—É—Ö–æ–º–æ—Ä–Ω—ã–π –ø–∞—Ä–æ–ª—å</button>
          <button id="copy-seed-btn" class="button-secondary" data-l10n="btn_copy_seed"><span class="icon">üìã</span> –°–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å –ø–∞—Ä–æ–ª—å</button>
        </div>
      </div>
      
      <!-- –ù–æ–≤—ã–µ –∫–Ω–æ–ø–∫–∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–º –∫–æ—à–µ–ª—å–∫–æ–º -->
      <div class="wallet-actions centered" style="margin-top: 20px; border-top: 1px solid #ddd; padding-top: 15px;">
        <button id="btn_confirm_wallet" class="shaman-button" data-l10n="btn_confirm_wallet"><span class="icon">‚úÖ</span> –Ø –∑–∞–ø–∏—Å–∞–ª(–∞) –º—É—Ö–æ–º–æ—Ä–Ω—ã–π –ø–∞—Ä–æ–ª—å</button>
      </div>
    </div>

    <!-- –†–µ–∂–∏–º –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è -->
    <div id="restore-screen" class="view hidden">
      <h2 class="section-title mushroom-title" data-l10n="restore_title">
        üîÑ –í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ –¥–æ—Å—Ç—É–ø–∞ –∫ –∫–æ—à–µ–ª—å–∫—É
      </h2>

      <p data-l10n="restore_enter_seed">
        –í–≤–µ–¥–∏—Ç–µ –º—É—Ö–æ–º–æ—Ä–Ω—ã–π –ø–∞—Ä–æ–ª—å (12 —Å–ª–æ–≤, —Ä–∞–∑–¥–µ–ª–µ–Ω–Ω—ã—Ö –ø—Ä–æ–±–µ–ª–æ–º):
      </p>

      <textarea
        id="mnemonic-input"
        rows="3"
        class="mono-input"
        placeholder="word1 word2 ... word12"
        data-l10n-placeholder="restore_seed_placeholder"
      ></textarea>

      <p id="restore-error" class="error hidden"></p>

      <div class="button-container centered" style="margin-top: 16px; gap: 12px;">
        <button
          id="restore-confirm-btn"
          class="shaman-button"
          data-l10n="btn_restore_wallet"
        >
          <span class="icon">‚úÖ</span> –í–æ—Å—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –∫–æ—à–µ–ª—ë–∫
        </button>
        <!--
        <button
          id="back-to-start-btn"
          class="shaman-button secondary"
          data-l10n="btn_back"
        >
          <span class="icon">‚¨ÖÔ∏è</span> –ù–∞–∑–∞–¥
        </button>-->
      </div>
    </div>

    <!-- –≠–∫—Ä–∞–Ω —É—Å—Ç–∞–Ω–æ–≤–∫–∏ PIN -->
    <div id="setup-pin-screen" class="view hidden">
      <h3 id="pin-entry-title" data-l10n="setup_pin_title">–£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ PIN-–∫–æ–¥</h3>
      <p id="pin-setup-description" data-l10n="setup_pin_description">–ü—Ä–∏–¥—É–º–∞–π—Ç–µ 5 —Ü–∏—Ñ—Ä, –∫–æ—Ç–æ—Ä—ã–µ –∑–∞—â–∏—Ç—è—Ç –≤–∞—à –º—É—Ö–æ–º–æ—Ä–Ω—ã–π –ø–∞—Ä–æ–ª—å.</p>

      <div class="pin-display">
        <span class="pin-dot"></span>
        <span class="pin-dot"></span>
        <span class="pin-dot"></span>
        <span class="pin-dot"></span>
        <span class="pin-dot"></span>
      </div>
      
      <!-- –ö–ª–∞–≤–∏–∞—Ç—É—Ä–∞ –¥–ª—è PIN-–∫–æ–¥–∞ -->
      <div id="pin-keyboard">
        <div class="pin-row">
          <button class="mushroom-key" data-key="1"><img src="assets/amanita_key_1.png" alt="1"></button>
          <button class="mushroom-key" data-key="2"><img src="assets/amanita_key_2.png" alt="2"></button>
          <button class="mushroom-key" data-key="3"><img src="assets/amanita_key_3.png" alt="3"></button>
        </div>
        <div class="pin-row">
          <button class="mushroom-key" data-key="4"><img src="assets/amanita_key_4.png" alt="4"></button>
          <button class="mushroom-key" data-key="5"><img src="assets/amanita_key_5.png" alt="5"></button>
          <button class="mushroom-key" data-key="6"><img src="assets/amanita_key_6.png" alt="6"></button>
        </div>
        <div class="pin-row">
          <button class="mushroom-key" data-key="7"><img src="assets/amanita_key_7.png" alt="7"></button>
          <button class="mushroom-key" data-key="8"><img src="assets/amanita_key_8.png" alt="8"></button>
          <button class="mushroom-key" data-key="9"><img src="assets/amanita_key_9.png" alt="9"></button>
        </div>
        <div class="pin-row">
          <button class="mushroom-key" data-key="star" disabled><img src="assets/star.png" alt="*"></button>
          <button class="mushroom-key" data-key="0"><img src="assets/amanita_key_0.png" alt="0"></button>
          <button class="mushroom-key" data-key="backspace"><img src="assets/amanita_key_back.png" alt="–£–¥–∞–ª–∏—Ç—å"></button>
        </div>
      </div>
      
      <!-- –ö–Ω–æ–ø–∫–∞ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è PIN —É–¥–∞–ª–µ–Ω–∞ -->
      <!-- <button id="setup-pin-submit-btn" class="shaman-button primary-button" data-l10n="setup_pin_submit_btn"><span class="icon">üîê</span> –ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç—å</button> -->

    </div>

    <!-- –≠–∫—Ä–∞–Ω —É—Å–ø–µ—à–Ω–æ–≥–æ —Å–æ–∑–¥–∞–Ω–∏—è/–≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è –∫–æ—à–µ–ª—å–∫–∞ -->
    <div id="success-screen" class="view">
      <h2 data-l10n="success_title">üéâ –í—Å—ë –≥–æ—Ç–æ–≤–æ!</h2>
      <p data-l10n="success_description">–¢—ã —É—Å–ø–µ—à–Ω–æ —Å–æ–∑–¥–∞–ª(–∞)/–≤–æ—Å—Å—Ç–∞–Ω–æ–≤–∏–ª(–∞) —Å–≤–æ–π –∞–∫–∫–∞—É–Ω—Ç –∫ —ç–∫–æ—Å–∏—Å—Ç–µ–º–µ Amanita üçÑ</p>
      <p data-l10n="success_description_2">–ú–æ–∂–µ—à—å –ø–µ—Ä–µ–π—Ç–∏ –≤ –∫–∞—Ç–∞–ª–æ–≥ –∏ –∏—Å—Å–ª–µ–¥–æ–≤–∞—Ç—å –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏!</p>
      <div class="button-container centered">
        <button id="finish-btn" class="shaman-button" data-l10n="success_btn">
          <span class="icon">‚úÖ</span> –ü–µ—Ä–µ–π—Ç–∏ –≤ –∫–∞—Ç–∞–ª–æ–≥
        </button>
      </div>
    </div>

    <!-- –†–µ–∂–∏–º –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ —Å–∏–¥-—Ñ—Ä–∞–∑—ã -->
    <div id="unlock-screen" class="view hidden">
      <p data-l10n="unlock_title">–í–≤–µ–¥–∏—Ç–µ PIN-–∫–æ–¥ –¥–ª—è –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ –≤–∞—à–µ–≥–æ –º—É—Ö–æ–º–æ—Ä–Ω–æ–≥–æ –ø–∞—Ä–æ–ª—è:</p>
      <div class="pin-display">
        <span class="pin-dot"></span>
        <span class="pin-dot"></span>
        <span class="pin-dot"></span>
        <span class="pin-dot"></span>
        <span class="pin-dot"></span>
      </div>
      
      <div id="pin-keyboard" class="pin-keyboard">
        <button class="amanita-key" data-key="1"><img src="assets/amanita_key_1.png" alt="1" /></button>
        <button class="amanita-key" data-key="2"><img src="assets/amanita_key_2.png" alt="2" /></button>
        <button class="amanita-key" data-key="3"><img src="assets/amanita_key_3.png" alt="3" /></button>
        <button class="amanita-key" data-key="4"><img src="assets/amanita_key_4.png" alt="4" /></button>
        <button class="amanita-key" data-key="5"><img src="assets/amanita_key_5.png" alt="5" /></button>
        <button class="amanita-key" data-key="6"><img src="assets/amanita_key_6.png" alt="6" /></button>
        <button class="amanita-key" data-key="7"><img src="assets/amanita_key_7.png" alt="7" /></button>
        <button class="amanita-key" data-key="8"><img src="assets/amanita_key_8.png" alt="8" /></button>
        <button class="amanita-key" data-key="9"><img src="assets/amanita_key_9.png" alt="9" /></button>
        <button class="mushroom-key" data-key="backspace"><img src="assets/amanita_key_backspace.png" alt="–£–¥–∞–ª–∏—Ç—å" /></button>
        <button class="mushroom-key" data-key="0"><img src="assets/amanita_key_0.png" alt="0" /></button>
        <button class="mushroom-key" data-key="confirm"><img src="assets/amanita_key_ok.png" alt="OK" /></button>
      </div>
      
      <div class="button-container centered">
        <button id="unlock-submit-btn" class="shaman-button" data-l10n="unlock_btn"><span class="icon">üîì</span> –ü–æ–∫–∞–∑–∞—Ç—å –º—É—Ö–æ–º–æ—Ä–Ω—ã–π –ø–∞—Ä–æ–ª—å</button>
      </div>
    </div>

    <div id="view-screen" class="view hidden">
      <p data-l10n="view_seed_title">–í–∞—à –º—É—Ö–æ–º–æ—Ä–Ω—ã–π –ø–∞—Ä–æ–ª—å (—Ç–æ–ª—å–∫–æ –Ω–∞ 20 —Å–µ–∫—É–Ω–¥):</p>
      <pre id="view-seed-text"></pre>
    </div>

    <!-- –†–µ–∂–∏–º –ø–æ–¥–ø–∏—Å–∏ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ -->
    <div id="sign-screen" class="view hidden">
      <p data-l10n="sign_tx_title">–ü–æ–¥–ø–∏—Å–∞—Ç—å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ —Å–∫–∏–¥–∫–∏:</p>
      <p><span data-l10n="sign_tx_order">üõí –ó–∞–∫–∞–∑:</span> <span id="tx-order-id"></span></p>
      <p><span data-l10n="sign_tx_tokens">üéÅ –¢–æ–∫–µ–Ω—ã AMANITA:</span> <span id="tx-token-amount"></span></p>
      <input type="password" id="sign-pin-input" placeholder="–í–≤–µ–¥–∏—Ç–µ PIN-–∫–æ–¥ –¥–ª—è –ø–æ–¥–ø–∏—Å–∏" data-l10n="sign_pin_placeholder" />
      <div class="button-container centered">
        <button id="sign-submit-btn" class="shaman-button" data-l10n="btn_sign_submit"><span class="icon">‚úçÔ∏è</span> –ü–æ–¥–ø–∏—Å–∞—Ç—å</button>
      </div>
    </div>  
  </div>

  <script>
    // –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ—Å–ª–µ –∑–∞–≥—Ä—É–∑–∫–∏ DOM
    document.addEventListener('DOMContentLoaded', function() {
      logStatus("üîÑ DOM –ø–æ–ª–Ω–æ—Å—Ç—å—é –∑–∞–≥—Ä—É–∂–µ–Ω");
      
      // –û–±–Ω–æ–≤–∏–º —Å—Ç–∞—Ç—É—Å –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ
      setTimeout(function() {
        const ethersStatus = document.getElementById('ethers-status');
        if (ethersStatus) {
          if (window.ethersLoaded) {
            ethersStatus.textContent = "–ó–∞–≥—Ä—É–∂–µ–Ω–∞ ‚úÖ";
            ethersStatus.style.color = "green";
          } else {
            ethersStatus.textContent = "–ù–µ –∑–∞–≥—Ä—É–∂–µ–Ω–∞ ‚ùå";
            ethersStatus.style.color = "red";
            
            // –ü—Ä–æ–≤–µ—Ä–∏–º –µ—â–µ —Ä–∞–∑ —Å –ø–æ—Å–ª–µ–¥–Ω–µ–π –ø–æ–ø—ã—Ç–∫–æ–π
            checkEthers();
            if (window.ethersLoaded) {
              ethersStatus.textContent = "–ó–∞–≥—Ä—É–∂–µ–Ω–∞ –ø–æ—Å–ª–µ –ø–æ–≤—Ç–æ—Ä–Ω–æ–π –ø—Ä–æ–≤–µ—Ä–∫–∏ ‚úÖ";
              ethersStatus.style.color = "green";
            } else {
              logStatus("‚ùå ethers.js –Ω–µ —É–¥–∞–ª–æ—Å—å –∑–∞–≥—Ä—É–∑–∏—Ç—å –ø–æ—Å–ª–µ –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö –ø–æ–ø—ã—Ç–æ–∫", true);
            }
          }
        }
      }, 1000);
    });
    
    // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è —Ä–∞—Å—à–∏—Ä–µ–Ω–Ω–æ–π –æ—Ç–ª–∞–¥–æ—á–Ω–æ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏
    function toggleTelegramDebug() {
      const debugElem = document.getElementById('telegram-debug');
      if (debugElem.style.display === 'none') {
        debugElem.style.display = 'block';
        
        // –°–æ–±–∏—Ä–∞–µ–º —Ä–∞—Å—à–∏—Ä–µ–Ω–Ω—É—é –æ—Ç–ª–∞–¥–æ—á–Ω—É—é –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é
        let debugInfo = '';
        
        // –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –≤–∞—à–µ–º –æ–∫—Ä—É–∂–µ–Ω–∏–∏
        debugInfo += '<h4>–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ–± –æ–∫—Ä—É–∂–µ–Ω–∏–∏</h4>';
        debugInfo += `<div>URL: ${window.location.href}</div>`;
        debugInfo += `<div>User Agent: ${navigator.userAgent}</div>`;
        debugInfo += `<div>–í—Ä–µ–º—è –∑–∞–≥—Ä—É–∑–∫–∏: ${new Date().toLocaleString()}</div>`;
        
        // –ü—Ä–æ–≤–µ—Ä–∫–∞ Telegram WebApp
        if (window.Telegram && window.Telegram.WebApp) {
          debugInfo += '<h4>Telegram WebApp</h4>';
          
          // –ë–µ–∑–æ–ø–∞—Å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –∏–∑ initDataUnsafe
          const safeData = { ...window.Telegram.WebApp.initDataUnsafe };
          if (safeData.user) {
            safeData.user = {
              id: safeData.user.id,
              is_bot: safeData.user.is_bot,
              first_name: safeData.user.first_name,
              last_name: safeData.user.last_name,
              username: safeData.user.username,
              language_code: safeData.user.language_code
            };
          }
          
          debugInfo += `<pre>${JSON.stringify(safeData, null, 2)}</pre>`;
          
          // –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ —Ñ—É–Ω–∫—Ü–∏—è—Ö
          debugInfo += '<h4>–î–æ—Å—Ç—É–ø–Ω—ã–µ –º–µ—Ç–æ–¥—ã</h4>';
          const methods = Object.getOwnPropertyNames(window.Telegram.WebApp)
            .filter(prop => typeof window.Telegram.WebApp[prop] === 'function');
          debugInfo += `<div>${methods.join(', ')}</div>`;
        } else {
          debugInfo += '<div>Telegram WebApp API –Ω–µ –¥–æ—Å—Ç—É–ø–µ–Ω</div>';
        }
        
        debugElem.innerHTML = debugInfo;
      } else {
        debugElem.style.display = 'none';
      }
    }
  </script>
  
  <!-- –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä –¥–ª—è —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π -->
  <div id="notifications-container" class="notifications-container"></div>

  <!-- –ö–Ω–æ–ø–∫–∞ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –ª–æ–≥–∞–º–∏ -->
  <div id="debug-control" style="position: fixed; top: 10px; right: 10px; z-index: 1001; pointer-events: auto;">
    <button onclick="toggleDebugPanel()" style="background: rgba(0,0,0,0.6); border: 1px solid white; color: white; padding: 4px 8px; border-radius: 4px; cursor: pointer; font-size: 10px; margin-right: 5px;">üîç Logs</button>
    <button onclick="copyLogs()" style="background: rgba(0,0,0,0.6); border: 1px solid white; color: white; padding: 4px 8px; border-radius: 4px; cursor: pointer; font-size: 10px;">üìã Copy</button>
  </div>

  <!-- –û—Ç–ª–∞–¥–æ—á–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è -->
  <div id="debug-panel" style="position: fixed; bottom: 0; left: 0; right: 0; background: rgba(0,0,0,0.8); color: white; font-family: monospace; font-size: 12px; padding: 10px; max-height: 100px; overflow-y: auto; z-index: 1000; pointer-events: auto; transition: all 0.3s ease;">
    <div id="init-log" style="white-space: pre-wrap;"></div>
  </div>

  <script>
    function toggleDebugPanel() {
      const panel = document.getElementById('debug-panel');
      const currentHeight = panel.style.maxHeight;
      const debugControl = document.getElementById('debug-control').getElementsByTagName('button')[0];
      
      if (currentHeight === '100px' || !currentHeight) {
        panel.style.maxHeight = '0px';
        panel.style.padding = '0px';
        debugControl.style.background = 'rgba(0,0,0,0.3)';
        debugControl.textContent = 'üîç Show Logs';
      } else {
        panel.style.maxHeight = '100px';
        panel.style.padding = '10px';
        debugControl.style.background = 'rgba(0,0,0,0.6)';
        debugControl.textContent = 'üîç Hide Logs';
      }
    }

    function copyLogs() {
      const logContent = document.getElementById('init-log').innerText;
      navigator.clipboard.writeText(logContent).then(() => {
        // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –≤—Ä–µ–º–µ–Ω–Ω–æ–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –æ–± —É—Å–ø–µ—à–Ω–æ–º –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–∏
        const copyBtn = document.getElementById('debug-control').getElementsByTagName('button')[1];
        const originalText = copyBtn.textContent;
        copyBtn.textContent = '‚úÖ Copied!';
        setTimeout(() => {
          copyBtn.textContent = originalText;
        }, 2000);
      }).catch(err => {
        console.error('Failed to copy logs:', err);
      });
    }

    // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–π –ø—Ä–æ–∫—Ä—É—Ç–∫–∏ –ª–æ–≥–æ–≤ –≤–Ω–∏–∑
    function scrollLogsToBottom() {
      const panel = document.getElementById('debug-panel');
      panel.scrollTop = panel.scrollHeight;
    }

    // –ú–æ–¥–∏—Ñ–∏—Ü–∏—Ä—É–µ–º —Ñ—É–Ω–∫—Ü–∏—é logStatus –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–π –ø—Ä–æ–∫—Ä—É—Ç–∫–∏
    const originalLogStatus = window.logStatus;
    window.logStatus = function(message, isError = false) {
      originalLogStatus(message, isError);
      // –î–æ–±–∞–≤–ª—è–µ–º –Ω–µ–±–æ–ª—å—à—É—é –∑–∞–¥–µ—Ä–∂–∫—É –¥–ª—è —É–≤–µ—Ä–µ–Ω–Ω–æ—Å—Ç–∏, —á—Ç–æ –∫–æ–Ω—Ç–µ–Ω—Ç –æ–±–Ω–æ–≤–∏–ª—Å—è
      setTimeout(scrollLogsToBottom, 10);
    };

    // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –Ω–∞—á–∞–ª—å–Ω–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ
    document.addEventListener('DOMContentLoaded', function() {
      const panel = document.getElementById('debug-panel');
      panel.style.maxHeight = '100px'; // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –ª–æ–≥–∏ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é
      const debugControl = document.getElementById('debug-control').getElementsByTagName('button')[0];
      debugControl.textContent = 'üîç Hide Logs';
      
      // –ù–∞—á–∞–ª—å–Ω–∞—è –ø—Ä–æ–∫—Ä—É—Ç–∫–∞ –≤–Ω–∏–∑
      scrollLogsToBottom();
    });
  </script>
</body>
</html>
